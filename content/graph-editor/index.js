(()=>{var zr=Object.create;var ye=Object.defineProperty;var Ur=Object.getOwnPropertyDescriptor;var Hr=Object.getOwnPropertyNames;var Yr=Object.getPrototypeOf,Xr=Object.prototype.hasOwnProperty;var Wr=(t,e,r)=>e in t?ye(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Kr=t=>ye(t,"__esModule",{value:!0});var Zr=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var $r=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Hr(e))!Xr.call(t,o)&&(r||o!=="default")&&ye(t,o,{get:()=>e[o],enumerable:!(n=Ur(e,o))||n.enumerable});return t},ft=(t,e)=>$r(Kr(ye(t!=null?zr(Yr(t)):{},"default",!e&&t&&t.__esModule?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var _e=(t,e,r)=>(Wr(t,typeof e!="symbol"?e+"":e,r),r);var at=Zr((it,st)=>{(function(t,e){typeof it=="object"&&typeof st<"u"?st.exports=e():typeof define=="function"&&define.amd?define(e):(t=t||self).RBush=e()})(it,function(){"use strict";function t(s,d,h,_,m){(function g(x,E,T,w,R){for(;w>T;){if(w-T>600){var A=w-T+1,M=E-T+1,ne=Math.log(A),K=.5*Math.exp(2*ne/3),q=.5*Math.sqrt(ne*K*(A-K)/A)*(M-A/2<0?-1:1),J=Math.max(T,Math.floor(E-M*K/A+q)),Vr=Math.min(w,Math.floor(E+(A-M)*K/A+q));g(x,E,J,Vr,R)}var me=x[E],oe=T,N=w;for(e(x,T,E),R(x[w],me)>0&&e(x,T,w);oe<N;){for(e(x,oe,N),oe++,N--;R(x[oe],me)<0;)oe++;for(;R(x[N],me)>0;)N--}R(x[T],me)===0?e(x,T,N):e(x,++N,w),N<=E&&(T=N+1),E<=N&&(w=N-1)}})(s,d,h||0,_||s.length-1,m||r)}function e(s,d,h){var _=s[d];s[d]=s[h],s[h]=_}function r(s,d){return s<d?-1:s>d?1:0}var n=function(s){s===void 0&&(s=9),this._maxEntries=Math.max(4,s),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function o(s,d,h){if(!h)return d.indexOf(s);for(var _=0;_<d.length;_++)if(h(s,d[_]))return _;return-1}function i(s,d){a(s,0,s.children.length,d,s)}function a(s,d,h,_,m){m||(m=v(null)),m.minX=1/0,m.minY=1/0,m.maxX=-1/0,m.maxY=-1/0;for(var g=d;g<h;g++){var x=s.children[g];l(m,s.leaf?_(x):x)}return m}function l(s,d){return s.minX=Math.min(s.minX,d.minX),s.minY=Math.min(s.minY,d.minY),s.maxX=Math.max(s.maxX,d.maxX),s.maxY=Math.max(s.maxY,d.maxY),s}function u(s,d){return s.minX-d.minX}function p(s,d){return s.minY-d.minY}function c(s){return(s.maxX-s.minX)*(s.maxY-s.minY)}function P(s){return s.maxX-s.minX+(s.maxY-s.minY)}function y(s,d){return s.minX<=d.minX&&s.minY<=d.minY&&d.maxX<=s.maxX&&d.maxY<=s.maxY}function f(s,d){return d.minX<=s.maxX&&d.minY<=s.maxY&&d.maxX>=s.minX&&d.maxY>=s.minY}function v(s){return{children:s,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function C(s,d,h,_,m){for(var g=[d,h];g.length;)if(!((h=g.pop())-(d=g.pop())<=_)){var x=d+Math.ceil((h-d)/_/2)*_;t(s,x,d,h,m),g.push(d,x,x,h)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(s){var d=this.data,h=[];if(!f(s,d))return h;for(var _=this.toBBox,m=[];d;){for(var g=0;g<d.children.length;g++){var x=d.children[g],E=d.leaf?_(x):x;f(s,E)&&(d.leaf?h.push(x):y(s,E)?this._all(x,h):m.push(x))}d=m.pop()}return h},n.prototype.collides=function(s){var d=this.data;if(!f(s,d))return!1;for(var h=[];d;){for(var _=0;_<d.children.length;_++){var m=d.children[_],g=d.leaf?this.toBBox(m):m;if(f(s,g)){if(d.leaf||y(s,g))return!0;h.push(m)}}d=h.pop()}return!1},n.prototype.load=function(s){if(!s||!s.length)return this;if(s.length<this._minEntries){for(var d=0;d<s.length;d++)this.insert(s[d]);return this}var h=this._build(s.slice(),0,s.length-1,0);if(this.data.children.length)if(this.data.height===h.height)this._splitRoot(this.data,h);else{if(this.data.height<h.height){var _=this.data;this.data=h,h=_}this._insert(h,this.data.height-h.height-1,!0)}else this.data=h;return this},n.prototype.insert=function(s){return s&&this._insert(s,this.data.height-1),this},n.prototype.clear=function(){return this.data=v([]),this},n.prototype.remove=function(s,d){if(!s)return this;for(var h,_,m,g=this.data,x=this.toBBox(s),E=[],T=[];g||E.length;){if(g||(g=E.pop(),_=E[E.length-1],h=T.pop(),m=!0),g.leaf){var w=o(s,g.children,d);if(w!==-1)return g.children.splice(w,1),E.push(g),this._condense(E),this}m||g.leaf||!y(g,x)?_?(h++,g=_.children[h],m=!1):g=null:(E.push(g),T.push(h),h=0,_=g,g=g.children[0])}return this},n.prototype.toBBox=function(s){return s},n.prototype.compareMinX=function(s,d){return s.minX-d.minX},n.prototype.compareMinY=function(s,d){return s.minY-d.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(s){return this.data=s,this},n.prototype._all=function(s,d){for(var h=[];s;)s.leaf?d.push.apply(d,s.children):h.push.apply(h,s.children),s=h.pop();return d},n.prototype._build=function(s,d,h,_){var m,g=h-d+1,x=this._maxEntries;if(g<=x)return i(m=v(s.slice(d,h+1)),this.toBBox),m;_||(_=Math.ceil(Math.log(g)/Math.log(x)),x=Math.ceil(g/Math.pow(x,_-1))),(m=v([])).leaf=!1,m.height=_;var E=Math.ceil(g/x),T=E*Math.ceil(Math.sqrt(x));C(s,d,h,T,this.compareMinX);for(var w=d;w<=h;w+=T){var R=Math.min(w+T-1,h);C(s,w,R,E,this.compareMinY);for(var A=w;A<=R;A+=E){var M=Math.min(A+E-1,R);m.children.push(this._build(s,A,M,_-1))}}return i(m,this.toBBox),m},n.prototype._chooseSubtree=function(s,d,h,_){for(;_.push(d),!d.leaf&&_.length-1!==h;){for(var m=1/0,g=1/0,x=void 0,E=0;E<d.children.length;E++){var T=d.children[E],w=c(T),R=(A=s,M=T,(Math.max(M.maxX,A.maxX)-Math.min(M.minX,A.minX))*(Math.max(M.maxY,A.maxY)-Math.min(M.minY,A.minY))-w);R<g?(g=R,m=w<m?w:m,x=T):R===g&&w<m&&(m=w,x=T)}d=x||d.children[0]}var A,M;return d},n.prototype._insert=function(s,d,h){var _=h?s:this.toBBox(s),m=[],g=this._chooseSubtree(_,this.data,d,m);for(g.children.push(s),l(g,_);d>=0&&m[d].children.length>this._maxEntries;)this._split(m,d),d--;this._adjustParentBBoxes(_,m,d)},n.prototype._split=function(s,d){var h=s[d],_=h.children.length,m=this._minEntries;this._chooseSplitAxis(h,m,_);var g=this._chooseSplitIndex(h,m,_),x=v(h.children.splice(g,h.children.length-g));x.height=h.height,x.leaf=h.leaf,i(h,this.toBBox),i(x,this.toBBox),d?s[d-1].children.push(x):this._splitRoot(h,x)},n.prototype._splitRoot=function(s,d){this.data=v([s,d]),this.data.height=s.height+1,this.data.leaf=!1,i(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(s,d,h){for(var _,m,g,x,E,T,w,R=1/0,A=1/0,M=d;M<=h-d;M++){var ne=a(s,0,M,this.toBBox),K=a(s,M,h,this.toBBox),q=(m=ne,g=K,x=void 0,E=void 0,T=void 0,w=void 0,x=Math.max(m.minX,g.minX),E=Math.max(m.minY,g.minY),T=Math.min(m.maxX,g.maxX),w=Math.min(m.maxY,g.maxY),Math.max(0,T-x)*Math.max(0,w-E)),J=c(ne)+c(K);q<R?(R=q,_=M,A=J<A?J:A):q===R&&J<A&&(A=J,_=M)}return _||h-d},n.prototype._chooseSplitAxis=function(s,d,h){var _=s.leaf?this.compareMinX:u,m=s.leaf?this.compareMinY:p;this._allDistMargin(s,d,h,_)<this._allDistMargin(s,d,h,m)&&s.children.sort(_)},n.prototype._allDistMargin=function(s,d,h,_){s.children.sort(_);for(var m=this.toBBox,g=a(s,0,d,m),x=a(s,h-d,h,m),E=P(g)+P(x),T=d;T<h-d;T++){var w=s.children[T];l(g,s.leaf?m(w):w),E+=P(g)}for(var R=h-d-1;R>=d;R--){var A=s.children[R];l(x,s.leaf?m(A):A),E+=P(x)}return E},n.prototype._adjustParentBBoxes=function(s,d,h){for(var _=h;_>=0;_--)l(d[_],s)},n.prototype._condense=function(s){for(var d=s.length-1,h=void 0;d>=0;d--)s[d].children.length===0?d>0?(h=s[d-1].children).splice(h.indexOf(s[d]),1):this.clear():i(s[d],this.toBBox)},n})});var Pe,S,vt,jr,ie,xt,mt,bt,ve={},Pt=[],qr=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function U(t,e){for(var r in e)t[r]=e[r];return t}function St(t){var e=t.parentNode;e&&e.removeChild(t)}function b(t,e,r){var n,o,i,a={};for(i in e)i=="key"?n=e[i]:i=="ref"?o=e[i]:a[i]=e[i];if(arguments.length>2&&(a.children=arguments.length>3?Pe.call(arguments,2):r),typeof t=="function"&&t.defaultProps!=null)for(i in t.defaultProps)a[i]===void 0&&(a[i]=t.defaultProps[i]);return ge(t,a,n,o,null)}function ge(t,e,r,n,o){var i={type:t,props:e,key:r,ref:n,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:o??++vt};return o==null&&S.vnode!=null&&S.vnode(i),i}function ee(t){return t.children}function B(t,e){this.props=t,this.context=e}function Q(t,e){if(e==null)return t.__?Q(t.__,t.__.__k.indexOf(t)+1):null;for(var r;e<t.__k.length;e++)if((r=t.__k[e])!=null&&r.__e!=null)return r.__e;return typeof t.type=="function"?Q(t):null}function Tt(t){var e,r;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((r=t.__k[e])!=null&&r.__e!=null){t.__e=t.__c.base=r.__e;break}return Tt(t)}}function Oe(t){(!t.__d&&(t.__d=!0)&&ie.push(t)&&!xe.__r++||mt!==S.debounceRendering)&&((mt=S.debounceRendering)||xt)(xe)}function xe(){for(var t;xe.__r=ie.length;)t=ie.sort(function(e,r){return e.__v.__b-r.__v.__b}),ie=[],t.some(function(e){var r,n,o,i,a,l;e.__d&&(a=(i=(r=e).__v).__e,(l=r.__P)&&(n=[],(o=U({},i)).__v=i.__v+1,Fe(l,i,o,r.__n,l.ownerSVGElement!==void 0,i.__h!=null?[a]:null,n,a??Q(i),i.__h),Ct(n,i),i.__e!=a&&Tt(i)))})}function Et(t,e,r,n,o,i,a,l,u,p){var c,P,y,f,v,C,s,d=n&&n.__k||Pt,h=d.length;for(r.__k=[],c=0;c<e.length;c++)if((f=r.__k[c]=(f=e[c])==null||typeof f=="boolean"?null:typeof f=="string"||typeof f=="number"||typeof f=="bigint"?ge(null,f,null,null,f):Array.isArray(f)?ge(ee,{children:f},null,null,null):f.__b>0?ge(f.type,f.props,f.key,null,f.__v):f)!=null){if(f.__=r,f.__b=r.__b+1,(y=d[c])===null||y&&f.key==y.key&&f.type===y.type)d[c]=void 0;else for(P=0;P<h;P++){if((y=d[P])&&f.key==y.key&&f.type===y.type){d[P]=void 0;break}y=null}Fe(t,f,y=y||ve,o,i,a,l,u,p),v=f.__e,(P=f.ref)&&y.ref!=P&&(s||(s=[]),y.ref&&s.push(y.ref,null,f),s.push(P,f.__c||v,f)),v!=null?(C==null&&(C=v),typeof f.type=="function"&&f.__k===y.__k?f.__d=u=wt(f,u,t):u=At(t,f,y,d,v,u),typeof r.type=="function"&&(r.__d=u)):u&&y.__e==u&&u.parentNode!=t&&(u=Q(y))}for(r.__e=C,c=h;c--;)d[c]!=null&&(typeof r.type=="function"&&d[c].__e!=null&&d[c].__e==r.__d&&(r.__d=Q(n,c+1)),Mt(d[c],d[c]));if(s)for(c=0;c<s.length;c++)Rt(s[c],s[++c],s[++c])}function wt(t,e,r){for(var n,o=t.__k,i=0;o&&i<o.length;i++)(n=o[i])&&(n.__=t,e=typeof n.type=="function"?wt(n,e,r):At(r,n,n,o,n.__e,e));return e}function At(t,e,r,n,o,i){var a,l,u;if(e.__d!==void 0)a=e.__d,e.__d=void 0;else if(r==null||o!=i||o.parentNode==null)e:if(i==null||i.parentNode!==t)t.appendChild(o),a=null;else{for(l=i,u=0;(l=l.nextSibling)&&u<n.length;u+=2)if(l==o)break e;t.insertBefore(o,i),a=i}return a!==void 0?a:o.nextSibling}function Jr(t,e,r,n,o){var i;for(i in r)i==="children"||i==="key"||i in e||be(t,i,null,r[i],n);for(i in e)o&&typeof e[i]!="function"||i==="children"||i==="key"||i==="value"||i==="checked"||r[i]===e[i]||be(t,i,e[i],r[i],n)}function yt(t,e,r){e[0]==="-"?t.setProperty(e,r):t[e]=r==null?"":typeof r!="number"||qr.test(e)?r:r+"px"}function be(t,e,r,n,o){var i;e:if(e==="style")if(typeof r=="string")t.style.cssText=r;else{if(typeof n=="string"&&(t.style.cssText=n=""),n)for(e in n)r&&e in r||yt(t.style,e,"");if(r)for(e in r)n&&r[e]===n[e]||yt(t.style,e,r[e])}else if(e[0]==="o"&&e[1]==="n")i=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+i]=r,r?n||t.addEventListener(e,i?gt:_t,i):t.removeEventListener(e,i?gt:_t,i);else if(e!=="dangerouslySetInnerHTML"){if(o)e=e.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if(e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in t)try{t[e]=r??"";break e}catch{}typeof r=="function"||(r!=null&&(r!==!1||e[0]==="a"&&e[1]==="r")?t.setAttribute(e,r):t.removeAttribute(e))}}function _t(t){this.l[t.type+!1](S.event?S.event(t):t)}function gt(t){this.l[t.type+!0](S.event?S.event(t):t)}function Fe(t,e,r,n,o,i,a,l,u){var p,c,P,y,f,v,C,s,d,h,_,m=e.type;if(e.constructor!==void 0)return null;r.__h!=null&&(u=r.__h,l=e.__e=r.__e,e.__h=null,i=[l]),(p=S.__b)&&p(e);try{e:if(typeof m=="function"){if(s=e.props,d=(p=m.contextType)&&n[p.__c],h=p?d?d.props.value:p.__:n,r.__c?C=(c=e.__c=r.__c).__=c.__E:("prototype"in m&&m.prototype.render?e.__c=c=new m(s,h):(e.__c=c=new B(s,h),c.constructor=m,c.render=en),d&&d.sub(c),c.props=s,c.state||(c.state={}),c.context=h,c.__n=n,P=c.__d=!0,c.__h=[]),c.__s==null&&(c.__s=c.state),m.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=U({},c.__s)),U(c.__s,m.getDerivedStateFromProps(s,c.__s))),y=c.props,f=c.state,P)m.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(m.getDerivedStateFromProps==null&&s!==y&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(s,h),!c.__e&&c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(s,c.__s,h)===!1||e.__v===r.__v){c.props=s,c.state=c.__s,e.__v!==r.__v&&(c.__d=!1),c.__v=e,e.__e=r.__e,e.__k=r.__k,e.__k.forEach(function(g){g&&(g.__=e)}),c.__h.length&&a.push(c);break e}c.componentWillUpdate!=null&&c.componentWillUpdate(s,c.__s,h),c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(y,f,v)})}c.context=h,c.props=s,c.state=c.__s,(p=S.__r)&&p(e),c.__d=!1,c.__v=e,c.__P=t,p=c.render(c.props,c.state,c.context),c.state=c.__s,c.getChildContext!=null&&(n=U(U({},n),c.getChildContext())),P||c.getSnapshotBeforeUpdate==null||(v=c.getSnapshotBeforeUpdate(y,f)),_=p!=null&&p.type===ee&&p.key==null?p.props.children:p,Et(t,Array.isArray(_)?_:[_],e,r,n,o,i,a,l,u),c.base=e.__e,e.__h=null,c.__h.length&&a.push(c),C&&(c.__E=c.__=null),c.__e=!1}else i==null&&e.__v===r.__v?(e.__k=r.__k,e.__e=r.__e):e.__e=Qr(r.__e,e,r,n,o,i,a,u);(p=S.diffed)&&p(e)}catch(g){e.__v=null,(u||i!=null)&&(e.__e=l,e.__h=!!u,i[i.indexOf(l)]=null),S.__e(g,e,r)}}function Ct(t,e){S.__c&&S.__c(e,t),t.some(function(r){try{t=r.__h,r.__h=[],t.some(function(n){n.call(r)})}catch(n){S.__e(n,r.__v)}})}function Qr(t,e,r,n,o,i,a,l){var u,p,c,P=r.props,y=e.props,f=e.type,v=0;if(f==="svg"&&(o=!0),i!=null){for(;v<i.length;v++)if((u=i[v])&&"setAttribute"in u==!!f&&(f?u.localName===f:u.nodeType===3)){t=u,i[v]=null;break}}if(t==null){if(f===null)return document.createTextNode(y);t=o?document.createElementNS("http://www.w3.org/2000/svg",f):document.createElement(f,y.is&&y),i=null,l=!1}if(f===null)P===y||l&&t.data===y||(t.data=y);else{if(i=i&&Pe.call(t.childNodes),p=(P=r.props||ve).dangerouslySetInnerHTML,c=y.dangerouslySetInnerHTML,!l){if(i!=null)for(P={},v=0;v<t.attributes.length;v++)P[t.attributes[v].name]=t.attributes[v].value;(c||p)&&(c&&(p&&c.__html==p.__html||c.__html===t.innerHTML)||(t.innerHTML=c&&c.__html||""))}if(Jr(t,y,P,o,l),c)e.__k=[];else if(v=e.props.children,Et(t,Array.isArray(v)?v:[v],e,r,n,o&&f!=="foreignObject",i,a,i?i[0]:r.__k&&Q(r,0),l),i!=null)for(v=i.length;v--;)i[v]!=null&&St(i[v]);l||("value"in y&&(v=y.value)!==void 0&&(v!==t.value||f==="progress"&&!v||f==="option"&&v!==P.value)&&be(t,"value",v,P.value,!1),"checked"in y&&(v=y.checked)!==void 0&&v!==t.checked&&be(t,"checked",v,P.checked,!1))}return t}function Rt(t,e,r){try{typeof t=="function"?t(e):t.current=e}catch(n){S.__e(n,r)}}function Mt(t,e,r){var n,o;if(S.unmount&&S.unmount(t),(n=t.ref)&&(n.current&&n.current!==t.__e||Rt(n,null,e)),(n=t.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(i){S.__e(i,e)}n.base=n.__P=null}if(n=t.__k)for(o=0;o<n.length;o++)n[o]&&Mt(n[o],e,typeof t.type!="function");r||t.__e==null||St(t.__e),t.__e=t.__d=void 0}function en(t,e,r){return this.constructor(t,r)}function Gt(t,e,r){var n,o,i;S.__&&S.__(t,e),o=(n=typeof r=="function")?null:r&&r.__k||e.__k,i=[],Fe(e,t=(!n&&r||e).__k=b(ee,null,[t]),o||ve,ve,e.ownerSVGElement!==void 0,!n&&r?[r]:o?null:e.firstChild?Pe.call(e.childNodes):null,i,!n&&r?r:o?o.__e:e.firstChild,n),Ct(i,t)}function Dt(t,e){var r={__c:e="__cC"+bt++,__:t,Consumer:function(n,o){return n.children(o)},Provider:function(n){var o,i;return this.getChildContext||(o=[],(i={})[e]=this,this.getChildContext=function(){return i},this.shouldComponentUpdate=function(a){this.props.value!==a.value&&o.some(Oe)},this.sub=function(a){o.push(a);var l=a.componentWillUnmount;a.componentWillUnmount=function(){o.splice(o.indexOf(a),1),l&&l.call(a)}}),n.children}};return r.Provider.__=r.Consumer.contextType=r}Pe=Pt.slice,S={__e:function(t,e){for(var r,n,o;e=e.__;)if((r=e.__c)&&!r.__)try{if((n=r.constructor)&&n.getDerivedStateFromError!=null&&(r.setState(n.getDerivedStateFromError(t)),o=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(t),o=r.__d),o)return r.__E=r}catch(i){t=i}throw t}},vt=0,jr=function(t){return t!=null&&t.constructor===void 0},B.prototype.setState=function(t,e){var r;r=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=U({},this.state),typeof t=="function"&&(t=t(U({},r),this.props)),t&&U(r,t),t!=null&&this.__v&&(e&&this.__h.push(e),Oe(this))},B.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Oe(this))},B.prototype.render=ee,ie=[],xt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,xe.__r=0,bt=0;var G=class extends Error{code;isTranslationError=!0;constructor(e,r){super(`${e} ${r}`),this.code=e}static is(e){return e?.isTranslationError===!0}};_e(G,"FORMAT_UNAVAILABLE","FormatUnavailable"),_e(G,"INVALID_PARAMETER","InvalidParameter"),_e(G,"KEY_NOT_FOUND","KeyNotFound");function ze(t){return t[1]??"variable"}function kt(t,e){let r=t[0];return e!==void 0&&Object.prototype.hasOwnProperty.call(e,r)?""+e[r]:r}function It(t,e){let{length:r}=e,n=ze(t);if(t.length-2>r)throw new G(G.INVALID_PARAMETER,`too many parameters for format '${n}'`);for(let o=0;o<r;++o)e[o].call(null,t[2+o],n,o)}function tn(t,e,r){rn(t)&&Array.isArray(nn(t))||on("a map of messages",e,r)}function rn(t){return t!==null&&typeof t=="object"}function nn(t){for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function on(t,e,r){throw new G(G.INVALID_PARAMETER,`expected parameter ${r+1} of format '${e}' to be ${t}`)}var sn=[tn],an=[],dn=Object.freeze({__proto__:null,select:()=>(t,e)=>{It(t,sn);let r=t[2];if(!r.other)throw new G(G.INVALID_PARAMETER,`messages of format '${ze(t)}' must contain the key 'other'`);let n={};for(let o in r)n[o]=e.interpret(r[o]);return o=>(n[kt(t,o)]??n.other)(o)},variable:()=>t=>(It(t,an),e=>kt(t,e))}),L=class extends Error{input;at;isParseError=!0;constructor(e,r,n){super(e),this.input=r,this.at=n}toString(){let e=Math.max(this.input.lastIndexOf(`
`,this.at-1),0)+1,r=this.input.indexOf(`
`,this.at+1);r===-1?r=this.input.length:this.input[r-1]==="\r"&&--r;let n=`${this.input.slice(e,r)}
${" ".repeat(this.at-e)}^`;return`${this.message} at pos ${this.at}:

${n}

${this.stack}`}static is(e){return e?.isParseError===!0}};function Ot(t){return t===32||t>=9&&t<=13||t===133||t===160||t===6158||t>=8192&&t<=8205||t===8232||t===8233||t===8239||t===8287||t===8288||t===12288||t===65279}function H(t,e){let{length:r}=t,n=e;for(;n<r&&Ot(t.charCodeAt(n));)++n;return n}function se(t,e){let{length:r}=t,n,o=e;for(;o<r&&(n=t[o],n!=="{"&&n!=="}"&&n!==","&&n!=="#"&&n!=="'"&&n!==":"&&!Ot(n.charCodeAt(0)));)++o;if(e===o)throw new L(`expected an identifier but ${n?`saw '${n}'`:"saw the end of pattern"} instead`,t,e);return t.slice(e,o)}function Nt(t,e,r){let{length:n}=t,o,i=e,a=e,l="";for(;a<n&&(o=t[a],!(o==="{"||o==="}"||r&&o==="#"));){if(o==="'"){if(o=t[++a],o==="'")l+=t.slice(i,a),i=a+1;else if(o==="{"||o==="}"||r&&o==="#"){for(l+=t.slice(i,a-1),i=a;++a<n;)if(o=t[a],o==="'"){if(o=t[a+1],o!=="'")break;l+=t.slice(i,++a),i=a+1}l+=t.slice(i,a),i=++a}}++a}return l+=t.slice(i,a),l}function Ft(t,e,r,n){let{length:o}=t,i={};r.push(i);let a,l=n,u=[],p=Ve(t,e,u,!0);for(i[l]=u;p<o&&(p=H(t,p),a=t[p],a!==","&&a!=="}");){if(l=se(t,p),p=H(t,p+l.length),a=t[p],a!=="{")throw new L("expected '{'",t,p);u=[],p=Ve(t,p+1,u,!0),i[l]=u}return p}function ln(t,e,r,n){let{length:o}=t,i={};r.push(i);let a,l=n,u=H(t,e),p=se(t,u);for(u+=p.length,i[l]=p;u<o&&(u=H(t,u),a=t[u],a!==","&&a!=="}");){if(l=se(t,u),u=H(t,u+l.length),a=t[u],a==="{")return Ft(t,u+1,r,l);if(a!==":")throw new L("expected ':' or '{'",t,u);u=H(t,u+1),p=se(t,u),u+=p.length,i[l]=p}return u}function cn(t,e,r){let n=e,o=t[n];if(o==="#")return r.push("#"),n+1;if(o!=="{")throw new L("expected '#' or '{'",t,n);let{length:i}=t;do{n=H(t,n+1);let a=se(t,n);switch(n=H(t,n+a.length),o=t[n],o){case",":case"}":r.push(a);break;case"{":if(r.length<2)throw new L("expected an identifier but saw a message instead",t,n);n=Ft(t,n+1,r,a),o=t[n];break;case":":if(r.length<2)throw new L("expected an identifier but saw an attribute instead",t,n);n=ln(t,n+1,r,a),o=t[n];break;default:throw new L(`unexpected character '${o}'`,t,n)}}while(n<i&&o!=="}");return n+1}function Ve(t,e,r,n){let o,i=e,a=Nt(t,i,n);a&&(r.push(a),i+=a.length);let{length:l}=t;for(;i<l;){if(o=t[i],o==="}"){if(!n)throw new L("unexpected '}'",t,i);++i;break}let u=[];i=cn(t,i,u),r.push(u),a=Nt(t,i,n),a&&(r.push(a),i+=a.length)}return i}function Lt(t){let e=[];return Ve(t,0,e,!1),e}function Vt(t,e,r){for(let n in t){if(n.startsWith("$"))continue;let o=t[n];switch(typeof o){case"string":e[r+n]=o;break;case"object":o!==null&&Vt(o,e,`${r}${n}.`)}}return e}function un(t){return Vt(t,{},"")}function Bt(t,e){let r={};for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=e(t[n],n));return r}var zt=class{formatProvider;constructor(e){this.formatProvider=e}interpret(e,r){let{length:n}=e;if(n===1)return this.interpretElement(e[0],r);let o=new Array(n);for(let i=0;i<n;++i)o[i]=this.interpretElement(e[i],r);return pn.bind(null,o)}interpretElement(e,r){if(typeof e=="string")return()=>e;let n=e;if(n.length===1&&n[0]==="#"){if(r===void 0)return()=>"#";n=[r]}return this.formatProvider.getFormat(n)(n,this)}};function pn(t,e){let r="";for(let n=0;n<t.length;++n)r+=t[n](e);return r}var Ut=class{formatMap;constructor(e){this.formatMap=e}getFormat(e){let r=ze(e),n=this.formatMap[r];if(!n)throw new G(G.FORMAT_UNAVAILABLE,r);return n}},te;(function(t){t[t.Eager=0]="Eager",t[t.Lazy=1]="Lazy",t[t.Off=2]="Off"})(te||(te={}));var ae=class{cacheMode;expansions;interpreter;constructor({cacheMode:e,interpreter:r,translations:n}){this.cacheMode=e??te.Lazy,this.interpreter=r,this.expansions=un(n),e===te.Eager&&(this.expansions=Bt(this.expansions,o=>r.interpret(Lt(o))))}expand(e,r){let n=this.expansions[e];if(n===void 0)throw new G(G.KEY_NOT_FOUND,e);return typeof n=="string"&&(n=this.interpreter.interpret(Lt(n)),this.cacheMode!==te.Off&&(this.expansions[e]=n)),n(r)}static fromLocale(e,r=dn){let n=Bt(r,(i,a)=>i(e.$format?.[a])),o=new Ut(n);return new ae({cacheMode:te.Lazy,interpreter:new zt(o),translations:e})}};var de,k,Ht,Te=0,jt=[],Yt=S.__b,Xt=S.__r,Wt=S.diffed,Kt=S.__c,Zt=S.unmount;function Ee(t,e){S.__h&&S.__h(k,t,Te||e),Te=0;var r=k.__H||(k.__H={__:[],__h:[]});return t>=r.__.length&&r.__.push({}),r.__[t]}function qt(t){return Te=1,He(Qt,t)}function He(t,e,r){var n=Ee(de++,2);return n.t=t,n.__c||(n.__=[r?r(e):Qt(void 0,e),function(o){var i=n.t(n.__[0],o);n.__[0]!==i&&(n.__=[i,n.__[1]],n.__c.setState({}))}],n.__c=k),n.__}function we(t,e){var r=Ee(de++,3);!S.__s&&Xe(r.__H,e)&&(r.__=t,r.__H=e,k.__H.__h.push(r))}function Jt(t,e){var r=Ee(de++,4);!S.__s&&Xe(r.__H,e)&&(r.__=t,r.__H=e,k.__h.push(r))}function Ae(t){return Te=5,Ye(function(){return{current:t}},[])}function Ye(t,e){var r=Ee(de++,7);return Xe(r.__H,e)&&(r.__=t(),r.__H=e,r.__h=t),r.__}function hn(){for(var t;t=jt.shift();)if(t.__P)try{t.__H.__h.forEach(Se),t.__H.__h.forEach(Ue),t.__H.__h=[]}catch(e){t.__H.__h=[],S.__e(e,t.__v)}}S.__b=function(t){k=null,Yt&&Yt(t)},S.__r=function(t){Xt&&Xt(t),de=0;var e=(k=t.__c).__H;e&&(e.__h.forEach(Se),e.__h.forEach(Ue),e.__h=[])},S.diffed=function(t){Wt&&Wt(t);var e=t.__c;e&&e.__H&&e.__H.__h.length&&(jt.push(e)!==1&&Ht===S.requestAnimationFrame||((Ht=S.requestAnimationFrame)||function(r){var n,o=function(){clearTimeout(i),$t&&cancelAnimationFrame(n),setTimeout(r)},i=setTimeout(o,100);$t&&(n=requestAnimationFrame(o))})(hn)),k=null},S.__c=function(t,e){e.some(function(r){try{r.__h.forEach(Se),r.__h=r.__h.filter(function(n){return!n.__||Ue(n)})}catch(n){e.some(function(o){o.__h&&(o.__h=[])}),e=[],S.__e(n,r.__v)}}),Kt&&Kt(t,e)},S.unmount=function(t){Zt&&Zt(t);var e,r=t.__c;r&&r.__H&&(r.__H.__.forEach(function(n){try{Se(n)}catch(o){e=o}}),e&&S.__e(e,r.__v))};var $t=typeof requestAnimationFrame=="function";function Se(t){var e=k,r=t.__c;typeof r=="function"&&(t.__c=void 0,r()),k=e}function Ue(t){var e=k;t.__c=t.__(),k=e}function Xe(t,e){return!t||t.length!==e.length||e.some(function(r,n){return r!==t[n]})}function Qt(t,e){return typeof e=="function"?e(t):e}var We={isLoading:!0,t:()=>""},fn=Dt(We),Ce=class extends B{state=We;pendingFetch;componentDidMount(){this.fetchLocale()}componentDidUpdate(e){let r=this.props;e.url!==r.url&&this.fetchLocale()}componentWillUnmount(){this.pendingFetch?.abort()}render(){return b(fn.Provider,{children:this.props.children,value:this.state})}async fetchLocale(){try{this.setState(We),this.pendingFetch=new AbortController;let{credentials:e,headers:r,url:n}=this.props,o=await fetch(n,{credentials:e,headers:r,method:"GET",signal:this.pendingFetch.signal});if(!o.ok)throw new Error(`unexpected HTTP response ${o.status} - ${o.statusText}`);let i=await o.json(),a=ae.fromLocale(i,this.props.formats);this.setState({isLoading:!1,t:mn.bind(null,a)})}catch(e){this.props.onError?.(e),this.setState({isLoading:!1,t:()=>""})}finally{this.pendingFetch=void 0}}};function mn(t,e,r){try{return typeof e=="string"?t.expand(e,r):t.expand(e.key,e.vars)}catch(n){let o;return o=G.is(n)?n.message:L.is(n)?"ParseError":"UnknownError",`⚠️ ${o}`}}var re=()=>b("div",{class:"box-decorator"});function O(t,e){let r=t;for(let n in e)e[n]&&(r+=` ${t}--${n}`);return r}function Re(){let{length:t}=arguments,e="";for(let r,n=0;n<t;++n)(r=arguments[n])&&(e+=(e&&" ")+r);return e}function yn(t,e){return[e]}function Me(t){let e=[t],r=He(yn,e);return we(()=>{r[0][0]!==t&&r[1](t)},e),[r[0][0],r[1]]}function Ge(t,e){let r=t[0]==="-",n=r?1:0;for(;n<t.length&&t[n]==="0";)++n;let o=n;for(;n<t.length&&t[n]!==".";)++n;let i=n;for(n=t.length-1;n>i&&t[n]==="0";)--n;let a=n===i?n:n+1,l=t.slice(o,a);if(o===a)return e&&(e.isNegative=!1,e.isZero=!0,e.separatorAt=1),"0";let u=(r?"-":"")+(o===i&&i!==a?"0":"");return e&&(e.isNegative=r,e.isZero=!1,e.separatorAt=u.length+i-o),u+l}function Ke(t,e){let r={},n=Ge(t,r),o={},i=Ge(e,o),a=r.isNegative?-1:1;if(r.isNegative!==o.isNegative)return r.isZero&&o.isZero?0:a;if(r.separatorAt!==o.separatorAt)return a*(r.separatorAt-o.separatorAt);let l=r.isNegative?1:0,u;do u=n.charCodeAt(l)-i.charCodeAt(l);while(u===0&&++l<r.separatorAt);let p=Math.max(n.length,i.length);for(;u===0&&++l<p;)u=(l<n.length?n.charCodeAt(l):48)-(l<i.length?i.charCodeAt(l):48);return a*u}var tr=/^\s*-?[0-9\s]*(?:\s*[.,][0-9\s]*)?$/,_n={sign:"",significant:"0",separator:"",fractional:"",concat:"0"};function gn(t,e,r,n){if(!t||!tr.test(t))return n.index=1,_n;let o="",i="",a=-1,l="",u=0,p=0,c=0,P=0,y=()=>{l+=t.slice(u,p),u=p+1};for(;p<t.length;){let C=t.charCodeAt(p);C===46||C===44?(i=".",a=p-P):(C<48||C>57)&&(y(),++P,C===45?o="-":p<n.index&&++c),++p}y(),n.index-=c,a===-1&&(a=l.length);let f=l.slice(0,a)||"0";e>=1&&(n.index>e&&(n.index-=Math.max(f.length-e,0)),f=f.slice(0,e));let v=l.slice(a+1);return r>=0&&(v=v.slice(0,r),r===0&&(i="")),{sign:o,separator:i,significant:f,fractional:v,concat:l}}function er(t,e,r,n){let o=t,i=t.length+(r-1)%e+1;for(;i>e;)i-=e,o=o.slice(0,i)+" "+o.slice(i),n&&i<n.index&&++n.index;return o}var rr=t=>{let e=Ae(null),[r,n]=Me(t.value??""),{groupBy:o=0,maxFractional:i=-1,maxSignificant:a=-1}=t,l={index:e.current?.selectionStart??0},u=!r||r==="0"||r==="-0",p=gn(r,a,i,l),c=(o>0?er(p.significant,o,0,l):p.significant)+p.separator+p.fractional;Jt(()=>{e.current&&e.current===document.activeElement&&e.current.setSelectionRange(l.index,l.index)});let P=s=>{if(e.current&&s.target!==e.current){s.preventDefault(),e.current.focus();let d=e.current.getBoundingClientRect(),h=s.x<(d.left+d.right)/2?0:e.current.value.length;e.current.setSelectionRange(h,h)}},y=()=>{let{maxValue:s,minValue:d,onChange:h}=t,_=p.sign+p.concat,m=_;d&&Ke(m,d)<0?m=d:s&&Ke(m,s)>0&&(m=s),m=Ge(m),m!==_&&n(m),h(m)},f=()=>{let s=e.current?.value??"0";n((p.sign?"":"-")+s)},v=s=>{if(s.target!==e.current)return;let d=e.current,h=d.value,_=d.selectionStart??h.length,m=d.selectionEnd??h.length;if(!s.data){s.inputType==="deleteContentBackward"&&p.sign&&(_===0||u&&_===h.length)&&(s.preventDefault(),f());return}if(s.data==="-"&&!p.sign&&(_===0||u)){s.preventDefault(),f();return}let g=h.slice(0,_)+s.data+h.slice(m);tr.test(g)||s.preventDefault()},C=s=>{if(s.target!==e.current)return;let d=e.current.value;u&&e.current.selectionStart===d.length&&/^0[^0]/.test(d)&&(d=d.slice(1)),n(p.sign+d)};return b("div",{class:"field-number",onPointerDown:P},b("span",{onClick:f,children:p.sign?"- ":"+ ",class:Re("field-number__text",O("field-number__sign",{negative:Boolean(p.sign)}))}),(()=>{let s=p.significant.length;if(s>=a)return null;let d="0".repeat(a-s);return b("span",{class:"field-number__text"},o>0?er(d,o,s):d)})(),b("div",{class:"field-number__input-wrapper"},b("span",{class:"field-number__text field-number__phantom"},c),b("input",{class:"field-number__input",ref:e,type:"text",inputMode:"decimal",value:c,onBlur:y,onbeforeinput:v,onInput:C})),p.fractional.length<i?b("span",{class:"field-number__text"},(p.separator?"":".")+"0".repeat(i-p.fractional.length)):null,b(re,null))};var vn=[.85,0,.821,-.22,.736,-.425,.601,-.601,.425,-.736,.22,-.821,0,-.85,-.22,-.821,-.425,-.736,-.601,-.601,-.736,-.425,-.821,-.22,-.85,-0,-.821,.22,-.736,.425,-.601,.601,-.425,.736,-.22,.821,-0,.85,.22,.821,.425,.736,.601,.601,.736,.425,.821,.22],xn=[.85,-.85,-.85,-.85,-.85,.85,.85,.85],bn=[1,0,0,-1,-1,-0,-0,1],Pn=[1,-.85,-1,-.85,-0,.85],Sn=[.577,0,.866,-.5,.289,-.5,0,-1,-.289,-.5,-.866,-.5,-.577,-0,-.866,.5,-.289,.5,-0,1,.289,.5,.866,.5],De=[vn,xn,bn,Pn,Sn];var nr=({shape:t,resolution:e=100})=>{let r=Ye(()=>{let n=e/2,o="";for(let i=0;i<t.length;i+=2)o+=`${Math.round(n+t[i]*n)},${Math.round(n+t[i+1]*n)} `;return o},[t,e]);return b("svg",{class:"field-shape__preview",viewBox:`0 0 ${e} ${e}`},b("polygon",{points:r}))};var or=({onChange:t,value:e=0})=>b("div",{class:"field-shape"},De.map((r,n)=>b("button",{class:O("field-shape__button",{selected:n===e}),type:"button",key:n,onClick:()=>t(n)},b(nr,{shape:r}))));function le(t,e){if(!e)return!1;let r=t;for(;r&&r!==e;)r=r.parentNode;return r&&r===e}var ir={capture:!1,passive:!0};function sr(t,e,r){return t.addEventListener(e,r,ir),()=>t.removeEventListener(e,r,ir)}var ar=({children:t,class:e,isOpen:r,onClose:n})=>{let o=Ae(null);return we(()=>n?sr(window,"pointerdown",a=>{le(a.target,o.current)||n(a)}):void 0),b("div",{class:Re(O("popup",{open:r}),e),ref:o},b("div",{class:"popup__content"},t))};var Ze=class extends B{state={navIndex:0,isOpen:!1,search:""};inputRef=null;filteredOptions=null;render({options:e,value:r},{navIndex:n,isOpen:o,search:i}){let a=i.toLowerCase(),l=[];this.filteredOptions=[];let u=-1;for(let p=0;p<e.length;++p){let c=e[p],P=c.value===r;P&&(u=p);let y=-1;if(i&&(y=c.title.toLowerCase().indexOf(a))===-1)continue;let f=y+a.length;l.push(b("li",{key:p,onClick:()=>this.selectOption(c),class:O("field-select__option",{selected:P,nav:n===this.filteredOptions.length})},y===-1?c.title:b(ee,null,c.title.slice(0,y),b("span",{class:"field-select__search"},c.title.slice(y,f)),c.title.slice(f)))),this.filteredOptions.push(c)}return b("div",{class:O("field-select",{open:o}),onfocusout:this.onFocusOut},b("input",{class:"field-select__input",type:"text",ref:this.onInputRef,onKeyDown:this.onKeyDown,onInput:this.onInput,onClick:()=>this.toggleDropdown(),placeholder:e[u]?.title,value:o?i:""}),b(ar,{class:"field-select__popup",isOpen:o},b("ul",{class:"field-select__list"},l)),b(re,null))}componentDidMount(){window.addEventListener("pointerdown",this.onPagePointerDown,{passive:!0})}componentWillUnmount(){window.removeEventListener("pointerdown",this.onPagePointerDown)}toggleDropdown(e=!this.state.isOpen){this.state.isOpen!==e&&this.setState({isOpen:e,search:e?"":this.state.search})}selectOption(e){this.props.onChange(e.value),this.toggleDropdown(!1),this.inputRef?.focus()}onPagePointerDown=e=>{le(e.target,this.inputRef?.parentElement)||this.toggleDropdown(!1)};onFocusOut=e=>{e.relatedTarget&&!le(e.relatedTarget,this.inputRef?.parentElement)&&this.toggleDropdown(!1)};onInputRef=e=>{this.inputRef=e};onInput=()=>{this.setState({isOpen:!0,search:this.inputRef?.value,navIndex:0})};onKeyDown=e=>{let r=this.filteredOptions??this.props.options,{navIndex:n}=this.state;switch(e.code){case"ArrowUp":this.setState({isOpen:!0,navIndex:Math.max(n-1,0)});break;case"ArrowDown":this.setState({isOpen:!0,navIndex:Math.min(n+1,r.length-1)});break;case"Enter":case"NumpadEnter":this.state.isOpen&&n<r.length&&this.selectOption(r[n]);break;case"Escape":this.toggleDropdown(!1);break;default:return}e.preventDefault()}};var dr=({onChange:t,value:e})=>{let[r,n]=Me(e??"");return b("div",{class:"field-text"},b("input",{class:"field-text__input",type:"text",value:r,onInput:o=>n(o.target.value),onChange:()=>t(r)}),b(re,null))};var $e=class{fields=[];add(e){return this.fields.push(e),this}};var lr=({fieldSet:t,onChange:e,value:r})=>b("div",{class:"field-set-editor"},t.fields.map(n=>b("div",{class:"field-set-editor__field"},b("span",{class:"field-set-editor__label"},n.title),b(n.kind,{...n.params,key:n.key,value:r?.[n.key],title:n.title,onChange(o){r?.[n.key]!==o&&e({...r,[n.key]:o})}}))));var Tn=new $e().add({key:"shape",kind:or,title:"Shape"}).add({key:"title",kind:dr,title:"Encounter Title"}).add({key:"minLevel",kind:rr,title:"Minimum Required Level",params:{minValue:"-1000000",maxValue:"1000000",maxSignificant:7,maxFractional:3,groupBy:3}}).add({key:"forClass",kind:Ze,title:"For Class",params:{options:[{value:0,title:"Warrior"},{value:1,title:"Mage"},{value:2,title:"Ranger"}]}}),cr=()=>{let[t,e]=qt();return console.log(t),b(Ce,{url:"./locale/en.json"},b(lr,{fieldSet:Tn,value:t,onChange:e}))};function V(){this.t=[]}function F(){this.i=new Set,this.u=[]}function ur(t){return t&&typeof t.then=="function"}function En(t,e,r){return new Promise((n,o)=>{let{length:i}=e,a=0,l=()=>{--a==0&&n()};for(let u=0;u<i;++u){let p=e[u].call(t,r);ur(p)&&(++a,p.then(l,o))}})}function wn(t,e,r){return new Promise((n,o)=>{let{length:i}=e,a=0,l=()=>{if(a>=i)return void n();let u=e[a++].call(t,r);ur(u)?u.then(l,o):l()};l()})}V.prototype.o=null,V.prototype.h=function(){return this.o||(this.o=this.t.slice()),this.o},V.prototype.l=function(t){this.t.push(t),this.o=null},V.prototype.g=function(){return this.t.length!==0&&(this.t=[],this.o=null,!0)},V.prototype.m=function(){return this.t.length},V.prototype.P=function(t){let{t:e}=this,r,n=e.length-1;for(;n>=0&&(r=e[n],r!==t&&r.p!==t);)--n;return n!==-1&&(this.t.splice(n,1),this.o=null,!0)},V.prototype.v=function(t){let e=this.t.lastIndexOf(t);e!==-1&&(this.t.splice(e,1),this.o=null)},F.prototype.o=null,F.prototype.h=function(){return this.o||(this.o=Array.from(this.i.values()).concat(this.u)),this.o},F.prototype.l=function(t){if(t.p){if(this.i.has(t.p))return;this.u.push(t)}else this.i.add(t),this.A(t);this.o=null},F.prototype.g=function(){return!!this.m()&&(this.i.clear(),this.u=[],this.o=null,!0)},F.prototype.m=function(){return this.i.size+this.u.length},F.prototype.P=function(t){return this.i.delete(t)?(this.o=null,!0):this.A(t)},F.prototype.v=function(t){let e=this.u.lastIndexOf(t);e!==-1&&(this.u.splice(e,1),this.o=null)},F.prototype.A=function(t){let e=this.u.length-1;for(;e>=0;){if(this.u[e].p===t)return this.u.splice(e,1),this.o=null,!0;--e}return!1};var An={array:V,set:F};function Z(t={}){let e=new(An[t.backend]??V),r=t.async===!0,n=r?function(o,i){let a=i?.parallel?En:wn;return function(l){return a(this,o.h(),l)}}(e,t):function(o,i){return function(a){let l=o.h(),{length:u}=l;for(let p=0;p<u;++p)l[p].call(this,a)}}(e);return n.S=e,n.isAsync=r,n}function Cn(t,e){let r=!1,n=function(o){if(!r)return t.S.v(n),r=!0,e.call(this,o)};n.p=e,t.S.l(n)}function ce(t,e,r){r?.once?Cn(t,e):t.S.l(e)}var D={x:0,y:0};function ue(t,e){let r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)}function $(t,e=0,r=1){return t<e?e:t>r?r:t}function I(t){return Math.abs(t)<Number.EPSILON}var pe=class{press=Z();longPress=Z();multiPress=Z();acceptsNewPointers=!0;editor;state=0;longPressDelay;maxPressDistance;multiPressDelay;longPressTimeout;multiPressCount=0;multiPressTime=0;constructor(e){this.editor=e.editor,this.longPressDelay=e.longPressDelay??800,this.maxPressDistance=e.maxPressDistance??10,this.multiPressDelay=e.multiPressDelay??400}handlePointerDown(e,r){if(r.length>1){this.onChangeState(4);return}this.state=1,this.onMultiPress(e.editor,!1),this.longPressTimeout=setTimeout(()=>this.onLongPress(e.editor),this.longPressDelay)}handlePointerMove(e,r){ue(e.start,e)>this.maxPressDistance&&this.onChangeState(2)}handlePointerUp(e,r){this.state===1&&(this.press(e.editor),this.onMultiPress(e.editor,!0)),this.onChangeState(0)}onChangeState(e){this.longPressTimeout!==void 0&&(clearTimeout(this.longPressTimeout),this.longPressTimeout=void 0),this.state=e}onLongPress(e){this.longPressTimeout=void 0,this.longPress(e),this.onChangeState(3)}onMultiPress(e,r){let n=performance.now();n-this.multiPressTime>this.multiPressDelay?this.multiPressCount=0:r&&++this.multiPressCount>=2&&this.multiPress(e),this.multiPressTime=n}};var qe=class extends pe{drag=Z();drop=Z();offset={...D};isDragging=!1;edgeProximity;pushSpeedBasis;pushSpeed={...D};start={...D};animationHandle;lastTimestamp;lastPoint;constructor(e){super(e);this.edgeProximity=e.edgeProximity??64,this.pushSpeedBasis=e.pushSpeed??.5}handlePointerDown(e,r){this.acceptsNewPointers=!1,this.isDragging=!0,this.lastPoint=e,this.start=e.editor,this.offset={...D},this.startPushAnimation(e),super.handlePointerDown(e,r)}handlePointerMove(e,r){this.lastPoint=e,this.offset.x=e.editor.x-this.start.x,this.offset.y=e.editor.y-this.start.y,this.drag(this.offset),this.startPushAnimation(e),super.handlePointerMove(e,r)}handlePointerUp(e,r){this.acceptsNewPointers=!0,this.isDragging=!1,this.stopPushAnimation(),this.drop(this.offset),super.handlePointerUp(e,r)}startPushAnimation(e){this.pushSpeed.x=this.pushSpeedBasis*($(1-(e.x-this.editor.edgeTopLeft.x)/this.edgeProximity)-$(1-(this.editor.edgeBottomRight.x-e.x)/this.edgeProximity)),this.pushSpeed.y=this.pushSpeedBasis*($(1-(e.y-this.editor.edgeTopLeft.y)/this.edgeProximity)-$(1-(this.editor.edgeBottomRight.y-e.y)/this.edgeProximity)),!I(this.pushSpeed.x)||!I(this.pushSpeed.y)?this.animationHandle===void 0&&(this.lastTimestamp=void 0,this.animationHandle=requestAnimationFrame(this.onTick)):this.stopPushAnimation()}stopPushAnimation(){this.animationHandle!==void 0&&(cancelAnimationFrame(this.animationHandle),this.animationHandle=void 0)}onTick=e=>{let r=0;this.lastTimestamp!==void 0&&(r=e-this.lastTimestamp),this.editor.setOffset({x:this.pushSpeed.x*r,y:this.pushSpeed.y*r}),this.offset=this.editor.clientToEditorSpace(this.lastPoint),this.offset.x-=this.start.x,this.offset.y-=this.start.y,this.drag(this.offset),this.lastTimestamp=e,this.animationHandle=requestAnimationFrame(this.onTick)}};var Je=class extends pe{usePointerLock;pinchInitDistance=0;pinchInitZoom=1;isPointerLocked=!1;isPointerLockEligible=!1;constructor(e){super(e);this.usePointerLock=e.usePointerLock??!1,this.usePointerLock&&document.addEventListener("pointerlockchange",this.onPointerLockChange)}dispose(){this.usePointerLock&&document.removeEventListener("pointerlockchange",this.onPointerLockChange)}handlePointerDown(e,r){super.handlePointerDown(e,r),this.isPointerLockEligible=this.usePointerLock&&r.length===1&&e.type==="mouse",r.length===2&&(this.pinchInitDistance=ue(r[0],r[1]),this.pinchInitZoom=this.editor.zoom,this.acceptsNewPointers=!1)}handlePointerMove(e,r){if(super.handlePointerMove(e,r),this.state!==3)if(r.length===2){let n=r[1]===e?r[0]:r[1],o=ue(e,n);this.editor.setZoom(this.pinchInitZoom*o/this.pinchInitDistance,{x:(e.x+n.x)/2,y:(e.y+n.y)/2},!1),this.editor.setOffset({x:(e.x+n.x)/2-(e.x-e.delta.x+n.x)/2,y:(e.y+n.y)/2-(e.y-e.delta.y+n.y)/2})}else this.editor.setOffset({x:e.delta.x,y:e.delta.y})}handlePointerUp(e,r){super.handlePointerUp(e,r),this.acceptsNewPointers=!0,this.isPointerLocked&&document.exitPointerLock()}onChangeState(e){super.onChangeState(e),this.isPointerLockEligible&&e===2&&this.editor.canvas?.requestPointerLock()}onPointerLockChange=()=>{this.isPointerLocked=document.pointerLockElement===this.editor.canvas}};var pr=window.devicePixelRatio||1,Qe=class extends B{zoom;offset={...D};canvas=null;edgeTopLeft={...D};edgeBottomRight={...D};canvasCssClass;pointers=[];rawOffset={...D};rawZoom;gesture=null;frameHandle;observer;constructor(e,r){super(e,r);let n=Math.max((e.minZoom+e.maxZoom)/2,Number.EPSILON);this.zoom=n,this.rawZoom=n}componentDidMount(){let e={passive:!0};window.addEventListener("pointermove",this.onPointerMove,e),window.addEventListener("pointerup",this.onPointerLost,e),window.addEventListener("pointercancel",this.onPointerLost,e)}componentWillUnmount(){window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerLost),window.removeEventListener("pointercancel",this.onPointerLost),this.observer?.disconnect(),this.observer=void 0,this.frameHandle!==void 0&&(cancelAnimationFrame(this.frameHandle),this.frameHandle=void 0)}shouldComponentUpdate(){return!1}render(){return b("canvas",{class:this.canvasCssClass,onContextMenu:hr,onLostPointerCapture:this.onPointerLost,onPointerDown:this.onPointerDown,onWheel:this.onWheel,ref:this.onCanvasRef})}updateView(){this.frameHandle??=requestAnimationFrame(this.onFrame)}clientToEditorSpace(e){return{x:(e.x-(this.edgeTopLeft.x+this.edgeBottomRight.x)/2-this.offset.x)/this.zoom,y:(e.y-(this.edgeTopLeft.y+this.edgeBottomRight.y)/2-this.offset.y)/this.zoom}}getVisibleRect(){return{topLeft:this.clientToEditorSpace(this.edgeTopLeft),bottomRight:this.clientToEditorSpace(this.edgeBottomRight)}}setOffset(e,r=!0){this.rawOffset.x=(r?this.rawOffset.x:0)+e.x,this.rawOffset.y=(r?this.rawOffset.y:0)+e.y;let n=this.getOffsetAdjustment(this.rawOffset);(!I(n.x-this.offset.x)||!I(n.y-this.offset.y))&&(this.offset.x=n.x,this.offset.y=n.y,this.updateView())}setZoom(e,r,n=!0){this.rawZoom=$((n?this.rawZoom:0)+e,Math.max(this.props.minZoom,Number.EPSILON),this.props.maxZoom);let o=this.getZoomAdjustment(this.rawZoom),i=this.zoom-o;if(I(i))return;let a=this.clientToEditorSpace(r);this.setOffset({x:i*a.x,y:i*a.y}),this.zoom=o,this.updateView()}getOffsetAdjustment(e){return e}getZoomAdjustment(e){return e}getWheelDeltaAdjustment(e){return 1}updateLayout(e=this.canvas.getBoundingClientRect()){this.edgeTopLeft.y=e.top,this.edgeTopLeft.x=e.left,this.edgeBottomRight.y=e.bottom,this.edgeBottomRight.x=e.right}onPointerDown=e=>{let r=this.clientToEditorSpace(e);if(this.gesture===null&&(this.updateLayout(),this.gesture=this.hitTest(r,e)),this.gesture?.acceptsNewPointers===!0){let n={id:e.pointerId,type:e.pointerType,delta:{...D},editor:r,start:{x:e.x,y:e.y},x:e.x,y:e.y};this.pointers.push(n),this.gesture.handlePointerDown(n,this.pointers)}};onPointerMove=e=>{let r=this.pointers.find(({id:n})=>e.pointerId===n);!r||(r.delta.x=e.movementX/pr,r.delta.y=e.movementY/pr,r.type==="mouse"&&document.pointerLockElement?(r.x+=r.delta.x,r.y+=r.delta.y):(r.x=e.x,r.y=e.y),r.editor=this.clientToEditorSpace(r),this.gesture.handlePointerMove(r,this.pointers))};onPointerLost=e=>{let r=this.pointers.findIndex(({id:o})=>e.pointerId===o);if(r===-1)return;let n=this.pointers[r];this.gesture.handlePointerUp(n,this.pointers),this.pointers.splice(r,1),this.pointers.length===0&&(this.gesture=null)};onWheel=e=>{hr(e);let r=-this.getWheelDeltaAdjustment(e);e.ctrlKey?(r/=(this.edgeBottomRight.y-this.edgeTopLeft.y)/3,this.setZoom(e.deltaY*r,e)):this.setOffset({x:(e.shiftKey?e.deltaY:e.deltaX)*r,y:(e.shiftKey?e.deltaX:e.deltaY)*r})};onCanvasRef=e=>{let r=this.canvas;r&&this.observer.unobserve(r),e&&(this.canvasAcquired(e),this.observer??=new ResizeObserver(this.onResizeObserved),this.observer.observe(e,{box:"content-box"})),this.canvas=e};onResizeObserved=e=>{let r=e[0].contentRect;this.updateLayout(r),this.canvasResized(r.width,r.height),this.updateView()};onFrame=()=>{this.frameHandle=this.canvasRender()?requestAnimationFrame(this.onFrame):void 0}};function hr(t){t.preventDefault(),t.stopImmediatePropagation()}function fr(t,e){let{length:r}=t;return r>1&&et(t,e,0,r-1),t}function Mn(t,e,r,n){let o=t[r+n>>>1],i;for(;r<=n;){for(;e(t[r],o)<0;)++r;for(;e(t[n],o)>0;)--n;r<=n&&(i=t[r],t[r++]=t[n],t[n--]=i)}return r}function et(t,e,r,n){let o=Mn(t,e,r,n);r<o-1&&et(t,e,r,o-1),n>o&&et(t,e,o,n)}var z=class{duration;easing;keys;map=new Map;transitionCount=0;constructor(e){Object.assign(this,e)}get hasTransitions(){return this.transitionCount>0}add(e,r,n=z.now()){let o=this.map.get(e),i=o?.find(l=>I(l.$startTime-n));if(i){for(let l,u=0;u<this.keys.length;++u)l=this.keys[u],i[l]+=r[l]??0;return}i={$startTime:n};let a=!0;for(let l,u,p=0;p<this.keys.length;++p)l=this.keys[p],u=r[l]??0,i[l]=u,a&&=I(u);a||(o||this.map.set(e,o=[]),++this.transitionCount,o.push(i))}getFrame(e,r=z.now()){let n=this.map.get(e);if(!n)return null;let{keys:o}=this,i={};for(let l=0;l<o.length;++l)i[o[l]]=0;let a=0;for(;a<n.length;){let l=n[a],u=1-(r-l.$startTime)/this.duration;if(u<=0){n.splice(a,1),--this.transitionCount;continue}u=this.easing(u);for(let p=0;p<o.length;++p){let c=o[p];i[c]+=l[c]*u}++a}return n.length===0&&this.map.delete(e),i}static now(){return performance.now()}};var tt=[1,0,0,-1,-1,0,0,1],rt=class{constructor(e,r=D,n=16){this.graph=e;this.chunkSize=n;this.safeOriginX=Math.floor(r.x-n/2),this.safeOriginY=Math.floor(r.y-n/2)}chunks=new Map;movedCells=[];moves=[];safeOriginX;safeOriginY;searchCounter=0;insertNode(e,r,n){this.findCheapestMoves(r,n).forEach(this.moveCell);let o=this.getChunk(r,n),i=this.getGridIndex(o,r,n);if(o.grid[i])throw new Error("insertNode: cannot insert to an occupied cell");let a={ref:e,x:r,y:n,hasMoved:!0,isFixed:!0};o.grid[i]=a,this.moves.push(a)}commit(){let e=[];for(let r of this.movedCells){let{ref:n,x:o,y:i}=r;I(o-n.x)&&I(i-n.y)||(this.moves.unshift(r),e.push({ref:n,x:n.x-o,y:n.y-i}))}return this.graph.beginMoveNodes(e.map(r=>r.ref)),this.graph.endMoveNodes(this.moves),e}getChunk(e,r){let{chunkSize:n}=this,o=Math.floor((e-this.safeOriginX)/n),i=Math.floor((r-this.safeOriginY)/n),a=mr(o)<<16|mr(i),l=this.chunks.get(a);if(!l){let u=this.safeOriginX+o*n,p=this.safeOriginY+i*n,c=this.graph.getNodesWithin(u,p,u+n-1,p+n-1),P=new Array(n*n);for(let y,f=0;f<c.length;++f)y=c[f],P[(y.x-u)*n+y.y-p]={ref:y,x:y.x,y:y.y,hasMoved:!1};this.chunks.set(a,l={grid:P,baseX:u,baseY:p})}return l}getGridIndex(e,r,n){return(r-e.baseX)*this.chunkSize+n-e.baseY}getCellAt(e,r){let n=this.getChunk(e,r),o=this.getGridIndex(n,e,r);return n.grid[o]}findCheapestMoves(e,r){let n=this.getCellAt(e,r);if(!n)return[];let o=this.searchCounter++,i=[],a=(u,p)=>{u.visit=o;let c=0;do{let P=p.slice();P.unshift({ref:u,x:u.x+tt[c++],y:u.y+tt[c++]}),i.push(P)}while(c<tt.length)};a(n,[]);let l;do{let u=i.shift(),p=this.getCellAt(u[0].x,u[0].y);if(!p){l=u;break}p.visit===o||p.isFixed||a(p,u)}while(i.length>0);if(!l)throw new Error("findCheapestMoves: could not find a path");return l}moveCell=({ref:e,x:r,y:n})=>{let o=this.getChunk(r,n),i=this.getGridIndex(o,r,n);if(o.grid[i])throw new Error("moveCell: cannot move to an occupied cell");let a=this.getChunk(e.x,e.y),l=this.getGridIndex(a,e.x,e.y);a.grid[l]=void 0,e.x=r,e.y=n,o.grid[i]=e,e.hasMoved||(this.movedCells.push(e),e.hasMoved=!0)}};function mr(t){return t>>16&32768|t&32767}function yr(t,e,r,n){let o=0,i=0;for(let p=0;p<e.length;++p){let c=e[p];o+=c.x,i+=c.y}o/=e.length,i/=e.length;let a=p=>(p.x-o)**2+(p.y-i)**2;fr(e,(p,c)=>a(p)-a(c));let l=new rt(t,{x:n.x+o,y:n.y+i}),u=z.now();for(let p of e)l.insertNode(p,p.x+n.x,p.y+n.y),r.add(p.id,n.frac,u);l.commit().forEach(p=>{r.add(p.ref.id,p,u)})}var Y={x:0,y:.8},nt=.2;function ke(t){return{ref:t.createBuffer(),size:0}}var he=class{constructor(e,r){this.alloc=e;this.target=r?.target,this.growthFactor=r?.growthFactor??1.618034,this.data=e(r?.initialCapacity??0)}data;target;growthFactor;usedCapacity=0;get capacity(){return this.data.length}resize(e,r=!0){this.usedCapacity=e;let n=Math.max(this.data.length,1);if(e<n)return!1;let o=Math.ceil(Math.log(e/n)/Math.log(this.growthFactor)),i=Math.trunc(n*this.growthFactor**o),a=this.data;return this.data=this.alloc(i),r&&this.data.set(a),!0}commit(e,r){let n=this.target??e.ARRAY_BUFFER,o=r;o.ref?e.bindBuffer(n,o.ref):(e.bindBuffer(n,r),o={ref:r,size:e.getBufferParameter(n,e.BUFFER_SIZE)});let i=this.usedCapacity*this.data.BYTES_PER_ELEMENT;o.size<i?(e.bufferData(n,this.data,e.DYNAMIC_READ),o.size=this.data.byteLength):e.bufferSubData(n,0,this.data,0,this.usedCapacity)}};function X(t){return[(t>>16&255)/255,(t>>8&255)/255,(t&255)/255]}function W(t,e){let r=t.createProgram();for(let n of e.shaders){let o=Gn(t,n);t.attachShader(r,o)}if(t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))throw new Error(`Error linking program:
`+t.getProgramInfoLog(r));return{ref:r,attributes:_r(e.attributes,n=>t.getAttribLocation(r,n)),uniforms:_r(e.uniforms,n=>t.getUniformLocation(r,n))}}function Gn(t,e){let r=t.createShader(e.type);if(t.shaderSource(r,e.source),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){let n={[t.VERTEX_SHADER]:"vertex",[t.FRAGMENT_SHADER]:"fragment"}[e.type]||"a";throw new Error(`Error compiling ${n} shader:
${t.getShaderInfoLog(r)}`)}return r}function _r(t,e){let r={};for(let n of t)r[n]=e(n);return r}var gr=`#version 300 es
precision mediump float;

layout(location = 0) out vec4 fragColor;

void main() {
	fragColor = vec4(1.0, 1.0, 1.0, 1.0);
}
`;var vr=`#version 300 es

in vec2 aGridPos;

uniform vec2 uOffset;
uniform mat3x2 uViewMatrix;

void main() {
	float side = float(((gl_VertexID & 1) << 1) - 1);
	gl_Position = vec4(
		uViewMatrix * vec3(
			 aGridPos[0] + uOffset[0] * side,
			-aGridPos[1] + uOffset[1] * side,
			1.0
		),
		0.0,
		1.0
	);
}
`;function xr(t,e){let r=W(t,{shaders:[{source:vr,type:t.VERTEX_SHADER},{source:gr,type:t.FRAGMENT_SHADER}],attributes:["aGridPos"],uniforms:["uOffset","uViewMatrix"]}),n=t.createVertexArray();t.bindVertexArray(n);let o=ke(t),i=new he(a=>new Float32Array(a));return t.bindBuffer(t.ARRAY_BUFFER,o.ref),t.enableVertexAttribArray(r.attributes.aGridPos),t.vertexAttribPointer(r.attributes.aGridPos,2,t.FLOAT,!1,0,0),{render(a){let{edges:l}=a;if(l.length===0)return;t.useProgram(r.ref),t.bindVertexArray(n),i.resize(l.length*4,!1);let{data:u}=i,p=0,c=d=>{u[p++]=(d.virtualPos??d).x,u[p++]=(d.virtualPos??d).y};for(let d,h=0;h<l.length;++h)d=l[h],c(d.source),c(d.destination);i.commit(t,o);let P=t.drawingBufferWidth/2,y=t.drawingBufferHeight/2,f=a.gridSize/P,v=a.gridSize/y,C=a.gridOffset.x/P,s=-a.gridOffset.y/y;t.uniform2fv(r.uniforms.uOffset,[Y.x/2,Y.y/2]),t.uniformMatrix3x2fv(r.uniforms.uViewMatrix,!1,[f,0,0,v,C,s]),t.drawArrays(t.LINES,0,l.length*2)}}}var br=`#version 300 es
precision mediump float;

in vec2 vGridPosition;

layout(location = 0) out vec4 fragColor;

uniform float uGridSize;
uniform vec3 uBackgroundColor;
uniform vec3 uGridlineColor;

void main() {
	// Flooring to strictly align to one side, avoiding double-width or disjoint gridlines.
	float halfSize = floor(uGridSize / 2.0);
	float gridlineDist = min(
		abs(floor(mod(vGridPosition[0], uGridSize) - halfSize)),
		abs(floor(mod(vGridPosition[1], uGridSize) - halfSize))
	);

	fragColor = vec4(mix(uBackgroundColor, uGridlineColor, float(gridlineDist == 0.0)), 1.0);
}
`;var Pr=`#version 300 es

in vec2 aClipPosition;

out vec2 vGridPosition;

uniform vec2 uScreenSize;
uniform vec2 uGridOffset;

void main() {
	gl_Position = vec4(aClipPosition, 0.0, 1.0);

	// Assuming that aClipPosition is +1 xor -1 and uGridOffset is an integer,
	// the final vGridPosition vector will have integer coordinates.
	vec2 mapping = vec2(
		(aClipPosition[0] * -0.5) + 0.5,
		(aClipPosition[1] *  0.5) + 0.5
	);

	vec2 offset = vec2(
		floor(uScreenSize[0] * 0.5),
		floor(uScreenSize[1] * 0.5)
	);

	vGridPosition = uScreenSize * mapping - offset + uGridOffset;
}
`;function Sr(t,e){let r=W(t,{shaders:[{source:Pr,type:t.VERTEX_SHADER},{source:br,type:t.FRAGMENT_SHADER}],attributes:["aClipPosition"],uniforms:["uScreenSize","uGridOffset","uGridSize","uBackgroundColor","uGridlineColor"]}),n=t.createVertexArray();t.bindVertexArray(n);let o=t.createBuffer(),i=new Int8Array([-1,-1,1,-1,-1,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_READ),t.enableVertexAttribArray(r.attributes.aClipPosition),t.vertexAttribPointer(r.attributes.aClipPosition,2,t.BYTE,!1,0,0);let a=X(e.backgroundColor),l=X(e.gridlineColor);return{render(u){t.useProgram(r.ref),t.bindVertexArray(n),t.uniform2fv(r.uniforms.uScreenSize,[t.drawingBufferWidth,t.drawingBufferHeight]),t.uniform2fv(r.uniforms.uGridOffset,[u.gridOffset.x,u.gridOffset.y]),t.uniform1f(r.uniforms.uGridSize,u.gridSize),t.uniform3fv(r.uniforms.uBackgroundColor,a),t.uniform3fv(r.uniforms.uGridlineColor,l),t.drawArrays(t.TRIANGLE_STRIP,0,4)}}}var Tr=`#version 300 es
precision mediump float;

in vec2 vTexPos;
in vec4 vColor;

layout(location = 0) out vec4 fragColor;

uniform sampler2D uShapes;
uniform vec3 uDefaultStrokeColor;
uniform vec3 uSelectedStrokeColor;

void main() {
	vec4 shape = texture(uShapes, vTexPos);
	vec3 stroke = mix(uDefaultStrokeColor, uSelectedStrokeColor, vColor.w);

	fragColor = vec4(
		mix(stroke, vColor.xyz, shape.y),
		shape.x
	);
}
`;var Er=`#version 300 es

// shared:
in vec2 aCellPos;

// per-instance:
in vec2 aGridPos;
in uint aColor;
in float aTexIndex;

out vec2 vTexPos;
out vec4 vColor;

uniform mat3x2 uViewMatrix;
uniform float uTexDiv;

void main() {
	gl_Position = vec4(
		uViewMatrix * vec3(
			aCellPos[0] + aGridPos[0],
			aCellPos[1] - aGridPos[1],
			1.0
		),
		0.0,
		1.0
	);

	float size = 1.0 / uTexDiv;
	vTexPos = vec2(
		  mod(aTexIndex,  uTexDiv) / uTexDiv + (aCellPos[0] + 0.5) * size,
		floor(aTexIndex / uTexDiv) / uTexDiv - (aCellPos[1] - 0.5) * size
	);

	vColor = vec4(
		float((aColor >> 16u) & 255u) / 255.0,
		float((aColor >>  8u) & 255u) / 255.0,
		float( aColor         & 255u) / 255.0,

		// w is used to swap between stroke colors
		float((aColor >> 24u) & 255u)
	);
}
`;function Fn(t,e){let r=Math.ceil(Math.sqrt(t.length)),n=r*e,o=new OffscreenCanvas(n,n),i=o.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!1});if(!i)throw new Error("Could not obtain offscreen 2D rendering context.");i.clearRect(0,0,n,n);let a=e/2;for(let l=0;l<t.length;++l)t[l](i,a+l%r*e,a+Math.trunc(l/r)*e,a);return{source:o,divisions:r}}var Vn=1/12,zn="#ffff00",wr="#ff0000",Ar=Math.PI*2;function Un(t,e,r,n,o){let i=o*.8;e.fillStyle=wr,e.beginPath(),e.arc(r+o*Y.x,n+o*Y.y,o*nt,0,Ar),e.fill(),e.beginPath(),e.arc(r-o*Y.x,n-o*Y.y,o*nt,0,Ar),e.fill(),e.fillStyle=zn,e.strokeStyle=wr,e.lineJoin="round",e.lineWidth=Math.max(1,o*Vn),e.beginPath(),e.moveTo(Math.round(r+t[0]*i),Math.round(n+t[1]*i));let a=2;for(;a<t.length;)e.lineTo(Math.round(r+t[a++]*i),Math.round(n+t[a++]*i));e.closePath(),e.fill(),e.stroke()}function Cr(t,e){let r=[];for(let n=0;n<t.length;++n)r.push(Un.bind(null,t[n]));return Fn(r,e)}function Rr(t,e){let r=W(t,{shaders:[{source:Er,type:t.VERTEX_SHADER},{source:Tr,type:t.FRAGMENT_SHADER}],attributes:["aCellPos","aGridPos","aColor","aTexIndex"],uniforms:["uViewMatrix","uTexDiv","uShapes","uDefaultStrokeColor","uSelectedStrokeColor"]}),n=t.createVertexArray();t.bindVertexArray(n);let o=t.createBuffer(),i=new Float32Array([-.5,-.5,.5,-.5,-.5,.5,.5,.5]);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_READ),t.enableVertexAttribArray(r.attributes.aCellPos),t.vertexAttribPointer(r.attributes.aCellPos,2,t.FLOAT,!1,0,0),t.vertexAttribDivisor(r.attributes.aCellPos,0);let a=ke(t),l=new he(y=>new Float32Array(y));t.bindBuffer(t.ARRAY_BUFFER,a.ref),t.enableVertexAttribArray(r.attributes.aGridPos),t.vertexAttribPointer(r.attributes.aGridPos,2,t.FLOAT,!1,16,0),t.vertexAttribDivisor(r.attributes.aGridPos,1),t.enableVertexAttribArray(r.attributes.aColor),t.vertexAttribIPointer(r.attributes.aColor,1,t.UNSIGNED_INT,16,8),t.vertexAttribDivisor(r.attributes.aColor,1),t.enableVertexAttribArray(r.attributes.aTexIndex),t.vertexAttribPointer(r.attributes.aTexIndex,1,t.FLOAT,!1,16,12),t.vertexAttribDivisor(r.attributes.aTexIndex,1);let u=Cr(e.shapes,e.shapeResolution),p=t.createTexture();t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,p),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGB,t.RGB,t.UNSIGNED_BYTE,u.source);let c=X(e.defaultStrokeColor),P=X(e.selectedStrokeColor);return{render(y){let{nodes:f,selectedNodes:v}=y;if(f.length===0)return;t.useProgram(r.ref),t.bindVertexArray(n),l.resize(f.length*4,!1);let{data:C}=l,s=new Uint32Array(C.buffer),d=0;for(let T,w=0;w<f.length;++w)T=f[w],C[d++]=(T.virtualPos??T).x,C[d++]=(T.virtualPos??T).y,s[d++]=(T.color??16777215)|(v.has(T)?16777216:0),C[d++]=T.shapeIndex??0;l.commit(t,a);let h=t.drawingBufferWidth/2,_=t.drawingBufferHeight/2,m=y.gridSize/h,g=y.gridSize/_,x=y.gridOffset.x/h,E=-y.gridOffset.y/_;t.uniform1i(r.uniforms.uShapes,0),t.uniform1f(r.uniforms.uTexDiv,u.divisions),t.uniform3fv(r.uniforms.uDefaultStrokeColor,c),t.uniform3fv(r.uniforms.uSelectedStrokeColor,P),t.uniformMatrix3x2fv(r.uniforms.uViewMatrix,!1,[m,0,0,g,x,E]),t.drawArraysInstanced(t.TRIANGLE_STRIP,0,4,f.length)}}}var Mr=`#version 300 es
precision mediump float;

layout(location = 0) out vec4 fragColor;

uniform vec3 uSelectedStrokeColor;
uniform float uDashSize;

void main() {
	float xMod = mod(gl_FragCoord[0], 2.0 * uDashSize);
	float yMod = mod(gl_FragCoord[1], 2.0 * uDashSize);
	float alpha = float(
		(xMod < uDashSize && yMod < uDashSize) ||
		(xMod > uDashSize && yMod > uDashSize)
	);

	fragColor = vec4(uSelectedStrokeColor, alpha);
}
`;var Gr=`#version 300 es

in vec2 aClipPos;

void main() {
	gl_Position = vec4(aClipPos, 0.0, 1.0);
}
`;function Dr(t,e){let r=W(t,{shaders:[{source:Gr,type:t.VERTEX_SHADER},{source:Mr,type:t.FRAGMENT_SHADER}],attributes:["aClipPos"],uniforms:["uSelectedStrokeColor","uDashSize"]}),n=t.createVertexArray();t.bindVertexArray(n);let o=t.createBuffer(),i=new Float32Array(8);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_READ),t.enableVertexAttribArray(r.attributes.aClipPos),t.vertexAttribPointer(r.attributes.aClipPos,2,t.FLOAT,!1,0,0);let a=X(e.selectedStrokeColor);return{render({gridOffset:l,gridSize:u,dragging:p}){if(p?.mode!==0)return;t.useProgram(r.ref),t.bindVertexArray(n);let c=t.drawingBufferWidth/2,P=t.drawingBufferHeight/2,y=(C,s,d)=>{i[d]=(C*u+l.x)/c,i[d+1]=-(s*u+l.y)/P},f=p.start,v=p.offset;y(f.x,f.y,0),y(f.x+v.x,f.y,2),y(f.x+v.x,f.y+v.y,4),y(f.x,f.y+v.y,6),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferSubData(t.ARRAY_BUFFER,0,i),t.uniform1f(r.uniforms.uDashSize,u/4),t.uniform3fv(r.uniforms.uSelectedStrokeColor,a),t.drawArrays(t.LINE_LOOP,0,4)}}}function kr(t,e){let r=t.getContext("webgl2",{alpha:!1,antialias:!1,depth:!1,desynchronized:!0,failIfMajorPerformanceCaveat:!0,powerPreference:"high-performance",premultipliedAlpha:!1,preserveDrawingBuffer:!1,stencil:!1});if(!r)throw new Error("Could not obtain WebGL rendering context.");r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);let n=Sr(r,e),o=xr(r,e),i=Rr(r,e),a=Dr(r,e);return{render(l){n.render(l),o.render(l),i.render(l),a.render(l)},resize(l,u){t.width===l&&t.height===u||(t.width=l,t.height=u,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight))}}}var j=window.devicePixelRatio||1,Ir=class extends Qe{canvasCssClass="graph-editor";dragGesture;panAndZoomGesture;selectedNodes=new Set;transitions=new z({duration:300,easing:e=>e**5,keys:["x","y"]});dragging;renderer;constructor(e){super(e);this.dragGesture=new qe({editor:this}),this.panAndZoomGesture=new Je({editor:this,usePointerLock:!0}),ce(this.dragGesture.drag,this.onDragMove),ce(this.dragGesture.drop,this.onDragDrop),ce(this.dragGesture.press,this.onNodePress),ce(this.panAndZoomGesture.press,this.onVoidPress)}componentWillUnmount(){super.componentWillUnmount(),this.renderer=void 0}canvasAcquired(e){this.renderer=kr(e,{backgroundColor:this.props.backgroundColor,gridlineColor:this.props.gridlineColor,defaultStrokeColor:this.props.defaultStrokeColor,selectedStrokeColor:this.props.selectedStrokeColor,shapes:this.props.shapes,shapeResolution:Math.round(this.props.maxZoom*this.props.gridSize*j)})}canvasResized(e,r){this.renderer.resize(Math.round(e*j),Math.round(r*j))}canvasRender(){let e=this.getVisibleRect(),r=this.editorToGridSpace(e.topLeft),n=this.editorToGridSpace(e.bottomRight),o=this.props.graph.getNodesWithin(r.x,r.y,n.x,n.y),i=this.props.graph.getEdgesWithin(r.x,r.y,n.x,n.y),a=z.now();for(let l of o){let u=this.transitions.getFrame(l.id,a);l.virtualPos=u?{x:l.x+u.x,y:l.y+u.y}:void 0}switch(this.dragging?.mode){case 1:{let{offset:l}=this.dragging,u=new Set;for(let p of this.dragging.nodes)o.push(p),p.edges?.forEach(c=>u.add(c)),p.virtualPos={x:p.x+l.x,y:p.y+l.y};u.forEach(p=>i.push(p));break}}return this.renderer.render({gridSize:Math.round(this.zoom*this.props.gridSize*j),gridOffset:{x:Math.round(this.offset.x*j),y:Math.round(this.offset.y*j)},nodes:o,edges:i,selectedNodes:this.selectedNodes,dragging:this.dragging}),this.transitions.hasTransitions}hitTest(e,r){let n=this.editorToGridSpace(e),{graph:o}=this.props;if(r.ctrlKey||r.metaKey)return this.dragging={mode:0,start:n.raw,offset:{...D}},this.updateView(),this.dragGesture;let i=o.getNodeAt(n.x,n.y);if(i){r.shiftKey?this.selectedNodes.has(i)?this.selectedNodes.delete(i):this.selectedNodes.add(i):this.selectedNodes.has(i)||(this.selectedNodes.clear(),this.selectedNodes.add(i));let a=Array.from(this.selectedNodes);return this.dragging={mode:1,offset:{...D},nodes:a},o.beginMoveNodes(a),this.updateView(),this.dragGesture}return this.panAndZoomGesture}getZoomAdjustment(e){let r=this.props.gridSize*j/2;return Math.round(e*r)/r}getWheelDeltaAdjustment(e){switch(e.deltaMode){case WheelEvent.DOM_DELTA_PAGE:return this.edgeBottomRight.y-this.edgeTopLeft.y;case WheelEvent.DOM_DELTA_LINE:return this.props.gridSize;default:return 1}}editorToGridSpace(e){let r={x:e.x/this.props.gridSize,y:e.y/this.props.gridSize},n=Math.round(r.x),o=Math.round(r.y);return{x:n,y:o,raw:r,frac:{x:r.x-n,y:r.y-o}}}onVoidPress=()=>{this.selectedNodes.size>0&&(this.selectedNodes.clear(),this.updateView())};onNodePress=e=>{};onDragMove=e=>{this.dragging.offset=this.editorToGridSpace(e).raw,this.updateView()};onDragDrop=e=>{let r=this.editorToGridSpace(e),n=this.dragging;switch(n.mode){case 1:yr(this.props.graph,n.nodes,this.transitions,r);break;case 0:{let{start:o}=n,i={x:o.x+r.x,y:o.y+r.y},a=this.props.graph.getNodesWithin(Math.round(Math.min(o.x,i.x)),Math.round(Math.min(o.y,i.y)),Math.round(Math.max(o.x,i.x)),Math.round(Math.max(o.y,i.y)));this.selectedNodes.clear(),a.forEach(l=>this.selectedNodes.add(l));break}}this.dragging=void 0,this.updateView()}};var fe=class{constructor(e){this.alphabet=e;let r=e.length;if(r===0)throw new Error("Alphabet cannot be empty.");if((r&r-1)!==0)throw new Error("Alphabet length must be a power of two.");this.shift=Math.trunc(Math.log(r)/Math.LN2),this.mask=Math.trunc(r-1)}shift;mask;index=0;next(){let e="",r=this.index++;do e=this.alphabet[r&this.mask]+e,r>>=this.shift;while(r>0);return e}static createBase32(){return new fe("0123456789abcdefghijklmnopqrstuv")}};function ot(t,e){if(!t)return!1;let r=t.indexOf(e);return r===-1?!1:(t.splice(r,1),!0)}var Nr=ft(at()),dt=class extends Nr.default{toBBox({source:e,destination:r}){return{maxX:Math.max(e.x,r.x),minX:Math.min(e.x,r.x),maxY:Math.max(e.y,r.y),minY:Math.min(e.y,r.y)}}compareMinX(e,r){return Math.min(e.source.x,e.destination.x)-Math.min(r.source.x,r.destination.x)}compareMinY(e,r){return Math.min(e.source.y,e.destination.y)-Math.min(r.source.y,r.destination.y)}};var Lr=ft(at()),lt=class extends Lr.default{toBBox({x:e,y:r}){return{maxX:e,minX:e,maxY:r,minY:r}}compareMinX(e,r){return e.x-r.x}compareMinY(e,r){return e.y-r.y}};function Ie(t,e,r=t,n=e,o=Number.EPSILON){return{maxX:r+o,minX:t-o,maxY:n+o,minY:e-o}}var ct=class{identity;edges=new Set;edgeTree=new dt;nodes=new Set;nodeTree=new lt;constructor(e){this.identity=e.identity}createNode(e,r){let n=this.getNodeAt(e,r);return n||(n={id:this.identity.next(),x:e,y:r}),this.nodes.add(n),this.nodeTree.insert(n),n}removeNode(e){return this.nodes.delete(e)?(e.edges?.forEach(r=>this.removeEdge(r)),this.nodeTree.remove(e),!0):!1}createEdge(e,r){if(!this.nodes.has(e)||!this.nodes.has(r))throw new Error("Src and dst nodes must be part of the same graph to form a connection.");let n=this.findEdge(e,r);return n||(n={source:e,destination:r},(e.edges??=[]).push(n),(r.edges??=[]).push(n),this.edges.add(n),this.edgeTree.insert(n)),n}removeEdge(e){return this.edges.delete(e)?(ot(e.source.edges,e),ot(e.destination.edges,e),!0):!1}beginMoveNodes(e){let r=new Set;for(let n of e)this.nodeTree.remove(n),n.edges?.forEach(o=>r.add(o));r.forEach(n=>this.edgeTree.remove(n))}endMoveNodes(e){let r=new Set;for(let{ref:n,x:o,y:i}of e){if(n.x=o,n.y=i,this.getNodeAt(n.x,n.y))throw new Error("Attempted to move a node to an occupied cell!");this.nodeTree.insert(n),n.edges?.forEach(a=>r.add(a))}this.edgeTree.load(Array.from(r))}getNodeAt(e,r){let n=this.nodeTree.search(Ie(e,r));if(n.length>1)throw new Error(`More than one node found at [ ${e}, ${r} ]`);return n.length>0?n[0]:null}getNodesWithin(e,r,n,o){return this.nodeTree.search(Ie(e,r,n,o))}getEdgesWithin(e,r,n,o){return this.edgeTree.search(Ie(e,r,n,o))}};var ut=class extends ct{constructor(e){super(e)}findEdge(e,r){let n=e.edges,o=r.edges;return n&&o&&(n.length<o.length?n.find(i=>i.destination===r):o.find(i=>i.source===e))}};var pt=new ut({identity:fe.createBase32()});function Br(t,e){return Math.round(t+Math.random()*(e-t))}function Le(t,e){return Math.trunc(t+Math.random()*(e-t))}var Fr=1e5,Wn=5e4,Ne=Math.sqrt(Fr)*2,ht=[],Be=0;for(;Be<Fr;){let t=Br(-Ne,Ne),e=Br(-Ne,Ne);if(pt.getNodeAt(t,e))continue;let r=pt.createNode(t,e);r.color=Le(0,16777215+1),r.shapeIndex=Le(0,De.length),ht.push(r),++Be}var Or=0;for(;Or<Wn;){let t=Le(0,Be),e=Le(0,Be);pt.createEdge(ht[t],ht[e]),++Or}Gt(b(cr,null),document.getElementById("root"));})();
//# sourceMappingURL=index.js.map
