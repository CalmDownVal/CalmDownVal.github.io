(()=>{var Hr=Object.create;var ye=Object.defineProperty;var Yr=Object.getOwnPropertyDescriptor;var Xr=Object.getOwnPropertyNames;var Wr=Object.getPrototypeOf,Kr=Object.prototype.hasOwnProperty;var Zr=(t,e,r)=>e in t?ye(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var $r=t=>ye(t,"__esModule",{value:!0});var jr=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var qr=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Xr(e))!Kr.call(t,o)&&(r||o!=="default")&&ye(t,o,{get:()=>e[o],enumerable:!(n=Yr(e,o))||n.enumerable});return t},ct=(t,e)=>qr($r(ye(t!=null?Hr(Wr(t)):{},"default",!e&&t&&t.__esModule?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var _e=(t,e,r)=>(Zr(t,typeof e!="symbol"?e+"":e,r),r);var nt=jr((tt,rt)=>{(function(t,e){typeof tt=="object"&&typeof rt<"u"?rt.exports=e():typeof define=="function"&&define.amd?define(e):(t=t||self).RBush=e()})(tt,function(){"use strict";function t(a,l,h,g,y){(function _(x,T,E,w,R){for(;w>E;){if(w-E>600){var A=w-E+1,M=T-E+1,ne=Math.log(A),Z=.5*Math.exp(2*ne/3),J=.5*Math.sqrt(ne*Z*(A-Z)/A)*(M-A/2<0?-1:1),Q=Math.max(E,Math.floor(T-M*Z/A+J)),Ur=Math.min(w,Math.floor(T+(A-M)*Z/A+J));_(x,T,Q,Ur,R)}var me=x[T],oe=E,F=w;for(e(x,E,T),R(x[w],me)>0&&e(x,E,w);oe<F;){for(e(x,oe,F),oe++,F--;R(x[oe],me)<0;)oe++;for(;R(x[F],me)>0;)F--}R(x[E],me)===0?e(x,E,F):e(x,++F,w),F<=T&&(E=F+1),T<=F&&(w=F-1)}})(a,l,h||0,g||a.length-1,y||r)}function e(a,l,h){var g=a[l];a[l]=a[h],a[h]=g}function r(a,l){return a<l?-1:a>l?1:0}var n=function(a){a===void 0&&(a=9),this._maxEntries=Math.max(4,a),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function o(a,l,h){if(!h)return l.indexOf(a);for(var g=0;g<l.length;g++)if(h(a,l[g]))return g;return-1}function i(a,l){s(a,0,a.children.length,l,a)}function s(a,l,h,g,y){y||(y=v(null)),y.minX=1/0,y.minY=1/0,y.maxX=-1/0,y.maxY=-1/0;for(var _=l;_<h;_++){var x=a.children[_];d(y,a.leaf?g(x):x)}return y}function d(a,l){return a.minX=Math.min(a.minX,l.minX),a.minY=Math.min(a.minY,l.minY),a.maxX=Math.max(a.maxX,l.maxX),a.maxY=Math.max(a.maxY,l.maxY),a}function u(a,l){return a.minX-l.minX}function p(a,l){return a.minY-l.minY}function c(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function b(a){return a.maxX-a.minX+(a.maxY-a.minY)}function m(a,l){return a.minX<=l.minX&&a.minY<=l.minY&&l.maxX<=a.maxX&&l.maxY<=a.maxY}function f(a,l){return l.minX<=a.maxX&&l.minY<=a.maxY&&l.maxX>=a.minX&&l.maxY>=a.minY}function v(a){return{children:a,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function C(a,l,h,g,y){for(var _=[l,h];_.length;)if(!((h=_.pop())-(l=_.pop())<=g)){var x=l+Math.ceil((h-l)/g/2)*g;t(a,x,l,h,y),_.push(l,x,x,h)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(a){var l=this.data,h=[];if(!f(a,l))return h;for(var g=this.toBBox,y=[];l;){for(var _=0;_<l.children.length;_++){var x=l.children[_],T=l.leaf?g(x):x;f(a,T)&&(l.leaf?h.push(x):m(a,T)?this._all(x,h):y.push(x))}l=y.pop()}return h},n.prototype.collides=function(a){var l=this.data;if(!f(a,l))return!1;for(var h=[];l;){for(var g=0;g<l.children.length;g++){var y=l.children[g],_=l.leaf?this.toBBox(y):y;if(f(a,_)){if(l.leaf||m(a,_))return!0;h.push(y)}}l=h.pop()}return!1},n.prototype.load=function(a){if(!a||!a.length)return this;if(a.length<this._minEntries){for(var l=0;l<a.length;l++)this.insert(a[l]);return this}var h=this._build(a.slice(),0,a.length-1,0);if(this.data.children.length)if(this.data.height===h.height)this._splitRoot(this.data,h);else{if(this.data.height<h.height){var g=this.data;this.data=h,h=g}this._insert(h,this.data.height-h.height-1,!0)}else this.data=h;return this},n.prototype.insert=function(a){return a&&this._insert(a,this.data.height-1),this},n.prototype.clear=function(){return this.data=v([]),this},n.prototype.remove=function(a,l){if(!a)return this;for(var h,g,y,_=this.data,x=this.toBBox(a),T=[],E=[];_||T.length;){if(_||(_=T.pop(),g=T[T.length-1],h=E.pop(),y=!0),_.leaf){var w=o(a,_.children,l);if(w!==-1)return _.children.splice(w,1),T.push(_),this._condense(T),this}y||_.leaf||!m(_,x)?g?(h++,_=g.children[h],y=!1):_=null:(T.push(_),E.push(h),h=0,g=_,_=_.children[0])}return this},n.prototype.toBBox=function(a){return a},n.prototype.compareMinX=function(a,l){return a.minX-l.minX},n.prototype.compareMinY=function(a,l){return a.minY-l.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(a){return this.data=a,this},n.prototype._all=function(a,l){for(var h=[];a;)a.leaf?l.push.apply(l,a.children):h.push.apply(h,a.children),a=h.pop();return l},n.prototype._build=function(a,l,h,g){var y,_=h-l+1,x=this._maxEntries;if(_<=x)return i(y=v(a.slice(l,h+1)),this.toBBox),y;g||(g=Math.ceil(Math.log(_)/Math.log(x)),x=Math.ceil(_/Math.pow(x,g-1))),(y=v([])).leaf=!1,y.height=g;var T=Math.ceil(_/x),E=T*Math.ceil(Math.sqrt(x));C(a,l,h,E,this.compareMinX);for(var w=l;w<=h;w+=E){var R=Math.min(w+E-1,h);C(a,w,R,T,this.compareMinY);for(var A=w;A<=R;A+=T){var M=Math.min(A+T-1,R);y.children.push(this._build(a,A,M,g-1))}}return i(y,this.toBBox),y},n.prototype._chooseSubtree=function(a,l,h,g){for(;g.push(l),!l.leaf&&g.length-1!==h;){for(var y=1/0,_=1/0,x=void 0,T=0;T<l.children.length;T++){var E=l.children[T],w=c(E),R=(A=a,M=E,(Math.max(M.maxX,A.maxX)-Math.min(M.minX,A.minX))*(Math.max(M.maxY,A.maxY)-Math.min(M.minY,A.minY))-w);R<_?(_=R,y=w<y?w:y,x=E):R===_&&w<y&&(y=w,x=E)}l=x||l.children[0]}var A,M;return l},n.prototype._insert=function(a,l,h){var g=h?a:this.toBBox(a),y=[],_=this._chooseSubtree(g,this.data,l,y);for(_.children.push(a),d(_,g);l>=0&&y[l].children.length>this._maxEntries;)this._split(y,l),l--;this._adjustParentBBoxes(g,y,l)},n.prototype._split=function(a,l){var h=a[l],g=h.children.length,y=this._minEntries;this._chooseSplitAxis(h,y,g);var _=this._chooseSplitIndex(h,y,g),x=v(h.children.splice(_,h.children.length-_));x.height=h.height,x.leaf=h.leaf,i(h,this.toBBox),i(x,this.toBBox),l?a[l-1].children.push(x):this._splitRoot(h,x)},n.prototype._splitRoot=function(a,l){this.data=v([a,l]),this.data.height=a.height+1,this.data.leaf=!1,i(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(a,l,h){for(var g,y,_,x,T,E,w,R=1/0,A=1/0,M=l;M<=h-l;M++){var ne=s(a,0,M,this.toBBox),Z=s(a,M,h,this.toBBox),J=(y=ne,_=Z,x=void 0,T=void 0,E=void 0,w=void 0,x=Math.max(y.minX,_.minX),T=Math.max(y.minY,_.minY),E=Math.min(y.maxX,_.maxX),w=Math.min(y.maxY,_.maxY),Math.max(0,E-x)*Math.max(0,w-T)),Q=c(ne)+c(Z);J<R?(R=J,g=M,A=Q<A?Q:A):J===R&&Q<A&&(A=Q,g=M)}return g||h-l},n.prototype._chooseSplitAxis=function(a,l,h){var g=a.leaf?this.compareMinX:u,y=a.leaf?this.compareMinY:p;this._allDistMargin(a,l,h,g)<this._allDistMargin(a,l,h,y)&&a.children.sort(g)},n.prototype._allDistMargin=function(a,l,h,g){a.children.sort(g);for(var y=this.toBBox,_=s(a,0,l,y),x=s(a,h-l,h,y),T=b(_)+b(x),E=l;E<h-l;E++){var w=a.children[E];d(_,a.leaf?y(w):w),T+=b(_)}for(var R=h-l-1;R>=l;R--){var A=a.children[R];d(x,a.leaf?y(A):A),T+=b(x)}return T},n.prototype._adjustParentBBoxes=function(a,l,h){for(var g=h;g>=0;g--)d(l[g],a)},n.prototype._condense=function(a){for(var l=a.length-1,h=void 0;l>=0;l--)a[l].children.length===0?l>0?(h=a[l-1].children).splice(h.indexOf(a[l]),1):this.clear():i(a[l],this.toBBox)},n})});var be,S,mt,Jr,ie,yt,ut,_t,ve={},gt=[],Qr=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function U(t,e){for(var r in e)t[r]=e[r];return t}function vt(t){var e=t.parentNode;e&&e.removeChild(t)}function P(t,e,r){var n,o,i,s={};for(i in e)i=="key"?n=e[i]:i=="ref"?o=e[i]:s[i]=e[i];if(arguments.length>2&&(s.children=arguments.length>3?be.call(arguments,2):r),typeof t=="function"&&t.defaultProps!=null)for(i in t.defaultProps)s[i]===void 0&&(s[i]=t.defaultProps[i]);return ge(t,s,n,o,null)}function ge(t,e,r,n,o){var i={type:t,props:e,key:r,ref:n,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:o??++mt};return o==null&&S.vnode!=null&&S.vnode(i),i}function se(){return{current:null}}function te(t){return t.children}function N(t,e){this.props=t,this.context=e}function ee(t,e){if(e==null)return t.__?ee(t.__,t.__.__k.indexOf(t)+1):null;for(var r;e<t.__k.length;e++)if((r=t.__k[e])!=null&&r.__e!=null)return r.__e;return typeof t.type=="function"?ee(t):null}function xt(t){var e,r;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((r=t.__k[e])!=null&&r.__e!=null){t.__e=t.__c.base=r.__e;break}return xt(t)}}function Ie(t){(!t.__d&&(t.__d=!0)&&ie.push(t)&&!xe.__r++||ut!==S.debounceRendering)&&((ut=S.debounceRendering)||yt)(xe)}function xe(){for(var t;xe.__r=ie.length;)t=ie.sort(function(e,r){return e.__v.__b-r.__v.__b}),ie=[],t.some(function(e){var r,n,o,i,s,d;e.__d&&(s=(i=(r=e).__v).__e,(d=r.__P)&&(n=[],(o=U({},i)).__v=i.__v+1,Fe(d,i,o,r.__n,d.ownerSVGElement!==void 0,i.__h!=null?[s]:null,n,s??ee(i),i.__h),Et(n,i),i.__e!=s&&xt(i)))})}function Pt(t,e,r,n,o,i,s,d,u,p){var c,b,m,f,v,C,a,l=n&&n.__k||gt,h=l.length;for(r.__k=[],c=0;c<e.length;c++)if((f=r.__k[c]=(f=e[c])==null||typeof f=="boolean"?null:typeof f=="string"||typeof f=="number"||typeof f=="bigint"?ge(null,f,null,null,f):Array.isArray(f)?ge(te,{children:f},null,null,null):f.__b>0?ge(f.type,f.props,f.key,null,f.__v):f)!=null){if(f.__=r,f.__b=r.__b+1,(m=l[c])===null||m&&f.key==m.key&&f.type===m.type)l[c]=void 0;else for(b=0;b<h;b++){if((m=l[b])&&f.key==m.key&&f.type===m.type){l[b]=void 0;break}m=null}Fe(t,f,m=m||ve,o,i,s,d,u,p),v=f.__e,(b=f.ref)&&m.ref!=b&&(a||(a=[]),m.ref&&a.push(m.ref,null,f),a.push(b,f.__c||v,f)),v!=null?(C==null&&(C=v),typeof f.type=="function"&&f.__k===m.__k?f.__d=u=bt(f,u,t):u=St(t,f,m,l,v,u),typeof r.type=="function"&&(r.__d=u)):u&&m.__e==u&&u.parentNode!=t&&(u=ee(m))}for(r.__e=C,c=h;c--;)l[c]!=null&&(typeof r.type=="function"&&l[c].__e!=null&&l[c].__e==r.__d&&(r.__d=ee(n,c+1)),wt(l[c],l[c]));if(a)for(c=0;c<a.length;c++)Tt(a[c],a[++c],a[++c])}function bt(t,e,r){for(var n,o=t.__k,i=0;o&&i<o.length;i++)(n=o[i])&&(n.__=t,e=typeof n.type=="function"?bt(n,e,r):St(r,n,n,o,n.__e,e));return e}function St(t,e,r,n,o,i){var s,d,u;if(e.__d!==void 0)s=e.__d,e.__d=void 0;else if(r==null||o!=i||o.parentNode==null)e:if(i==null||i.parentNode!==t)t.appendChild(o),s=null;else{for(d=i,u=0;(d=d.nextSibling)&&u<n.length;u+=2)if(d==o)break e;t.insertBefore(o,i),s=i}return s!==void 0?s:o.nextSibling}function en(t,e,r,n,o){var i;for(i in r)i==="children"||i==="key"||i in e||Pe(t,i,null,r[i],n);for(i in e)o&&typeof e[i]!="function"||i==="children"||i==="key"||i==="value"||i==="checked"||r[i]===e[i]||Pe(t,i,e[i],r[i],n)}function pt(t,e,r){e[0]==="-"?t.setProperty(e,r):t[e]=r==null?"":typeof r!="number"||Qr.test(e)?r:r+"px"}function Pe(t,e,r,n,o){var i;e:if(e==="style")if(typeof r=="string")t.style.cssText=r;else{if(typeof n=="string"&&(t.style.cssText=n=""),n)for(e in n)r&&e in r||pt(t.style,e,"");if(r)for(e in r)n&&r[e]===n[e]||pt(t.style,e,r[e])}else if(e[0]==="o"&&e[1]==="n")i=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+i]=r,r?n||t.addEventListener(e,i?ft:ht,i):t.removeEventListener(e,i?ft:ht,i);else if(e!=="dangerouslySetInnerHTML"){if(o)e=e.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if(e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in t)try{t[e]=r??"";break e}catch{}typeof r=="function"||(r!=null&&(r!==!1||e[0]==="a"&&e[1]==="r")?t.setAttribute(e,r):t.removeAttribute(e))}}function ht(t){this.l[t.type+!1](S.event?S.event(t):t)}function ft(t){this.l[t.type+!0](S.event?S.event(t):t)}function Fe(t,e,r,n,o,i,s,d,u){var p,c,b,m,f,v,C,a,l,h,g,y=e.type;if(e.constructor!==void 0)return null;r.__h!=null&&(u=r.__h,d=e.__e=r.__e,e.__h=null,i=[d]),(p=S.__b)&&p(e);try{e:if(typeof y=="function"){if(a=e.props,l=(p=y.contextType)&&n[p.__c],h=p?l?l.props.value:p.__:n,r.__c?C=(c=e.__c=r.__c).__=c.__E:("prototype"in y&&y.prototype.render?e.__c=c=new y(a,h):(e.__c=c=new N(a,h),c.constructor=y,c.render=rn),l&&l.sub(c),c.props=a,c.state||(c.state={}),c.context=h,c.__n=n,b=c.__d=!0,c.__h=[]),c.__s==null&&(c.__s=c.state),y.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=U({},c.__s)),U(c.__s,y.getDerivedStateFromProps(a,c.__s))),m=c.props,f=c.state,b)y.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(y.getDerivedStateFromProps==null&&a!==m&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(a,h),!c.__e&&c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(a,c.__s,h)===!1||e.__v===r.__v){c.props=a,c.state=c.__s,e.__v!==r.__v&&(c.__d=!1),c.__v=e,e.__e=r.__e,e.__k=r.__k,e.__k.forEach(function(_){_&&(_.__=e)}),c.__h.length&&s.push(c);break e}c.componentWillUpdate!=null&&c.componentWillUpdate(a,c.__s,h),c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(m,f,v)})}c.context=h,c.props=a,c.state=c.__s,(p=S.__r)&&p(e),c.__d=!1,c.__v=e,c.__P=t,p=c.render(c.props,c.state,c.context),c.state=c.__s,c.getChildContext!=null&&(n=U(U({},n),c.getChildContext())),b||c.getSnapshotBeforeUpdate==null||(v=c.getSnapshotBeforeUpdate(m,f)),g=p!=null&&p.type===te&&p.key==null?p.props.children:p,Pt(t,Array.isArray(g)?g:[g],e,r,n,o,i,s,d,u),c.base=e.__e,e.__h=null,c.__h.length&&s.push(c),C&&(c.__E=c.__=null),c.__e=!1}else i==null&&e.__v===r.__v?(e.__k=r.__k,e.__e=r.__e):e.__e=tn(r.__e,e,r,n,o,i,s,u);(p=S.diffed)&&p(e)}catch(_){e.__v=null,(u||i!=null)&&(e.__e=d,e.__h=!!u,i[i.indexOf(d)]=null),S.__e(_,e,r)}}function Et(t,e){S.__c&&S.__c(e,t),t.some(function(r){try{t=r.__h,r.__h=[],t.some(function(n){n.call(r)})}catch(n){S.__e(n,r.__v)}})}function tn(t,e,r,n,o,i,s,d){var u,p,c,b=r.props,m=e.props,f=e.type,v=0;if(f==="svg"&&(o=!0),i!=null){for(;v<i.length;v++)if((u=i[v])&&"setAttribute"in u==!!f&&(f?u.localName===f:u.nodeType===3)){t=u,i[v]=null;break}}if(t==null){if(f===null)return document.createTextNode(m);t=o?document.createElementNS("http://www.w3.org/2000/svg",f):document.createElement(f,m.is&&m),i=null,d=!1}if(f===null)b===m||d&&t.data===m||(t.data=m);else{if(i=i&&be.call(t.childNodes),p=(b=r.props||ve).dangerouslySetInnerHTML,c=m.dangerouslySetInnerHTML,!d){if(i!=null)for(b={},v=0;v<t.attributes.length;v++)b[t.attributes[v].name]=t.attributes[v].value;(c||p)&&(c&&(p&&c.__html==p.__html||c.__html===t.innerHTML)||(t.innerHTML=c&&c.__html||""))}if(en(t,m,b,o,d),c)e.__k=[];else if(v=e.props.children,Pt(t,Array.isArray(v)?v:[v],e,r,n,o&&f!=="foreignObject",i,s,i?i[0]:r.__k&&ee(r,0),d),i!=null)for(v=i.length;v--;)i[v]!=null&&vt(i[v]);d||("value"in m&&(v=m.value)!==void 0&&(v!==t.value||f==="progress"&&!v||f==="option"&&v!==b.value)&&Pe(t,"value",v,b.value,!1),"checked"in m&&(v=m.checked)!==void 0&&v!==t.checked&&Pe(t,"checked",v,b.checked,!1))}return t}function Tt(t,e,r){try{typeof t=="function"?t(e):t.current=e}catch(n){S.__e(n,r)}}function wt(t,e,r){var n,o;if(S.unmount&&S.unmount(t),(n=t.ref)&&(n.current&&n.current!==t.__e||Tt(n,null,e)),(n=t.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(i){S.__e(i,e)}n.base=n.__P=null}if(n=t.__k)for(o=0;o<n.length;o++)n[o]&&wt(n[o],e,typeof t.type!="function");r||t.__e==null||vt(t.__e),t.__e=t.__d=void 0}function rn(t,e,r){return this.constructor(t,r)}function At(t,e,r){var n,o,i;S.__&&S.__(t,e),o=(n=typeof r=="function")?null:r&&r.__k||e.__k,i=[],Fe(e,t=(!n&&r||e).__k=P(te,null,[t]),o||ve,ve,e.ownerSVGElement!==void 0,!n&&r?[r]:o?null:e.firstChild?be.call(e.childNodes):null,i,!n&&r?r:o?o.__e:e.firstChild,n),Et(i,t)}function Ct(t,e){var r={__c:e="__cC"+_t++,__:t,Consumer:function(n,o){return n.children(o)},Provider:function(n){var o,i;return this.getChildContext||(o=[],(i={})[e]=this,this.getChildContext=function(){return i},this.shouldComponentUpdate=function(s){this.props.value!==s.value&&o.some(Ie)},this.sub=function(s){o.push(s);var d=s.componentWillUnmount;s.componentWillUnmount=function(){o.splice(o.indexOf(s),1),d&&d.call(s)}}),n.children}};return r.Provider.__=r.Consumer.contextType=r}be=gt.slice,S={__e:function(t,e){for(var r,n,o;e=e.__;)if((r=e.__c)&&!r.__)try{if((n=r.constructor)&&n.getDerivedStateFromError!=null&&(r.setState(n.getDerivedStateFromError(t)),o=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(t),o=r.__d),o)return r.__E=r}catch(i){t=i}throw t}},mt=0,Jr=function(t){return t!=null&&t.constructor===void 0},N.prototype.setState=function(t,e){var r;r=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=U({},this.state),typeof t=="function"&&(t=t(U({},r),this.props)),t&&U(r,t),t!=null&&this.__v&&(e&&this.__h.push(e),Ie(this))},N.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Ie(this))},N.prototype.render=te,ie=[],yt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,xe.__r=0,_t=0;var G=class extends Error{code;isTranslationError=!0;constructor(e,r){super(`${e} ${r}`),this.code=e}static is(e){return e?.isTranslationError===!0}};_e(G,"FORMAT_UNAVAILABLE","FormatUnavailable"),_e(G,"INVALID_PARAMETER","InvalidParameter"),_e(G,"KEY_NOT_FOUND","KeyNotFound");function Be(t){return t[1]??"variable"}function Rt(t,e){let r=t[0];return e!==void 0&&Object.prototype.hasOwnProperty.call(e,r)?""+e[r]:r}function Mt(t,e){let{length:r}=e,n=Be(t);if(t.length-2>r)throw new G(G.INVALID_PARAMETER,`too many parameters for format '${n}'`);for(let o=0;o<r;++o)e[o].call(null,t[2+o],n,o)}function nn(t,e,r){on(t)&&Array.isArray(sn(t))||an("a map of messages",e,r)}function on(t){return t!==null&&typeof t=="object"}function sn(t){for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function an(t,e,r){throw new G(G.INVALID_PARAMETER,`expected parameter ${r+1} of format '${e}' to be ${t}`)}var dn=[nn],ln=[],cn=Object.freeze({__proto__:null,select:()=>(t,e)=>{Mt(t,dn);let r=t[2];if(!r.other)throw new G(G.INVALID_PARAMETER,`messages of format '${Be(t)}' must contain the key 'other'`);let n={};for(let o in r)n[o]=e.interpret(r[o]);return o=>(n[Rt(t,o)]??n.other)(o)},variable:()=>t=>(Mt(t,ln),e=>Rt(t,e))}),L=class extends Error{input;at;isParseError=!0;constructor(e,r,n){super(e),this.input=r,this.at=n}toString(){let e=Math.max(this.input.lastIndexOf(`
`,this.at-1),0)+1,r=this.input.indexOf(`
`,this.at+1);r===-1?r=this.input.length:this.input[r-1]==="\r"&&--r;let n=`${this.input.slice(e,r)}
${" ".repeat(this.at-e)}^`;return`${this.message} at pos ${this.at}:

${n}

${this.stack}`}static is(e){return e?.isParseError===!0}};function Nt(t){return t===32||t>=9&&t<=13||t===133||t===160||t===6158||t>=8192&&t<=8205||t===8232||t===8233||t===8239||t===8287||t===8288||t===12288||t===65279}function H(t,e){let{length:r}=t,n=e;for(;n<r&&Nt(t.charCodeAt(n));)++n;return n}function ae(t,e){let{length:r}=t,n,o=e;for(;o<r&&(n=t[o],n!=="{"&&n!=="}"&&n!==","&&n!=="#"&&n!=="'"&&n!==":"&&!Nt(n.charCodeAt(0)));)++o;if(e===o)throw new L(`expected an identifier but ${n?`saw '${n}'`:"saw the end of pattern"} instead`,t,e);return t.slice(e,o)}function Gt(t,e,r){let{length:n}=t,o,i=e,s=e,d="";for(;s<n&&(o=t[s],!(o==="{"||o==="}"||r&&o==="#"));){if(o==="'"){if(o=t[++s],o==="'")d+=t.slice(i,s),i=s+1;else if(o==="{"||o==="}"||r&&o==="#"){for(d+=t.slice(i,s-1),i=s;++s<n;)if(o=t[s],o==="'"){if(o=t[s+1],o!=="'")break;d+=t.slice(i,++s),i=s+1}d+=t.slice(i,s),i=++s}}++s}return d+=t.slice(i,s),d}function It(t,e,r,n){let{length:o}=t,i={};r.push(i);let s,d=n,u=[],p=Le(t,e,u,!0);for(i[d]=u;p<o&&(p=H(t,p),s=t[p],s!==","&&s!=="}");){if(d=ae(t,p),p=H(t,p+d.length),s=t[p],s!=="{")throw new L("expected '{'",t,p);u=[],p=Le(t,p+1,u,!0),i[d]=u}return p}function un(t,e,r,n){let{length:o}=t,i={};r.push(i);let s,d=n,u=H(t,e),p=ae(t,u);for(u+=p.length,i[d]=p;u<o&&(u=H(t,u),s=t[u],s!==","&&s!=="}");){if(d=ae(t,u),u=H(t,u+d.length),s=t[u],s==="{")return It(t,u+1,r,d);if(s!==":")throw new L("expected ':' or '{'",t,u);u=H(t,u+1),p=ae(t,u),u+=p.length,i[d]=p}return u}function pn(t,e,r){let n=e,o=t[n];if(o==="#")return r.push("#"),n+1;if(o!=="{")throw new L("expected '#' or '{'",t,n);let{length:i}=t;do{n=H(t,n+1);let s=ae(t,n);switch(n=H(t,n+s.length),o=t[n],o){case",":case"}":r.push(s);break;case"{":if(r.length<2)throw new L("expected an identifier but saw a message instead",t,n);n=It(t,n+1,r,s),o=t[n];break;case":":if(r.length<2)throw new L("expected an identifier but saw an attribute instead",t,n);n=un(t,n+1,r,s),o=t[n];break;default:throw new L(`unexpected character '${o}'`,t,n)}}while(n<i&&o!=="}");return n+1}function Le(t,e,r,n){let o,i=e,s=Gt(t,i,n);s&&(r.push(s),i+=s.length);let{length:d}=t;for(;i<d;){if(o=t[i],o==="}"){if(!n)throw new L("unexpected '}'",t,i);++i;break}let u=[];i=pn(t,i,u),r.push(u),s=Gt(t,i,n),s&&(r.push(s),i+=s.length)}return i}function kt(t){let e=[];return Le(t,0,e,!1),e}function Ft(t,e,r){for(let n in t){if(n.startsWith("$"))continue;let o=t[n];switch(typeof o){case"string":e[r+n]=o;break;case"object":o!==null&&Ft(o,e,`${r}${n}.`)}}return e}function hn(t){return Ft(t,{},"")}function Dt(t,e){let r={};for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=e(t[n],n));return r}var Lt=class{formatProvider;constructor(e){this.formatProvider=e}interpret(e,r){let{length:n}=e;if(n===1)return this.interpretElement(e[0],r);let o=new Array(n);for(let i=0;i<n;++i)o[i]=this.interpretElement(e[i],r);return fn.bind(null,o)}interpretElement(e,r){if(typeof e=="string")return()=>e;let n=e;if(n.length===1&&n[0]==="#"){if(r===void 0)return()=>"#";n=[r]}return this.formatProvider.getFormat(n)(n,this)}};function fn(t,e){let r="";for(let n=0;n<t.length;++n)r+=t[n](e);return r}var Bt=class{formatMap;constructor(e){this.formatMap=e}getFormat(e){let r=Be(e),n=this.formatMap[r];if(!n)throw new G(G.FORMAT_UNAVAILABLE,r);return n}},re;(function(t){t[t.Eager=0]="Eager",t[t.Lazy=1]="Lazy",t[t.Off=2]="Off"})(re||(re={}));var de=class{cacheMode;expansions;interpreter;constructor({cacheMode:e,interpreter:r,translations:n}){this.cacheMode=e??re.Lazy,this.interpreter=r,this.expansions=hn(n),e===re.Eager&&(this.expansions=Dt(this.expansions,o=>r.interpret(kt(o))))}expand(e,r){let n=this.expansions[e];if(n===void 0)throw new G(G.KEY_NOT_FOUND,e);return typeof n=="string"&&(n=this.interpreter.interpret(kt(n)),this.cacheMode!==re.Off&&(this.expansions[e]=n)),n(r)}static fromLocale(e,r=cn){let n=Dt(r,(i,s)=>i(e.$format?.[s])),o=new Bt(n);return new de({cacheMode:re.Lazy,interpreter:new Lt(o),translations:e})}};var Te,I,Ot,Ee=0,Wt=[],Vt=S.__b,zt=S.__r,Ut=S.diffed,Ht=S.__c,Yt=S.unmount;function Ve(t,e){S.__h&&S.__h(I,t,Ee||e),Ee=0;var r=I.__H||(I.__H={__:[],__h:[]});return t>=r.__.length&&r.__.push({}),r.__[t]}function Kt(t){return Ee=1,mn(qt,t)}function mn(t,e,r){var n=Ve(Te++,2);return n.t=t,n.__c||(n.__=[r?r(e):qt(void 0,e),function(o){var i=n.t(n.__[0],o);n.__[0]!==i&&(n.__=[i,n.__[1]],n.__c.setState({}))}],n.__c=I),n.__}function Zt(t,e){var r=Ve(Te++,3);!S.__s&&jt(r.__H,e)&&(r.__=t,r.__H=e,I.__H.__h.push(r))}function $t(t){return Ee=5,ze(function(){return{current:t}},[])}function ze(t,e){var r=Ve(Te++,7);return jt(r.__H,e)&&(r.__=t(),r.__H=e,r.__h=t),r.__}function yn(){for(var t;t=Wt.shift();)if(t.__P)try{t.__H.__h.forEach(Se),t.__H.__h.forEach(Oe),t.__H.__h=[]}catch(e){t.__H.__h=[],S.__e(e,t.__v)}}S.__b=function(t){I=null,Vt&&Vt(t)},S.__r=function(t){zt&&zt(t),Te=0;var e=(I=t.__c).__H;e&&(e.__h.forEach(Se),e.__h.forEach(Oe),e.__h=[])},S.diffed=function(t){Ut&&Ut(t);var e=t.__c;e&&e.__H&&e.__H.__h.length&&(Wt.push(e)!==1&&Ot===S.requestAnimationFrame||((Ot=S.requestAnimationFrame)||function(r){var n,o=function(){clearTimeout(i),Xt&&cancelAnimationFrame(n),setTimeout(r)},i=setTimeout(o,100);Xt&&(n=requestAnimationFrame(o))})(yn)),I=null},S.__c=function(t,e){e.some(function(r){try{r.__h.forEach(Se),r.__h=r.__h.filter(function(n){return!n.__||Oe(n)})}catch(n){e.some(function(o){o.__h&&(o.__h=[])}),e=[],S.__e(n,r.__v)}}),Ht&&Ht(t,e)},S.unmount=function(t){Yt&&Yt(t);var e,r=t.__c;r&&r.__H&&(r.__H.__.forEach(function(n){try{Se(n)}catch(o){e=o}}),e&&S.__e(e,r.__v))};var Xt=typeof requestAnimationFrame=="function";function Se(t){var e=I,r=t.__c;typeof r=="function"&&(t.__c=void 0,r()),I=e}function Oe(t){var e=I;t.__c=t.__(),I=e}function jt(t,e){return!t||t.length!==e.length||e.some(function(r,n){return r!==t[n]})}function qt(t,e){return typeof e=="function"?e(t):e}var Ue={isLoading:!0,t:()=>""},_n=Ct(Ue),we=class extends N{state=Ue;pendingFetch;componentDidMount(){this.fetchLocale()}componentDidUpdate(e){let r=this.props;e.url!==r.url&&this.fetchLocale()}componentWillUnmount(){this.pendingFetch?.abort()}render(){return P(_n.Provider,{children:this.props.children,value:this.state})}async fetchLocale(){try{this.setState(Ue),this.pendingFetch=new AbortController;let{credentials:e,headers:r,url:n}=this.props,o=await fetch(n,{credentials:e,headers:r,method:"GET",signal:this.pendingFetch.signal});if(!o.ok)throw new Error(`unexpected HTTP response ${o.status} - ${o.statusText}`);let i=await o.json(),s=de.fromLocale(i,this.props.formats);this.setState({isLoading:!1,t:gn.bind(null,s)})}catch(e){this.props.onError?.(e),this.setState({isLoading:!1,t:()=>""})}finally{this.pendingFetch=void 0}}};function gn(t,e,r){try{return typeof e=="string"?t.expand(e,r):t.expand(e.key,e.vars)}catch(n){let o;return o=G.is(n)?n.message:L.is(n)?"ParseError":"UnknownError",`⚠️ ${o}`}}var vn=[.85,0,.821,-.22,.736,-.425,.601,-.601,.425,-.736,.22,-.821,0,-.85,-.22,-.821,-.425,-.736,-.601,-.601,-.736,-.425,-.821,-.22,-.85,-0,-.821,.22,-.736,.425,-.601,.601,-.425,.736,-.22,.821,-0,.85,.22,.821,.425,.736,.601,.601,.736,.425,.821,.22],xn=[.85,-.85,-.85,-.85,-.85,.85,.85,.85],Pn=[1,0,0,-1,-1,-0,-0,1],bn=[1,-.85,-1,-.85,-0,.85],Sn=[.577,0,.866,-.5,.289,-.5,0,-1,-.289,-.5,-.866,-.5,-.577,-0,-.866,.5,-.289,.5,-0,1,.289,.5,.866,.5],Ae=[vn,xn,Pn,bn,Sn];function B(t,e){let r=t;for(let n in e)e[n]&&(r+=` ${t}--${n}`);return r}function Ce(){let{length:t}=arguments,e="";for(let r,n=0;n<t;++n)(r=arguments[n])&&(e+=(e&&" ")+r);return e}function Y(t,e){return r=>P("div",{class:"field-wrapper"},P("span",{class:"field-wrapper__label"},r.title),P(t,r),e?.decorated===!1?null:P("div",{class:"field-wrapper__decorator"}))}var Jt=({shape:t,resolution:e=100})=>{let r=ze(()=>{let n=e/2,o="";for(let i=0;i<t.length;i+=2)o+=`${Math.round(n+t[i]*n)},${Math.round(n+t[i+1]*n)} `;return o},[t,e]);return P("svg",{class:"node-shape-field__preview",viewBox:`0 0 ${e} ${e}`},P("polygon",{points:r}))};var En=({onChange:t,value:e=0})=>P("div",{class:"node-shape-field"},Ae.map((r,n)=>P("button",{class:B("node-shape-field__button",{selected:n===e}),type:"button",key:n,onClick:()=>t(n)},P(Jt,{shape:r})))),Qt=Y(En,{decorated:!1});function Re(t,e){let r=t[0]==="-",n=r?1:0;for(;n<t.length&&t[n]==="0";)++n;let o=n;for(;n<t.length&&t[n]!==".";)++n;let i=n;for(n=t.length-1;n>i&&t[n]==="0";)--n;let s=n===i?n:n+1,d=t.slice(o,s);if(o===s)return e&&(e.isNegative=!1,e.isZero=!0,e.separatorAt=1),"0";let u=(r?"-":"")+(o===i&&i!==s?"0":"");return e&&(e.isNegative=r,e.isZero=!1,e.separatorAt=u.length+i-o),u+d}function He(t,e){let r={},n=Re(t,r),o={},i=Re(e,o),s=r.isNegative?-1:1;if(r.isNegative!==o.isNegative)return r.isZero&&o.isZero?0:s;if(r.separatorAt!==o.separatorAt)return s*(r.separatorAt-o.separatorAt);let d=r.isNegative?1:0,u;do u=n.charCodeAt(d)-i.charCodeAt(d);while(u===0&&++d<r.separatorAt);let p=Math.max(n.length,i.length);for(;u===0&&++d<p;)u=(d<n.length?n.charCodeAt(d):48)-(d<i.length?i.charCodeAt(d):48);return s*u}var tr=/^\s*-?[0-9\s]*(?:\s*[.,][0-9\s]*)?$/,rr={sign:"",significant:"0",separator:"",fractional:"",concat:"0"},nr=class extends N{state={uiValue:""};inputRef=se();caret={index:0};uiValueParsed=rr;isEmpty=!0;render(e,{uiValue:r}){let{groupBy:n=0,maxFractional:o=-1,maxSignificant:i=-1}=e;this.caret.index=this.inputRef.current?.selectionStart??0,this.isEmpty=!r||r==="0"||r==="-0",this.uiValueParsed=Tn(r,i,o,this.caret);let s=(n>0?er(this.uiValueParsed.significant,n,0,this.caret):this.uiValueParsed.significant)+this.uiValueParsed.separator+this.uiValueParsed.fractional;return P("div",{class:"number-field",onPointerDown:this.onDelegateFocus},P("span",{onClick:this.onToggleSign,children:this.uiValueParsed.sign?"- ":"+ ",class:Ce("number-field__text",B("number-field__sign",{negative:Boolean(this.uiValueParsed.sign)}))}),(()=>{let d=this.uiValueParsed.significant.length;if(d>=i)return null;let u="0".repeat(i-d);return P("span",{class:"number-field__text"},n>0?er(u,n,d):u)})(),P("div",{class:"number-field__input-wrapper"},P("span",{class:"number-field__text number-field__phantom"},s),P("input",{class:"number-field__input",ref:this.inputRef,type:"text",inputMode:"decimal",value:s,onBlur:this.onLostFocus,onbeforeinput:this.onBeforeInput,onInput:this.onInput})),this.uiValueParsed.fractional.length<o?P("span",{class:"number-field__text"},(this.uiValueParsed.separator?"":".")+"0".repeat(o-this.uiValueParsed.fractional.length)):null)}componentDidUpdate(){this.inputRef.current&&this.inputRef.current===document.activeElement&&this.inputRef.current.setSelectionRange(this.caret.index,this.caret.index)}onDelegateFocus=e=>{if(this.inputRef.current&&e.target!==this.inputRef.current){e.preventDefault(),this.inputRef.current.focus();let r=this.inputRef.current.getBoundingClientRect(),n=e.x<(r.left+r.right)/2?0:this.inputRef.current.value.length;this.inputRef.current.setSelectionRange(n,n)}};onLostFocus=()=>{let{maxValue:e,minValue:r,onChange:n}=this.props,o=this.uiValueParsed.sign+this.uiValueParsed.concat,i=o;r&&He(i,r)<0?i=r:e&&He(i,e)>0&&(i=e),i=Re(i),i!==o&&this.setState({uiValue:i}),n(i)};onToggleSign=()=>{let e=this.inputRef.current?.value??"0";this.setState({uiValue:(this.uiValueParsed.sign?"":"-")+e})};onBeforeInput=e=>{if(e.target!==this.inputRef.current)return;let r=this.inputRef.current,n=r.value,o=r.selectionStart??n.length,i=r.selectionEnd??n.length;if(!e.data){e.inputType==="deleteContentBackward"&&this.uiValueParsed.sign&&(o===0||this.isEmpty&&o===n.length)&&(e.preventDefault(),this.onToggleSign());return}if(e.data==="-"&&!this.uiValueParsed.sign&&(o===0||this.isEmpty)){e.preventDefault(),this.onToggleSign();return}let s=n.slice(0,o)+e.data+n.slice(i);tr.test(s)||e.preventDefault()};onInput=e=>{if(e.target!==this.inputRef.current)return;let r=this.inputRef.current.value;this.isEmpty&&this.inputRef.current.selectionStart===r.length&&/^0[^0]/.test(r)&&(r=r.slice(1)),this.setState({uiValue:this.uiValueParsed.sign+r})}};function Tn(t,e,r,n){if(!t||!tr.test(t))return n.index=1,rr;let o="",i="",s=-1,d="",u=0,p=0,c=0,b=0,m=()=>{d+=t.slice(u,p),u=p+1};for(;p<t.length;){let C=t.charCodeAt(p);C===46||C===44?(i=".",s=p-b):(C<48||C>57)&&(m(),++b,C===45?o="-":p<n.index&&++c),++p}m(),n.index-=c,s===-1&&(s=d.length);let f=d.slice(0,s)||"0";e>=1&&(n.index>e&&(n.index-=Math.max(f.length-e,0)),f=f.slice(0,e));let v=d.slice(s+1);return r>=0&&(v=v.slice(0,r),r===0&&(i="")),{sign:o,separator:i,significant:f,fractional:v,concat:d}}function er(t,e,r,n){let o=t,i=t.length+(r-1)%e+1;for(;i>e;)i-=e,o=o.slice(0,i)+" "+o.slice(i),n&&i<n.index&&++n.index;return o}var or=Y(nr);function le(t,e){if(!e)return!1;let r=t;for(;r&&r!==e;)r=r.parentNode;return r&&r===e}var ir={capture:!1,passive:!0};function sr(t,e,r){return t.addEventListener(e,r,ir),()=>t.removeEventListener(e,r,ir)}var ar=({children:t,class:e,isOpen:r,onClose:n})=>{let o=$t(null);return Zt(()=>n?sr(window,"pointerdown",s=>{le(s.target,o.current)||n(s)}):void 0),P("div",{class:Ce(B("popup",{open:r}),e),ref:o},P("div",{class:"popup__content"},t))};var dr=class extends N{state={navIndex:0,isOpen:!1,search:""};inputRef=se();listRef=se();filteredOptions=null;render({options:e,value:r},{navIndex:n,isOpen:o,search:i}){let s=i.toLowerCase(),d=[];this.filteredOptions=[];let u=-1;for(let p=0;p<e.length;++p){let c=e[p],b=c.value===r;b&&(u=p);let m=-1;if(i&&(m=c.title.toLowerCase().indexOf(s))===-1)continue;let f=m+s.length;d.push(P("li",{key:p,onClick:()=>this.selectOption(c),onPointerMove:this.onOptionPointerEnter,class:B("select-field__option",{selected:b,nav:n===this.filteredOptions.length})},m===-1?c.title:P(te,null,c.title.slice(0,m),P("span",{class:"select-field__search"},c.title.slice(m,f)),c.title.slice(f)))),this.filteredOptions.push(c)}return P("div",{class:B("select-field",{open:o}),onfocusout:this.onFocusOut},P("input",{class:"select-field__input",type:"text",ref:this.inputRef,onKeyDown:this.onKeyDown,onInput:this.onInput,onClick:()=>this.toggleDropdown(),placeholder:e[u]?.title,value:o?i:""}),P(ar,{class:"select-field__popup",isOpen:o},P("ul",{class:"select-field__list",ref:this.listRef},d)))}componentDidMount(){window.addEventListener("pointerdown",this.onPagePointerDown,{passive:!0})}componentWillUnmount(){window.removeEventListener("pointerdown",this.onPagePointerDown)}toggleDropdown(e=!this.state.isOpen){if(this.state.isOpen===e)return;let r={isOpen:e};e&&(r.search="",r.navIndex=0),this.setState(r)}selectOption(e){this.props.onChange(e.value),this.toggleDropdown(!1),this.inputRef.current?.focus()}onPagePointerDown=e=>{le(e.target,this.inputRef.current?.parentElement)||this.toggleDropdown(!1)};onFocusOut=e=>{e.relatedTarget&&!le(e.relatedTarget,this.inputRef.current?.parentElement)&&this.toggleDropdown(!1)};onOptionPointerEnter=e=>{let r=this.listRef.current?.children;if(!!r){for(let n=0;n<r.length;++n)if(r[n]===e.target){n!==this.state.navIndex&&this.setState({navIndex:n});break}}};onInput=()=>{this.setState({isOpen:!0,search:this.inputRef.current?.value,navIndex:0})};onKeyDown=e=>{let r=this.filteredOptions??this.props.options,{isOpen:n,navIndex:o}=this.state;switch(e.code){case"ArrowUp":n||this.toggleDropdown(!0),this.setState({navIndex:Math.max(o-1,0)});break;case"ArrowDown":n||this.toggleDropdown(!0),this.setState({navIndex:Math.min(o+1,r.length-1)});break;case"Enter":case"NumpadEnter":{let i=r[o];this.state.isOpen&&i&&this.selectOption(i);break}case"Escape":this.toggleDropdown(!1);break;default:return}e.preventDefault()}},lr=Y(dr);var Ye=({onChange:t,title:e,value:r})=>P("div",{class:B("switch-field",{on:r}),onClick:()=>t(!r)},P("span",{class:"switch-field__label"},e),P("button",{class:"switch-field__switch"},P("span",{class:"switch-field__thumb"})));var wn=({onChange:t,value:e})=>P("div",{class:"text-field"},P("input",{class:"text-field__input",type:"text",value:e,onChange:r=>t(r.target.value)})),cr=Y(wn);var Xe=class{fields=[];add(e){return this.fields.push(e),this}};var ur=({fieldSet:t,onChange:e,value:r})=>P("div",{class:"field-set-editor"},t.fields.map(n=>P(n.kind,{...n.params,key:n.key,value:r?.[n.key],title:n.title,onChange(o){r?.[n.key]!==o&&e({...r,[n.key]:o})}})));var An=new Xe().add({key:"shape",kind:Qt,title:"Shape"}).add({key:"title",kind:cr,title:"Encounter Title"}).add({key:"minLevel",kind:or,title:"Minimum Required Level",params:{minValue:"-1000000",maxValue:"1000000",maxSignificant:7,maxFractional:3,groupBy:3}}).add({key:"forClass",kind:lr,title:"For Class",params:{options:[{value:0,title:"Warrior"},{value:1,title:"Mage"},{value:2,title:"Ranger"}]}}).add({key:"isSecret",kind:Ye,title:"Secret"}).add({key:"isFinal",kind:Ye,title:"Final"}),pr=()=>{let[t,e]=Kt();return console.log(t),P(we,{url:"./locale/en.json"},P(ur,{fieldSet:An,value:t,onChange:e}))};function V(){this.t=[]}function O(){this.i=new Set,this.u=[]}function hr(t){return t&&typeof t.then=="function"}function Cn(t,e,r){return new Promise((n,o)=>{let{length:i}=e,s=0,d=()=>{--s==0&&n()};for(let u=0;u<i;++u){let p=e[u].call(t,r);hr(p)&&(++s,p.then(d,o))}})}function Rn(t,e,r){return new Promise((n,o)=>{let{length:i}=e,s=0,d=()=>{if(s>=i)return void n();let u=e[s++].call(t,r);hr(u)?u.then(d,o):d()};d()})}V.prototype.o=null,V.prototype.h=function(){return this.o||(this.o=this.t.slice()),this.o},V.prototype.l=function(t){this.t.push(t),this.o=null},V.prototype.g=function(){return this.t.length!==0&&(this.t=[],this.o=null,!0)},V.prototype.m=function(){return this.t.length},V.prototype.P=function(t){let{t:e}=this,r,n=e.length-1;for(;n>=0&&(r=e[n],r!==t&&r.p!==t);)--n;return n!==-1&&(this.t.splice(n,1),this.o=null,!0)},V.prototype.v=function(t){let e=this.t.lastIndexOf(t);e!==-1&&(this.t.splice(e,1),this.o=null)},O.prototype.o=null,O.prototype.h=function(){return this.o||(this.o=Array.from(this.i.values()).concat(this.u)),this.o},O.prototype.l=function(t){if(t.p){if(this.i.has(t.p))return;this.u.push(t)}else this.i.add(t),this.A(t);this.o=null},O.prototype.g=function(){return!!this.m()&&(this.i.clear(),this.u=[],this.o=null,!0)},O.prototype.m=function(){return this.i.size+this.u.length},O.prototype.P=function(t){return this.i.delete(t)?(this.o=null,!0):this.A(t)},O.prototype.v=function(t){let e=this.u.lastIndexOf(t);e!==-1&&(this.u.splice(e,1),this.o=null)},O.prototype.A=function(t){let e=this.u.length-1;for(;e>=0;){if(this.u[e].p===t)return this.u.splice(e,1),this.o=null,!0;--e}return!1};var Mn={array:V,set:O};function $(t={}){let e=new(Mn[t.backend]??V),r=t.async===!0,n=r?function(o,i){let s=i?.parallel?Cn:Rn;return function(d){return s(this,o.h(),d)}}(e,t):function(o,i){return function(s){let d=o.h(),{length:u}=d;for(let p=0;p<u;++p)d[p].call(this,s)}}(e);return n.S=e,n.isAsync=r,n}function Gn(t,e){let r=!1,n=function(o){if(!r)return t.S.v(n),r=!0,e.call(this,o)};n.p=e,t.S.l(n)}function ce(t,e,r){r?.once?Gn(t,e):t.S.l(e)}var k={x:0,y:0};function ue(t,e){let r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)}function j(t,e=0,r=1){return t<e?e:t>r?r:t}function D(t){return Math.abs(t)<Number.EPSILON}var pe=class{press=$();longPress=$();multiPress=$();acceptsNewPointers=!0;editor;state=0;longPressDelay;maxPressDistance;multiPressDelay;longPressTimeout;multiPressCount=0;multiPressTime=0;constructor(e){this.editor=e.editor,this.longPressDelay=e.longPressDelay??800,this.maxPressDistance=e.maxPressDistance??10,this.multiPressDelay=e.multiPressDelay??400}handlePointerDown(e,r){if(r.length>1){this.onChangeState(4);return}this.state=1,this.onMultiPress(e.editor,!1),this.longPressTimeout=setTimeout(()=>this.onLongPress(e.editor),this.longPressDelay)}handlePointerMove(e,r){ue(e.start,e)>this.maxPressDistance&&this.onChangeState(2)}handlePointerUp(e,r){this.state===1&&(this.press(e.editor),this.onMultiPress(e.editor,!0)),this.onChangeState(0)}onChangeState(e){this.longPressTimeout!==void 0&&(clearTimeout(this.longPressTimeout),this.longPressTimeout=void 0),this.state=e}onLongPress(e){this.longPressTimeout=void 0,this.longPress(e),this.onChangeState(3)}onMultiPress(e,r){let n=performance.now();n-this.multiPressTime>this.multiPressDelay?this.multiPressCount=0:r&&++this.multiPressCount>=2&&this.multiPress(e),this.multiPressTime=n}};var Ke=class extends pe{drag=$();drop=$();offset={...k};isDragging=!1;edgeProximity;pushSpeedBasis;pushSpeed={...k};start={...k};animationHandle;lastTimestamp;lastPoint;constructor(e){super(e);this.edgeProximity=e.edgeProximity??64,this.pushSpeedBasis=e.pushSpeed??.5}handlePointerDown(e,r){this.acceptsNewPointers=!1,this.isDragging=!0,this.lastPoint=e,this.start=e.editor,this.offset={...k},this.startPushAnimation(e),super.handlePointerDown(e,r)}handlePointerMove(e,r){this.lastPoint=e,this.offset.x=e.editor.x-this.start.x,this.offset.y=e.editor.y-this.start.y,this.drag(this.offset),this.startPushAnimation(e),super.handlePointerMove(e,r)}handlePointerUp(e,r){this.acceptsNewPointers=!0,this.isDragging=!1,this.stopPushAnimation(),this.drop(this.offset),super.handlePointerUp(e,r)}startPushAnimation(e){this.pushSpeed.x=this.pushSpeedBasis*(j(1-(e.x-this.editor.edgeTopLeft.x)/this.edgeProximity)-j(1-(this.editor.edgeBottomRight.x-e.x)/this.edgeProximity)),this.pushSpeed.y=this.pushSpeedBasis*(j(1-(e.y-this.editor.edgeTopLeft.y)/this.edgeProximity)-j(1-(this.editor.edgeBottomRight.y-e.y)/this.edgeProximity)),!D(this.pushSpeed.x)||!D(this.pushSpeed.y)?this.animationHandle===void 0&&(this.lastTimestamp=void 0,this.animationHandle=requestAnimationFrame(this.onTick)):this.stopPushAnimation()}stopPushAnimation(){this.animationHandle!==void 0&&(cancelAnimationFrame(this.animationHandle),this.animationHandle=void 0)}onTick=e=>{let r=0;this.lastTimestamp!==void 0&&(r=e-this.lastTimestamp),this.editor.setOffset({x:this.pushSpeed.x*r,y:this.pushSpeed.y*r}),this.offset=this.editor.clientToEditorSpace(this.lastPoint),this.offset.x-=this.start.x,this.offset.y-=this.start.y,this.drag(this.offset),this.lastTimestamp=e,this.animationHandle=requestAnimationFrame(this.onTick)}};var Ze=class extends pe{usePointerLock;pinchInitDistance=0;pinchInitZoom=1;isPointerLocked=!1;isPointerLockEligible=!1;constructor(e){super(e);this.usePointerLock=e.usePointerLock??!1,this.usePointerLock&&document.addEventListener("pointerlockchange",this.onPointerLockChange)}dispose(){this.usePointerLock&&document.removeEventListener("pointerlockchange",this.onPointerLockChange)}handlePointerDown(e,r){super.handlePointerDown(e,r),this.isPointerLockEligible=this.usePointerLock&&r.length===1&&e.type==="mouse",r.length===2&&(this.pinchInitDistance=ue(r[0],r[1]),this.pinchInitZoom=this.editor.zoom,this.acceptsNewPointers=!1)}handlePointerMove(e,r){if(super.handlePointerMove(e,r),this.state!==3)if(r.length===2){let n=r[1]===e?r[0]:r[1],o=ue(e,n);this.editor.setZoom(this.pinchInitZoom*o/this.pinchInitDistance,{x:(e.x+n.x)/2,y:(e.y+n.y)/2},!1),this.editor.setOffset({x:(e.x+n.x)/2-(e.x-e.delta.x+n.x)/2,y:(e.y+n.y)/2-(e.y-e.delta.y+n.y)/2})}else this.editor.setOffset({x:e.delta.x,y:e.delta.y})}handlePointerUp(e,r){super.handlePointerUp(e,r),this.acceptsNewPointers=!0,this.isPointerLocked&&document.exitPointerLock()}onChangeState(e){super.onChangeState(e),this.isPointerLockEligible&&e===2&&this.editor.canvas?.requestPointerLock()}onPointerLockChange=()=>{this.isPointerLocked=document.pointerLockElement===this.editor.canvas}};var fr=window.devicePixelRatio||1,$e=class extends N{zoom;offset={...k};canvas=null;edgeTopLeft={...k};edgeBottomRight={...k};canvasCssClass;pointers=[];rawOffset={...k};rawZoom;gesture=null;frameHandle;observer;constructor(e,r){super(e,r);let n=Math.max((e.minZoom+e.maxZoom)/2,Number.EPSILON);this.zoom=n,this.rawZoom=n}componentDidMount(){let e={passive:!0};window.addEventListener("pointermove",this.onPointerMove,e),window.addEventListener("pointerup",this.onPointerLost,e),window.addEventListener("pointercancel",this.onPointerLost,e)}componentWillUnmount(){window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerLost),window.removeEventListener("pointercancel",this.onPointerLost),this.observer?.disconnect(),this.observer=void 0,this.frameHandle!==void 0&&(cancelAnimationFrame(this.frameHandle),this.frameHandle=void 0)}shouldComponentUpdate(){return!1}render(){return P("canvas",{class:this.canvasCssClass,onContextMenu:mr,onLostPointerCapture:this.onPointerLost,onPointerDown:this.onPointerDown,onWheel:this.onWheel,ref:this.onCanvasRef})}updateView(){this.frameHandle??=requestAnimationFrame(this.onFrame)}clientToEditorSpace(e){return{x:(e.x-(this.edgeTopLeft.x+this.edgeBottomRight.x)/2-this.offset.x)/this.zoom,y:(e.y-(this.edgeTopLeft.y+this.edgeBottomRight.y)/2-this.offset.y)/this.zoom}}getVisibleRect(){return{topLeft:this.clientToEditorSpace(this.edgeTopLeft),bottomRight:this.clientToEditorSpace(this.edgeBottomRight)}}setOffset(e,r=!0){this.rawOffset.x=(r?this.rawOffset.x:0)+e.x,this.rawOffset.y=(r?this.rawOffset.y:0)+e.y;let n=this.getOffsetAdjustment(this.rawOffset);(!D(n.x-this.offset.x)||!D(n.y-this.offset.y))&&(this.offset.x=n.x,this.offset.y=n.y,this.updateView())}setZoom(e,r,n=!0){this.rawZoom=j((n?this.rawZoom:0)+e,Math.max(this.props.minZoom,Number.EPSILON),this.props.maxZoom);let o=this.getZoomAdjustment(this.rawZoom),i=this.zoom-o;if(D(i))return;let s=this.clientToEditorSpace(r);this.setOffset({x:i*s.x,y:i*s.y}),this.zoom=o,this.updateView()}getOffsetAdjustment(e){return e}getZoomAdjustment(e){return e}getWheelDeltaAdjustment(e){return 1}updateLayout(e=this.canvas.getBoundingClientRect()){this.edgeTopLeft.y=e.top,this.edgeTopLeft.x=e.left,this.edgeBottomRight.y=e.bottom,this.edgeBottomRight.x=e.right}onPointerDown=e=>{let r=this.clientToEditorSpace(e);if(this.gesture===null&&(this.updateLayout(),this.gesture=this.hitTest(r,e)),this.gesture?.acceptsNewPointers===!0){let n={id:e.pointerId,type:e.pointerType,delta:{...k},editor:r,start:{x:e.x,y:e.y},x:e.x,y:e.y};this.pointers.push(n),this.gesture.handlePointerDown(n,this.pointers)}};onPointerMove=e=>{let r=this.pointers.find(({id:n})=>e.pointerId===n);!r||(r.delta.x=e.movementX/fr,r.delta.y=e.movementY/fr,r.type==="mouse"&&document.pointerLockElement?(r.x+=r.delta.x,r.y+=r.delta.y):(r.x=e.x,r.y=e.y),r.editor=this.clientToEditorSpace(r),this.gesture.handlePointerMove(r,this.pointers))};onPointerLost=e=>{let r=this.pointers.findIndex(({id:o})=>e.pointerId===o);if(r===-1)return;let n=this.pointers[r];this.gesture.handlePointerUp(n,this.pointers),this.pointers.splice(r,1),this.pointers.length===0&&(this.gesture=null)};onWheel=e=>{mr(e);let r=-this.getWheelDeltaAdjustment(e);e.ctrlKey?(r/=(this.edgeBottomRight.y-this.edgeTopLeft.y)/3,this.setZoom(e.deltaY*r,e)):this.setOffset({x:(e.shiftKey?e.deltaY:e.deltaX)*r,y:(e.shiftKey?e.deltaX:e.deltaY)*r})};onCanvasRef=e=>{let r=this.canvas;r&&this.observer.unobserve(r),e&&(this.canvasAcquired(e),this.observer??=new ResizeObserver(this.onResizeObserved),this.observer.observe(e,{box:"content-box"})),this.canvas=e};onResizeObserved=e=>{let r=e[0].contentRect;this.updateLayout(r),this.canvasResized(r.width,r.height),this.updateView()};onFrame=()=>{this.frameHandle=this.canvasRender()?requestAnimationFrame(this.onFrame):void 0}};function mr(t){t.preventDefault(),t.stopImmediatePropagation()}function yr(t,e){let{length:r}=t;return r>1&&je(t,e,0,r-1),t}function Dn(t,e,r,n){let o=t[r+n>>>1],i;for(;r<=n;){for(;e(t[r],o)<0;)++r;for(;e(t[n],o)>0;)--n;r<=n&&(i=t[r],t[r++]=t[n],t[n--]=i)}return r}function je(t,e,r,n){let o=Dn(t,e,r,n);r<o-1&&je(t,e,r,o-1),n>o&&je(t,e,o,n)}var z=class{duration;easing;keys;map=new Map;transitionCount=0;constructor(e){Object.assign(this,e)}get hasTransitions(){return this.transitionCount>0}add(e,r,n=z.now()){let o=this.map.get(e),i=o?.find(d=>D(d.$startTime-n));if(i){for(let d,u=0;u<this.keys.length;++u)d=this.keys[u],i[d]+=r[d]??0;return}i={$startTime:n};let s=!0;for(let d,u,p=0;p<this.keys.length;++p)d=this.keys[p],u=r[d]??0,i[d]=u,s&&=D(u);s||(o||this.map.set(e,o=[]),++this.transitionCount,o.push(i))}getFrame(e,r=z.now()){let n=this.map.get(e);if(!n)return null;let{keys:o}=this,i={};for(let d=0;d<o.length;++d)i[o[d]]=0;let s=0;for(;s<n.length;){let d=n[s],u=1-(r-d.$startTime)/this.duration;if(u<=0){n.splice(s,1),--this.transitionCount;continue}u=this.easing(u);for(let p=0;p<o.length;++p){let c=o[p];i[c]+=d[c]*u}++s}return n.length===0&&this.map.delete(e),i}static now(){return performance.now()}};var qe=[1,0,0,-1,-1,0,0,1],Je=class{constructor(e,r=k,n=16){this.graph=e;this.chunkSize=n;this.safeOriginX=Math.floor(r.x-n/2),this.safeOriginY=Math.floor(r.y-n/2)}chunks=new Map;movedCells=[];moves=[];safeOriginX;safeOriginY;searchCounter=0;insertNode(e,r,n){this.findCheapestMoves(r,n).forEach(this.moveCell);let o=this.getChunk(r,n),i=this.getGridIndex(o,r,n);if(o.grid[i])throw new Error("insertNode: cannot insert to an occupied cell");let s={ref:e,x:r,y:n,hasMoved:!0,isFixed:!0};o.grid[i]=s,this.moves.push(s)}commit(){let e=[];for(let r of this.movedCells){let{ref:n,x:o,y:i}=r;D(o-n.x)&&D(i-n.y)||(this.moves.unshift(r),e.push({ref:n,x:n.x-o,y:n.y-i}))}return this.graph.beginMoveNodes(e.map(r=>r.ref)),this.graph.endMoveNodes(this.moves),e}getChunk(e,r){let{chunkSize:n}=this,o=Math.floor((e-this.safeOriginX)/n),i=Math.floor((r-this.safeOriginY)/n),s=_r(o)<<16|_r(i),d=this.chunks.get(s);if(!d){let u=this.safeOriginX+o*n,p=this.safeOriginY+i*n,c=this.graph.getNodesWithin(u,p,u+n-1,p+n-1),b=new Array(n*n);for(let m,f=0;f<c.length;++f)m=c[f],b[(m.x-u)*n+m.y-p]={ref:m,x:m.x,y:m.y,hasMoved:!1};this.chunks.set(s,d={grid:b,baseX:u,baseY:p})}return d}getGridIndex(e,r,n){return(r-e.baseX)*this.chunkSize+n-e.baseY}getCellAt(e,r){let n=this.getChunk(e,r),o=this.getGridIndex(n,e,r);return n.grid[o]}findCheapestMoves(e,r){let n=this.getCellAt(e,r);if(!n)return[];let o=this.searchCounter++,i=[],s=(u,p)=>{u.visit=o;let c=0;do{let b=p.slice();b.unshift({ref:u,x:u.x+qe[c++],y:u.y+qe[c++]}),i.push(b)}while(c<qe.length)};s(n,[]);let d;do{let u=i.shift(),p=this.getCellAt(u[0].x,u[0].y);if(!p){d=u;break}p.visit===o||p.isFixed||s(p,u)}while(i.length>0);if(!d)throw new Error("findCheapestMoves: could not find a path");return d}moveCell=({ref:e,x:r,y:n})=>{let o=this.getChunk(r,n),i=this.getGridIndex(o,r,n);if(o.grid[i])throw new Error("moveCell: cannot move to an occupied cell");let s=this.getChunk(e.x,e.y),d=this.getGridIndex(s,e.x,e.y);s.grid[d]=void 0,e.x=r,e.y=n,o.grid[i]=e,e.hasMoved||(this.movedCells.push(e),e.hasMoved=!0)}};function _r(t){return t>>16&32768|t&32767}function gr(t,e,r,n){let o=0,i=0;for(let p=0;p<e.length;++p){let c=e[p];o+=c.x,i+=c.y}o/=e.length,i/=e.length;let s=p=>(p.x-o)**2+(p.y-i)**2;yr(e,(p,c)=>s(p)-s(c));let d=new Je(t,{x:n.x+o,y:n.y+i}),u=z.now();for(let p of e)d.insertNode(p,p.x+n.x,p.y+n.y),r.add(p.id,n.frac,u);d.commit().forEach(p=>{r.add(p.ref.id,p,u)})}var X={x:0,y:.8},Qe=.2;function Me(t){return{ref:t.createBuffer(),size:0}}var he=class{constructor(e,r){this.alloc=e;this.target=r?.target,this.growthFactor=r?.growthFactor??1.618034,this.data=e(r?.initialCapacity??0)}data;target;growthFactor;usedCapacity=0;get capacity(){return this.data.length}resize(e,r=!0){this.usedCapacity=e;let n=Math.max(this.data.length,1);if(e<n)return!1;let o=Math.ceil(Math.log(e/n)/Math.log(this.growthFactor)),i=Math.trunc(n*this.growthFactor**o),s=this.data;return this.data=this.alloc(i),r&&this.data.set(s),!0}commit(e,r){let n=this.target??e.ARRAY_BUFFER,o=r;o.ref?e.bindBuffer(n,o.ref):(e.bindBuffer(n,r),o={ref:r,size:e.getBufferParameter(n,e.BUFFER_SIZE)});let i=this.usedCapacity*this.data.BYTES_PER_ELEMENT;o.size<i?(e.bufferData(n,this.data,e.DYNAMIC_READ),o.size=this.data.byteLength):e.bufferSubData(n,0,this.data,0,this.usedCapacity)}};function W(t){return[(t>>16&255)/255,(t>>8&255)/255,(t&255)/255]}function K(t,e){let r=t.createProgram();for(let n of e.shaders){let o=Nn(t,n);t.attachShader(r,o)}if(t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))throw new Error(`Error linking program:
`+t.getProgramInfoLog(r));return{ref:r,attributes:vr(e.attributes,n=>t.getAttribLocation(r,n)),uniforms:vr(e.uniforms,n=>t.getUniformLocation(r,n))}}function Nn(t,e){let r=t.createShader(e.type);if(t.shaderSource(r,e.source),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){let n={[t.VERTEX_SHADER]:"vertex",[t.FRAGMENT_SHADER]:"fragment"}[e.type]||"a";throw new Error(`Error compiling ${n} shader:
${t.getShaderInfoLog(r)}`)}return r}function vr(t,e){let r={};for(let n of t)r[n]=e(n);return r}var xr=`#version 300 es
precision mediump float;

layout(location = 0) out vec4 fragColor;

void main() {
	fragColor = vec4(1.0, 1.0, 1.0, 1.0);
}
`;var Pr=`#version 300 es

in vec2 aGridPos;

uniform vec2 uOffset;
uniform mat3x2 uViewMatrix;

void main() {
	float side = float(((gl_VertexID & 1) << 1) - 1);
	gl_Position = vec4(
		uViewMatrix * vec3(
			 aGridPos[0] + uOffset[0] * side,
			-aGridPos[1] + uOffset[1] * side,
			1.0
		),
		0.0,
		1.0
	);
}
`;function br(t,e){let r=K(t,{shaders:[{source:Pr,type:t.VERTEX_SHADER},{source:xr,type:t.FRAGMENT_SHADER}],attributes:["aGridPos"],uniforms:["uOffset","uViewMatrix"]}),n=t.createVertexArray();t.bindVertexArray(n);let o=Me(t),i=new he(s=>new Float32Array(s));return t.bindBuffer(t.ARRAY_BUFFER,o.ref),t.enableVertexAttribArray(r.attributes.aGridPos),t.vertexAttribPointer(r.attributes.aGridPos,2,t.FLOAT,!1,0,0),{render(s){let{edges:d}=s;if(d.length===0)return;t.useProgram(r.ref),t.bindVertexArray(n),i.resize(d.length*4,!1);let{data:u}=i,p=0,c=l=>{u[p++]=(l.virtualPos??l).x,u[p++]=(l.virtualPos??l).y};for(let l,h=0;h<d.length;++h)l=d[h],c(l.source),c(l.destination);i.commit(t,o);let b=t.drawingBufferWidth/2,m=t.drawingBufferHeight/2,f=s.gridSize/b,v=s.gridSize/m,C=s.gridOffset.x/b,a=-s.gridOffset.y/m;t.uniform2fv(r.uniforms.uOffset,[X.x/2,X.y/2]),t.uniformMatrix3x2fv(r.uniforms.uViewMatrix,!1,[f,0,0,v,C,a]),t.drawArrays(t.LINES,0,d.length*2)}}}var Sr=`#version 300 es
precision mediump float;

in vec2 vGridPosition;

layout(location = 0) out vec4 fragColor;

uniform float uGridSize;
uniform vec3 uBackgroundColor;
uniform vec3 uGridlineColor;

void main() {
	// Flooring to strictly align to one side, avoiding double-width or disjoint gridlines.
	float halfSize = floor(uGridSize / 2.0);
	float gridlineDist = min(
		abs(floor(mod(vGridPosition[0], uGridSize) - halfSize)),
		abs(floor(mod(vGridPosition[1], uGridSize) - halfSize))
	);

	fragColor = vec4(mix(uBackgroundColor, uGridlineColor, float(gridlineDist == 0.0)), 1.0);
}
`;var Er=`#version 300 es

in vec2 aClipPosition;

out vec2 vGridPosition;

uniform vec2 uScreenSize;
uniform vec2 uGridOffset;

void main() {
	gl_Position = vec4(aClipPosition, 0.0, 1.0);

	// Assuming that aClipPosition is +1 xor -1 and uGridOffset is an integer,
	// the final vGridPosition vector will have integer coordinates.
	vec2 mapping = vec2(
		(aClipPosition[0] * -0.5) + 0.5,
		(aClipPosition[1] *  0.5) + 0.5
	);

	vec2 offset = vec2(
		floor(uScreenSize[0] * 0.5),
		floor(uScreenSize[1] * 0.5)
	);

	vGridPosition = uScreenSize * mapping - offset + uGridOffset;
}
`;function Tr(t,e){let r=K(t,{shaders:[{source:Er,type:t.VERTEX_SHADER},{source:Sr,type:t.FRAGMENT_SHADER}],attributes:["aClipPosition"],uniforms:["uScreenSize","uGridOffset","uGridSize","uBackgroundColor","uGridlineColor"]}),n=t.createVertexArray();t.bindVertexArray(n);let o=t.createBuffer(),i=new Int8Array([-1,-1,1,-1,-1,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_READ),t.enableVertexAttribArray(r.attributes.aClipPosition),t.vertexAttribPointer(r.attributes.aClipPosition,2,t.BYTE,!1,0,0);let s=W(e.backgroundColor),d=W(e.gridlineColor);return{render(u){t.useProgram(r.ref),t.bindVertexArray(n),t.uniform2fv(r.uniforms.uScreenSize,[t.drawingBufferWidth,t.drawingBufferHeight]),t.uniform2fv(r.uniforms.uGridOffset,[u.gridOffset.x,u.gridOffset.y]),t.uniform1f(r.uniforms.uGridSize,u.gridSize),t.uniform3fv(r.uniforms.uBackgroundColor,s),t.uniform3fv(r.uniforms.uGridlineColor,d),t.drawArrays(t.TRIANGLE_STRIP,0,4)}}}var wr=`#version 300 es
precision mediump float;

in vec2 vTexPos;
in vec4 vColor;

layout(location = 0) out vec4 fragColor;

uniform sampler2D uShapes;
uniform vec3 uDefaultStrokeColor;
uniform vec3 uSelectedStrokeColor;

void main() {
	vec4 shape = texture(uShapes, vTexPos);
	vec3 stroke = mix(uDefaultStrokeColor, uSelectedStrokeColor, vColor.w);

	fragColor = vec4(
		mix(stroke, vColor.xyz, shape.y),
		shape.x
	);
}
`;var Ar=`#version 300 es

// shared:
in vec2 aCellPos;

// per-instance:
in vec2 aGridPos;
in uint aColor;
in float aTexIndex;

out vec2 vTexPos;
out vec4 vColor;

uniform mat3x2 uViewMatrix;
uniform float uTexDiv;

void main() {
	gl_Position = vec4(
		uViewMatrix * vec3(
			aCellPos[0] + aGridPos[0],
			aCellPos[1] - aGridPos[1],
			1.0
		),
		0.0,
		1.0
	);

	float size = 1.0 / uTexDiv;
	vTexPos = vec2(
		  mod(aTexIndex,  uTexDiv) / uTexDiv + (aCellPos[0] + 0.5) * size,
		floor(aTexIndex / uTexDiv) / uTexDiv - (aCellPos[1] - 0.5) * size
	);

	vColor = vec4(
		float((aColor >> 16u) & 255u) / 255.0,
		float((aColor >>  8u) & 255u) / 255.0,
		float( aColor         & 255u) / 255.0,

		// w is used to swap between stroke colors
		float((aColor >> 24u) & 255u)
	);
}
`;function Un(t,e){let r=Math.ceil(Math.sqrt(t.length)),n=r*e,o=new OffscreenCanvas(n,n),i=o.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!1});if(!i)throw new Error("Could not obtain offscreen 2D rendering context.");i.clearRect(0,0,n,n);let s=e/2;for(let d=0;d<t.length;++d)t[d](i,s+d%r*e,s+Math.trunc(d/r)*e,s);return{source:o,divisions:r}}var Hn=1/12,Yn="#ffff00",Cr="#ff0000",Rr=Math.PI*2;function Xn(t,e,r,n,o){let i=o*.8;e.fillStyle=Cr,e.beginPath(),e.arc(r+o*X.x,n+o*X.y,o*Qe,0,Rr),e.fill(),e.beginPath(),e.arc(r-o*X.x,n-o*X.y,o*Qe,0,Rr),e.fill(),e.fillStyle=Yn,e.strokeStyle=Cr,e.lineJoin="round",e.lineWidth=Math.max(1,o*Hn),e.beginPath(),e.moveTo(Math.round(r+t[0]*i),Math.round(n+t[1]*i));let s=2;for(;s<t.length;)e.lineTo(Math.round(r+t[s++]*i),Math.round(n+t[s++]*i));e.closePath(),e.fill(),e.stroke()}function Mr(t,e){let r=[];for(let n=0;n<t.length;++n)r.push(Xn.bind(null,t[n]));return Un(r,e)}function Gr(t,e){let r=K(t,{shaders:[{source:Ar,type:t.VERTEX_SHADER},{source:wr,type:t.FRAGMENT_SHADER}],attributes:["aCellPos","aGridPos","aColor","aTexIndex"],uniforms:["uViewMatrix","uTexDiv","uShapes","uDefaultStrokeColor","uSelectedStrokeColor"]}),n=t.createVertexArray();t.bindVertexArray(n);let o=t.createBuffer(),i=new Float32Array([-.5,-.5,.5,-.5,-.5,.5,.5,.5]);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_READ),t.enableVertexAttribArray(r.attributes.aCellPos),t.vertexAttribPointer(r.attributes.aCellPos,2,t.FLOAT,!1,0,0),t.vertexAttribDivisor(r.attributes.aCellPos,0);let s=Me(t),d=new he(m=>new Float32Array(m));t.bindBuffer(t.ARRAY_BUFFER,s.ref),t.enableVertexAttribArray(r.attributes.aGridPos),t.vertexAttribPointer(r.attributes.aGridPos,2,t.FLOAT,!1,16,0),t.vertexAttribDivisor(r.attributes.aGridPos,1),t.enableVertexAttribArray(r.attributes.aColor),t.vertexAttribIPointer(r.attributes.aColor,1,t.UNSIGNED_INT,16,8),t.vertexAttribDivisor(r.attributes.aColor,1),t.enableVertexAttribArray(r.attributes.aTexIndex),t.vertexAttribPointer(r.attributes.aTexIndex,1,t.FLOAT,!1,16,12),t.vertexAttribDivisor(r.attributes.aTexIndex,1);let u=Mr(e.shapes,e.shapeResolution),p=t.createTexture();t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,p),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGB,t.RGB,t.UNSIGNED_BYTE,u.source);let c=W(e.defaultStrokeColor),b=W(e.selectedStrokeColor);return{render(m){let{nodes:f,selectedNodes:v}=m;if(f.length===0)return;t.useProgram(r.ref),t.bindVertexArray(n),d.resize(f.length*4,!1);let{data:C}=d,a=new Uint32Array(C.buffer),l=0;for(let E,w=0;w<f.length;++w)E=f[w],C[l++]=(E.virtualPos??E).x,C[l++]=(E.virtualPos??E).y,a[l++]=(E.color??16777215)|(v.has(E)?16777216:0),C[l++]=E.shapeIndex??0;d.commit(t,s);let h=t.drawingBufferWidth/2,g=t.drawingBufferHeight/2,y=m.gridSize/h,_=m.gridSize/g,x=m.gridOffset.x/h,T=-m.gridOffset.y/g;t.uniform1i(r.uniforms.uShapes,0),t.uniform1f(r.uniforms.uTexDiv,u.divisions),t.uniform3fv(r.uniforms.uDefaultStrokeColor,c),t.uniform3fv(r.uniforms.uSelectedStrokeColor,b),t.uniformMatrix3x2fv(r.uniforms.uViewMatrix,!1,[y,0,0,_,x,T]),t.drawArraysInstanced(t.TRIANGLE_STRIP,0,4,f.length)}}}var kr=`#version 300 es
precision mediump float;

layout(location = 0) out vec4 fragColor;

uniform vec3 uSelectedStrokeColor;
uniform float uDashSize;

void main() {
	float xMod = mod(gl_FragCoord[0], 2.0 * uDashSize);
	float yMod = mod(gl_FragCoord[1], 2.0 * uDashSize);
	float alpha = float(
		(xMod < uDashSize && yMod < uDashSize) ||
		(xMod > uDashSize && yMod > uDashSize)
	);

	fragColor = vec4(uSelectedStrokeColor, alpha);
}
`;var Dr=`#version 300 es

in vec2 aClipPos;

void main() {
	gl_Position = vec4(aClipPos, 0.0, 1.0);
}
`;function Nr(t,e){let r=K(t,{shaders:[{source:Dr,type:t.VERTEX_SHADER},{source:kr,type:t.FRAGMENT_SHADER}],attributes:["aClipPos"],uniforms:["uSelectedStrokeColor","uDashSize"]}),n=t.createVertexArray();t.bindVertexArray(n);let o=t.createBuffer(),i=new Float32Array(8);t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_READ),t.enableVertexAttribArray(r.attributes.aClipPos),t.vertexAttribPointer(r.attributes.aClipPos,2,t.FLOAT,!1,0,0);let s=W(e.selectedStrokeColor);return{render({gridOffset:d,gridSize:u,dragging:p}){if(p?.mode!==0)return;t.useProgram(r.ref),t.bindVertexArray(n);let c=t.drawingBufferWidth/2,b=t.drawingBufferHeight/2,m=(C,a,l)=>{i[l]=(C*u+d.x)/c,i[l+1]=-(a*u+d.y)/b},f=p.start,v=p.offset;m(f.x,f.y,0),m(f.x+v.x,f.y,2),m(f.x+v.x,f.y+v.y,4),m(f.x,f.y+v.y,6),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferSubData(t.ARRAY_BUFFER,0,i),t.uniform1f(r.uniforms.uDashSize,u/4),t.uniform3fv(r.uniforms.uSelectedStrokeColor,s),t.drawArrays(t.LINE_LOOP,0,4)}}}function Ir(t,e){let r=t.getContext("webgl2",{alpha:!1,antialias:!1,depth:!1,desynchronized:!0,failIfMajorPerformanceCaveat:!0,powerPreference:"high-performance",premultipliedAlpha:!1,preserveDrawingBuffer:!1,stencil:!1});if(!r)throw new Error("Could not obtain WebGL rendering context.");r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);let n=Tr(r,e),o=br(r,e),i=Gr(r,e),s=Nr(r,e);return{render(d){n.render(d),o.render(d),i.render(d),s.render(d)},resize(d,u){t.width===d&&t.height===u||(t.width=d,t.height=u,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight))}}}var q=window.devicePixelRatio||1,Fr=class extends $e{canvasCssClass="graph-editor";dragGesture;panAndZoomGesture;selectedNodes=new Set;transitions=new z({duration:300,easing:e=>e**5,keys:["x","y"]});dragging;renderer;constructor(e){super(e);this.dragGesture=new Ke({editor:this}),this.panAndZoomGesture=new Ze({editor:this,usePointerLock:!0}),ce(this.dragGesture.drag,this.onDragMove),ce(this.dragGesture.drop,this.onDragDrop),ce(this.dragGesture.press,this.onNodePress),ce(this.panAndZoomGesture.press,this.onVoidPress)}componentWillUnmount(){super.componentWillUnmount(),this.renderer=void 0}canvasAcquired(e){this.renderer=Ir(e,{backgroundColor:this.props.backgroundColor,gridlineColor:this.props.gridlineColor,defaultStrokeColor:this.props.defaultStrokeColor,selectedStrokeColor:this.props.selectedStrokeColor,shapes:this.props.shapes,shapeResolution:Math.round(this.props.maxZoom*this.props.gridSize*q)})}canvasResized(e,r){this.renderer.resize(Math.round(e*q),Math.round(r*q))}canvasRender(){let e=this.getVisibleRect(),r=this.editorToGridSpace(e.topLeft),n=this.editorToGridSpace(e.bottomRight),o=this.props.graph.getNodesWithin(r.x,r.y,n.x,n.y),i=this.props.graph.getEdgesWithin(r.x,r.y,n.x,n.y),s=z.now();for(let d of o){let u=this.transitions.getFrame(d.id,s);d.virtualPos=u?{x:d.x+u.x,y:d.y+u.y}:void 0}switch(this.dragging?.mode){case 1:{let{offset:d}=this.dragging,u=new Set;for(let p of this.dragging.nodes)o.push(p),p.edges?.forEach(c=>u.add(c)),p.virtualPos={x:p.x+d.x,y:p.y+d.y};u.forEach(p=>i.push(p));break}}return this.renderer.render({gridSize:Math.round(this.zoom*this.props.gridSize*q),gridOffset:{x:Math.round(this.offset.x*q),y:Math.round(this.offset.y*q)},nodes:o,edges:i,selectedNodes:this.selectedNodes,dragging:this.dragging}),this.transitions.hasTransitions}hitTest(e,r){let n=this.editorToGridSpace(e),{graph:o}=this.props;if(r.ctrlKey||r.metaKey)return this.dragging={mode:0,start:n.raw,offset:{...k}},this.updateView(),this.dragGesture;let i=o.getNodeAt(n.x,n.y);if(i){r.shiftKey?this.selectedNodes.has(i)?this.selectedNodes.delete(i):this.selectedNodes.add(i):this.selectedNodes.has(i)||(this.selectedNodes.clear(),this.selectedNodes.add(i));let s=Array.from(this.selectedNodes);return this.dragging={mode:1,offset:{...k},nodes:s},o.beginMoveNodes(s),this.updateView(),this.dragGesture}return this.panAndZoomGesture}getZoomAdjustment(e){let r=this.props.gridSize*q/2;return Math.round(e*r)/r}getWheelDeltaAdjustment(e){switch(e.deltaMode){case WheelEvent.DOM_DELTA_PAGE:return this.edgeBottomRight.y-this.edgeTopLeft.y;case WheelEvent.DOM_DELTA_LINE:return this.props.gridSize;default:return 1}}editorToGridSpace(e){let r={x:e.x/this.props.gridSize,y:e.y/this.props.gridSize},n=Math.round(r.x),o=Math.round(r.y);return{x:n,y:o,raw:r,frac:{x:r.x-n,y:r.y-o}}}onVoidPress=()=>{this.selectedNodes.size>0&&(this.selectedNodes.clear(),this.updateView())};onNodePress=e=>{};onDragMove=e=>{this.dragging.offset=this.editorToGridSpace(e).raw,this.updateView()};onDragDrop=e=>{let r=this.editorToGridSpace(e),n=this.dragging;switch(n.mode){case 1:gr(this.props.graph,n.nodes,this.transitions,r);break;case 0:{let{start:o}=n,i={x:o.x+r.x,y:o.y+r.y},s=this.props.graph.getNodesWithin(Math.round(Math.min(o.x,i.x)),Math.round(Math.min(o.y,i.y)),Math.round(Math.max(o.x,i.x)),Math.round(Math.max(o.y,i.y)));this.selectedNodes.clear(),s.forEach(d=>this.selectedNodes.add(d));break}}this.dragging=void 0,this.updateView()}};var fe=class{constructor(e){this.alphabet=e;let r=e.length;if(r===0)throw new Error("Alphabet cannot be empty.");if((r&r-1)!==0)throw new Error("Alphabet length must be a power of two.");this.shift=Math.trunc(Math.log(r)/Math.LN2),this.mask=Math.trunc(r-1)}shift;mask;index=0;next(){let e="",r=this.index++;do e=this.alphabet[r&this.mask]+e,r>>=this.shift;while(r>0);return e}static createBase32(){return new fe("0123456789abcdefghijklmnopqrstuv")}};function et(t,e){if(!t)return!1;let r=t.indexOf(e);return r===-1?!1:(t.splice(r,1),!0)}var Lr=ct(nt()),ot=class extends Lr.default{toBBox({source:e,destination:r}){return{maxX:Math.max(e.x,r.x),minX:Math.min(e.x,r.x),maxY:Math.max(e.y,r.y),minY:Math.min(e.y,r.y)}}compareMinX(e,r){return Math.min(e.source.x,e.destination.x)-Math.min(r.source.x,r.destination.x)}compareMinY(e,r){return Math.min(e.source.y,e.destination.y)-Math.min(r.source.y,r.destination.y)}};var Br=ct(nt()),it=class extends Br.default{toBBox({x:e,y:r}){return{maxX:e,minX:e,maxY:r,minY:r}}compareMinX(e,r){return e.x-r.x}compareMinY(e,r){return e.y-r.y}};function Ge(t,e,r=t,n=e,o=Number.EPSILON){return{maxX:r+o,minX:t-o,maxY:n+o,minY:e-o}}var st=class{identity;edges=new Set;edgeTree=new ot;nodes=new Set;nodeTree=new it;constructor(e){this.identity=e.identity}createNode(e,r){let n=this.getNodeAt(e,r);return n||(n={id:this.identity.next(),x:e,y:r}),this.nodes.add(n),this.nodeTree.insert(n),n}removeNode(e){return this.nodes.delete(e)?(e.edges?.forEach(r=>this.removeEdge(r)),this.nodeTree.remove(e),!0):!1}createEdge(e,r){if(!this.nodes.has(e)||!this.nodes.has(r))throw new Error("Src and dst nodes must be part of the same graph to form a connection.");let n=this.findEdge(e,r);return n||(n={source:e,destination:r},(e.edges??=[]).push(n),(r.edges??=[]).push(n),this.edges.add(n),this.edgeTree.insert(n)),n}removeEdge(e){return this.edges.delete(e)?(et(e.source.edges,e),et(e.destination.edges,e),!0):!1}beginMoveNodes(e){let r=new Set;for(let n of e)this.nodeTree.remove(n),n.edges?.forEach(o=>r.add(o));r.forEach(n=>this.edgeTree.remove(n))}endMoveNodes(e){let r=new Set;for(let{ref:n,x:o,y:i}of e){if(n.x=o,n.y=i,this.getNodeAt(n.x,n.y))throw new Error("Attempted to move a node to an occupied cell!");this.nodeTree.insert(n),n.edges?.forEach(s=>r.add(s))}this.edgeTree.load(Array.from(r))}getNodeAt(e,r){let n=this.nodeTree.search(Ge(e,r));if(n.length>1)throw new Error(`More than one node found at [ ${e}, ${r} ]`);return n.length>0?n[0]:null}getNodesWithin(e,r,n,o){return this.nodeTree.search(Ge(e,r,n,o))}getEdgesWithin(e,r,n,o){return this.edgeTree.search(Ge(e,r,n,o))}};var at=class extends st{constructor(e){super(e)}findEdge(e,r){let n=e.edges,o=r.edges;return n&&o&&(n.length<o.length?n.find(i=>i.destination===r):o.find(i=>i.source===e))}};var dt=new at({identity:fe.createBase32()});function Or(t,e){return Math.round(t+Math.random()*(e-t))}function De(t,e){return Math.trunc(t+Math.random()*(e-t))}var zr=1e5,$n=5e4,ke=Math.sqrt(zr)*2,lt=[],Ne=0;for(;Ne<zr;){let t=Or(-ke,ke),e=Or(-ke,ke);if(dt.getNodeAt(t,e))continue;let r=dt.createNode(t,e);r.color=De(0,16777215+1),r.shapeIndex=De(0,Ae.length),lt.push(r),++Ne}var Vr=0;for(;Vr<$n;){let t=De(0,Ne),e=De(0,Ne);dt.createEdge(lt[t],lt[e]),++Vr}At(P(pr,null),document.getElementById("root"));})();
//# sourceMappingURL=index.js.map
