(()=>{var Br=Object.create;var he=Object.defineProperty;var Lr=Object.getOwnPropertyDescriptor;var Fr=Object.getOwnPropertyNames;var Or=Object.getPrototypeOf,Vr=Object.prototype.hasOwnProperty;var zr=(t,e,r)=>e in t?he(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Ur=t=>he(t,"__esModule",{value:!0});var Hr=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Yr=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Fr(e))!Vr.call(t,n)&&(r||n!=="default")&&he(t,n,{get:()=>e[n],enumerable:!(o=Lr(e,n))||o.enumerable});return t},ct=(t,e)=>Yr(Ur(he(t!=null?Br(Or(t)):{},"default",!e&&t&&t.__esModule?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var pe=(t,e,r)=>(zr(t,typeof e!="symbol"?e+"":e,r),r);var rt=Hr((et,tt)=>{(function(t,e){typeof et=="object"&&typeof tt<"u"?tt.exports=e():typeof define=="function"&&define.amd?define(e):(t=t||self).RBush=e()})(et,function(){"use strict";function t(s,d,p,m,_){(function g(v,T,S,A,R){for(;A>S;){if(A-S>600){var w=A-S+1,M=T-S+1,ee=Math.log(w),W=.5*Math.exp(2*ee/3),j=.5*Math.sqrt(ee*W*(w-W)/w)*(M-w/2<0?-1:1),q=Math.max(S,Math.floor(T-M*W/w+j)),Nr=Math.min(A,Math.floor(T+(w-M)*W/w+j));g(v,T,q,Nr,R)}var le=v[T],te=S,N=A;for(e(v,S,T),R(v[A],le)>0&&e(v,S,A);te<N;){for(e(v,te,N),te++,N--;R(v[te],le)<0;)te++;for(;R(v[N],le)>0;)N--}R(v[S],le)===0?e(v,S,N):e(v,++N,A),N<=T&&(S=N+1),T<=N&&(A=N-1)}})(s,d,p||0,m||s.length-1,_||r)}function e(s,d,p){var m=s[d];s[d]=s[p],s[p]=m}function r(s,d){return s<d?-1:s>d?1:0}var o=function(s){s===void 0&&(s=9),this._maxEntries=Math.max(4,s),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(s,d,p){if(!p)return d.indexOf(s);for(var m=0;m<d.length;m++)if(p(s,d[m]))return m;return-1}function i(s,d){a(s,0,s.children.length,d,s)}function a(s,d,p,m,_){_||(_=x(null)),_.minX=1/0,_.minY=1/0,_.maxX=-1/0,_.maxY=-1/0;for(var g=d;g<p;g++){var v=s.children[g];c(_,s.leaf?m(v):v)}return _}function c(s,d){return s.minX=Math.min(s.minX,d.minX),s.minY=Math.min(s.minY,d.minY),s.maxX=Math.max(s.maxX,d.maxX),s.maxY=Math.max(s.maxY,d.maxY),s}function l(s,d){return s.minX-d.minX}function h(s,d){return s.minY-d.minY}function u(s){return(s.maxX-s.minX)*(s.maxY-s.minY)}function b(s){return s.maxX-s.minX+(s.maxY-s.minY)}function y(s,d){return s.minX<=d.minX&&s.minY<=d.minY&&d.maxX<=s.maxX&&d.maxY<=s.maxY}function f(s,d){return d.minX<=s.maxX&&d.minY<=s.maxY&&d.maxX>=s.minX&&d.maxY>=s.minY}function x(s){return{children:s,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function C(s,d,p,m,_){for(var g=[d,p];g.length;)if(!((p=g.pop())-(d=g.pop())<=m)){var v=d+Math.ceil((p-d)/m/2)*m;t(s,v,d,p,_),g.push(d,v,v,p)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(s){var d=this.data,p=[];if(!f(s,d))return p;for(var m=this.toBBox,_=[];d;){for(var g=0;g<d.children.length;g++){var v=d.children[g],T=d.leaf?m(v):v;f(s,T)&&(d.leaf?p.push(v):y(s,T)?this._all(v,p):_.push(v))}d=_.pop()}return p},o.prototype.collides=function(s){var d=this.data;if(!f(s,d))return!1;for(var p=[];d;){for(var m=0;m<d.children.length;m++){var _=d.children[m],g=d.leaf?this.toBBox(_):_;if(f(s,g)){if(d.leaf||y(s,g))return!0;p.push(_)}}d=p.pop()}return!1},o.prototype.load=function(s){if(!s||!s.length)return this;if(s.length<this._minEntries){for(var d=0;d<s.length;d++)this.insert(s[d]);return this}var p=this._build(s.slice(),0,s.length-1,0);if(this.data.children.length)if(this.data.height===p.height)this._splitRoot(this.data,p);else{if(this.data.height<p.height){var m=this.data;this.data=p,p=m}this._insert(p,this.data.height-p.height-1,!0)}else this.data=p;return this},o.prototype.insert=function(s){return s&&this._insert(s,this.data.height-1),this},o.prototype.clear=function(){return this.data=x([]),this},o.prototype.remove=function(s,d){if(!s)return this;for(var p,m,_,g=this.data,v=this.toBBox(s),T=[],S=[];g||T.length;){if(g||(g=T.pop(),m=T[T.length-1],p=S.pop(),_=!0),g.leaf){var A=n(s,g.children,d);if(A!==-1)return g.children.splice(A,1),T.push(g),this._condense(T),this}_||g.leaf||!y(g,v)?m?(p++,g=m.children[p],_=!1):g=null:(T.push(g),S.push(p),p=0,m=g,g=g.children[0])}return this},o.prototype.toBBox=function(s){return s},o.prototype.compareMinX=function(s,d){return s.minX-d.minX},o.prototype.compareMinY=function(s,d){return s.minY-d.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(s){return this.data=s,this},o.prototype._all=function(s,d){for(var p=[];s;)s.leaf?d.push.apply(d,s.children):p.push.apply(p,s.children),s=p.pop();return d},o.prototype._build=function(s,d,p,m){var _,g=p-d+1,v=this._maxEntries;if(g<=v)return i(_=x(s.slice(d,p+1)),this.toBBox),_;m||(m=Math.ceil(Math.log(g)/Math.log(v)),v=Math.ceil(g/Math.pow(v,m-1))),(_=x([])).leaf=!1,_.height=m;var T=Math.ceil(g/v),S=T*Math.ceil(Math.sqrt(v));C(s,d,p,S,this.compareMinX);for(var A=d;A<=p;A+=S){var R=Math.min(A+S-1,p);C(s,A,R,T,this.compareMinY);for(var w=A;w<=R;w+=T){var M=Math.min(w+T-1,R);_.children.push(this._build(s,w,M,m-1))}}return i(_,this.toBBox),_},o.prototype._chooseSubtree=function(s,d,p,m){for(;m.push(d),!d.leaf&&m.length-1!==p;){for(var _=1/0,g=1/0,v=void 0,T=0;T<d.children.length;T++){var S=d.children[T],A=u(S),R=(w=s,M=S,(Math.max(M.maxX,w.maxX)-Math.min(M.minX,w.minX))*(Math.max(M.maxY,w.maxY)-Math.min(M.minY,w.minY))-A);R<g?(g=R,_=A<_?A:_,v=S):R===g&&A<_&&(_=A,v=S)}d=v||d.children[0]}var w,M;return d},o.prototype._insert=function(s,d,p){var m=p?s:this.toBBox(s),_=[],g=this._chooseSubtree(m,this.data,d,_);for(g.children.push(s),c(g,m);d>=0&&_[d].children.length>this._maxEntries;)this._split(_,d),d--;this._adjustParentBBoxes(m,_,d)},o.prototype._split=function(s,d){var p=s[d],m=p.children.length,_=this._minEntries;this._chooseSplitAxis(p,_,m);var g=this._chooseSplitIndex(p,_,m),v=x(p.children.splice(g,p.children.length-g));v.height=p.height,v.leaf=p.leaf,i(p,this.toBBox),i(v,this.toBBox),d?s[d-1].children.push(v):this._splitRoot(p,v)},o.prototype._splitRoot=function(s,d){this.data=x([s,d]),this.data.height=s.height+1,this.data.leaf=!1,i(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(s,d,p){for(var m,_,g,v,T,S,A,R=1/0,w=1/0,M=d;M<=p-d;M++){var ee=a(s,0,M,this.toBBox),W=a(s,M,p,this.toBBox),j=(_=ee,g=W,v=void 0,T=void 0,S=void 0,A=void 0,v=Math.max(_.minX,g.minX),T=Math.max(_.minY,g.minY),S=Math.min(_.maxX,g.maxX),A=Math.min(_.maxY,g.maxY),Math.max(0,S-v)*Math.max(0,A-T)),q=u(ee)+u(W);j<R?(R=j,m=M,w=q<w?q:w):j===R&&q<w&&(w=q,m=M)}return m||p-d},o.prototype._chooseSplitAxis=function(s,d,p){var m=s.leaf?this.compareMinX:l,_=s.leaf?this.compareMinY:h;this._allDistMargin(s,d,p,m)<this._allDistMargin(s,d,p,_)&&s.children.sort(m)},o.prototype._allDistMargin=function(s,d,p,m){s.children.sort(m);for(var _=this.toBBox,g=a(s,0,d,_),v=a(s,p-d,p,_),T=b(g)+b(v),S=d;S<p-d;S++){var A=s.children[S];c(g,s.leaf?_(A):A),T+=b(g)}for(var R=p-d-1;R>=d;R--){var w=s.children[R];c(v,s.leaf?_(w):w),T+=b(v)}return T},o.prototype._adjustParentBBoxes=function(s,d,p){for(var m=p;m>=0;m--)c(d[m],s)},o.prototype._condense=function(s){for(var d=s.length-1,p=void 0;d>=0;d--)s[d].children.length===0?d>0?(p=s[d-1].children).splice(p.indexOf(s[d]),1):this.clear():i(s[d],this.toBBox)},o})});var ge,P,ft,Xr,re,mt,ut,_t,me={},yt=[],Wr=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function V(t,e){for(var r in e)t[r]=e[r];return t}function gt(t){var e=t.parentNode;e&&e.removeChild(t)}function E(t,e,r){var o,n,i,a={};for(i in e)i=="key"?o=e[i]:i=="ref"?n=e[i]:a[i]=e[i];if(arguments.length>2&&(a.children=arguments.length>3?ge.call(arguments,2):r),typeof t=="function"&&t.defaultProps!=null)for(i in t.defaultProps)a[i]===void 0&&(a[i]=t.defaultProps[i]);return fe(t,a,o,n,null)}function fe(t,e,r,o,n){var i={type:t,props:e,key:r,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:n??++ft};return n==null&&P.vnode!=null&&P.vnode(i),i}function xe(t){return t.children}function z(t,e){this.props=t,this.context=e}function J(t,e){if(e==null)return t.__?J(t.__,t.__.__k.indexOf(t)+1):null;for(var r;e<t.__k.length;e++)if((r=t.__k[e])!=null&&r.__e!=null)return r.__e;return typeof t.type=="function"?J(t):null}function xt(t){var e,r;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((r=t.__k[e])!=null&&r.__e!=null){t.__e=t.__c.base=r.__e;break}return xt(t)}}function Ie(t){(!t.__d&&(t.__d=!0)&&re.push(t)&&!_e.__r++||ut!==P.debounceRendering)&&((ut=P.debounceRendering)||mt)(_e)}function _e(){for(var t;_e.__r=re.length;)t=re.sort(function(e,r){return e.__v.__b-r.__v.__b}),re=[],t.some(function(e){var r,o,n,i,a,c;e.__d&&(a=(i=(r=e).__v).__e,(c=r.__P)&&(o=[],(n=V({},i)).__v=i.__v+1,Ne(c,i,n,r.__n,c.ownerSVGElement!==void 0,i.__h!=null?[a]:null,o,a??J(i),i.__h),St(o,i),i.__e!=a&&xt(i)))})}function vt(t,e,r,o,n,i,a,c,l,h){var u,b,y,f,x,C,s,d=o&&o.__k||yt,p=d.length;for(r.__k=[],u=0;u<e.length;u++)if((f=r.__k[u]=(f=e[u])==null||typeof f=="boolean"?null:typeof f=="string"||typeof f=="number"||typeof f=="bigint"?fe(null,f,null,null,f):Array.isArray(f)?fe(xe,{children:f},null,null,null):f.__b>0?fe(f.type,f.props,f.key,null,f.__v):f)!=null){if(f.__=r,f.__b=r.__b+1,(y=d[u])===null||y&&f.key==y.key&&f.type===y.type)d[u]=void 0;else for(b=0;b<p;b++){if((y=d[b])&&f.key==y.key&&f.type===y.type){d[b]=void 0;break}y=null}Ne(t,f,y=y||me,n,i,a,c,l,h),x=f.__e,(b=f.ref)&&y.ref!=b&&(s||(s=[]),y.ref&&s.push(y.ref,null,f),s.push(b,f.__c||x,f)),x!=null?(C==null&&(C=x),typeof f.type=="function"&&f.__k===y.__k?f.__d=l=bt(f,l,t):l=Pt(t,f,y,d,x,l),typeof r.type=="function"&&(r.__d=l)):l&&y.__e==l&&l.parentNode!=t&&(l=J(y))}for(r.__e=C,u=p;u--;)d[u]!=null&&(typeof r.type=="function"&&d[u].__e!=null&&d[u].__e==r.__d&&(r.__d=J(o,u+1)),Et(d[u],d[u]));if(s)for(u=0;u<s.length;u++)Tt(s[u],s[++u],s[++u])}function bt(t,e,r){for(var o,n=t.__k,i=0;n&&i<n.length;i++)(o=n[i])&&(o.__=t,e=typeof o.type=="function"?bt(o,e,r):Pt(r,o,o,n,o.__e,e));return e}function Pt(t,e,r,o,n,i){var a,c,l;if(e.__d!==void 0)a=e.__d,e.__d=void 0;else if(r==null||n!=i||n.parentNode==null)e:if(i==null||i.parentNode!==t)t.appendChild(n),a=null;else{for(c=i,l=0;(c=c.nextSibling)&&l<o.length;l+=2)if(c==n)break e;t.insertBefore(n,i),a=i}return a!==void 0?a:n.nextSibling}function Kr(t,e,r,o,n){var i;for(i in r)i==="children"||i==="key"||i in e||ye(t,i,null,r[i],o);for(i in e)n&&typeof e[i]!="function"||i==="children"||i==="key"||i==="value"||i==="checked"||r[i]===e[i]||ye(t,i,e[i],r[i],o)}function lt(t,e,r){e[0]==="-"?t.setProperty(e,r):t[e]=r==null?"":typeof r!="number"||Wr.test(e)?r:r+"px"}function ye(t,e,r,o,n){var i;e:if(e==="style")if(typeof r=="string")t.style.cssText=r;else{if(typeof o=="string"&&(t.style.cssText=o=""),o)for(e in o)r&&e in r||lt(t.style,e,"");if(r)for(e in r)o&&r[e]===o[e]||lt(t.style,e,r[e])}else if(e[0]==="o"&&e[1]==="n")i=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+i]=r,r?o||t.addEventListener(e,i?pt:ht,i):t.removeEventListener(e,i?pt:ht,i);else if(e!=="dangerouslySetInnerHTML"){if(n)e=e.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if(e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in t)try{t[e]=r??"";break e}catch{}typeof r=="function"||(r!=null&&(r!==!1||e[0]==="a"&&e[1]==="r")?t.setAttribute(e,r):t.removeAttribute(e))}}function ht(t){this.l[t.type+!1](P.event?P.event(t):t)}function pt(t){this.l[t.type+!0](P.event?P.event(t):t)}function Ne(t,e,r,o,n,i,a,c,l){var h,u,b,y,f,x,C,s,d,p,m,_=e.type;if(e.constructor!==void 0)return null;r.__h!=null&&(l=r.__h,c=e.__e=r.__e,e.__h=null,i=[c]),(h=P.__b)&&h(e);try{e:if(typeof _=="function"){if(s=e.props,d=(h=_.contextType)&&o[h.__c],p=h?d?d.props.value:h.__:o,r.__c?C=(u=e.__c=r.__c).__=u.__E:("prototype"in _&&_.prototype.render?e.__c=u=new _(s,p):(e.__c=u=new z(s,p),u.constructor=_,u.render=$r),d&&d.sub(u),u.props=s,u.state||(u.state={}),u.context=p,u.__n=o,b=u.__d=!0,u.__h=[]),u.__s==null&&(u.__s=u.state),_.getDerivedStateFromProps!=null&&(u.__s==u.state&&(u.__s=V({},u.__s)),V(u.__s,_.getDerivedStateFromProps(s,u.__s))),y=u.props,f=u.state,b)_.getDerivedStateFromProps==null&&u.componentWillMount!=null&&u.componentWillMount(),u.componentDidMount!=null&&u.__h.push(u.componentDidMount);else{if(_.getDerivedStateFromProps==null&&s!==y&&u.componentWillReceiveProps!=null&&u.componentWillReceiveProps(s,p),!u.__e&&u.shouldComponentUpdate!=null&&u.shouldComponentUpdate(s,u.__s,p)===!1||e.__v===r.__v){u.props=s,u.state=u.__s,e.__v!==r.__v&&(u.__d=!1),u.__v=e,e.__e=r.__e,e.__k=r.__k,e.__k.forEach(function(g){g&&(g.__=e)}),u.__h.length&&a.push(u);break e}u.componentWillUpdate!=null&&u.componentWillUpdate(s,u.__s,p),u.componentDidUpdate!=null&&u.__h.push(function(){u.componentDidUpdate(y,f,x)})}u.context=p,u.props=s,u.state=u.__s,(h=P.__r)&&h(e),u.__d=!1,u.__v=e,u.__P=t,h=u.render(u.props,u.state,u.context),u.state=u.__s,u.getChildContext!=null&&(o=V(V({},o),u.getChildContext())),b||u.getSnapshotBeforeUpdate==null||(x=u.getSnapshotBeforeUpdate(y,f)),m=h!=null&&h.type===xe&&h.key==null?h.props.children:h,vt(t,Array.isArray(m)?m:[m],e,r,o,n,i,a,c,l),u.base=e.__e,e.__h=null,u.__h.length&&a.push(u),C&&(u.__E=u.__=null),u.__e=!1}else i==null&&e.__v===r.__v?(e.__k=r.__k,e.__e=r.__e):e.__e=Zr(r.__e,e,r,o,n,i,a,l);(h=P.diffed)&&h(e)}catch(g){e.__v=null,(l||i!=null)&&(e.__e=c,e.__h=!!l,i[i.indexOf(c)]=null),P.__e(g,e,r)}}function St(t,e){P.__c&&P.__c(e,t),t.some(function(r){try{t=r.__h,r.__h=[],t.some(function(o){o.call(r)})}catch(o){P.__e(o,r.__v)}})}function Zr(t,e,r,o,n,i,a,c){var l,h,u,b=r.props,y=e.props,f=e.type,x=0;if(f==="svg"&&(n=!0),i!=null){for(;x<i.length;x++)if((l=i[x])&&"setAttribute"in l==!!f&&(f?l.localName===f:l.nodeType===3)){t=l,i[x]=null;break}}if(t==null){if(f===null)return document.createTextNode(y);t=n?document.createElementNS("http://www.w3.org/2000/svg",f):document.createElement(f,y.is&&y),i=null,c=!1}if(f===null)b===y||c&&t.data===y||(t.data=y);else{if(i=i&&ge.call(t.childNodes),h=(b=r.props||me).dangerouslySetInnerHTML,u=y.dangerouslySetInnerHTML,!c){if(i!=null)for(b={},x=0;x<t.attributes.length;x++)b[t.attributes[x].name]=t.attributes[x].value;(u||h)&&(u&&(h&&u.__html==h.__html||u.__html===t.innerHTML)||(t.innerHTML=u&&u.__html||""))}if(Kr(t,y,b,n,c),u)e.__k=[];else if(x=e.props.children,vt(t,Array.isArray(x)?x:[x],e,r,o,n&&f!=="foreignObject",i,a,i?i[0]:r.__k&&J(r,0),c),i!=null)for(x=i.length;x--;)i[x]!=null&&gt(i[x]);c||("value"in y&&(x=y.value)!==void 0&&(x!==t.value||f==="progress"&&!x||f==="option"&&x!==b.value)&&ye(t,"value",x,b.value,!1),"checked"in y&&(x=y.checked)!==void 0&&x!==t.checked&&ye(t,"checked",x,b.checked,!1))}return t}function Tt(t,e,r){try{typeof t=="function"?t(e):t.current=e}catch(o){P.__e(o,r)}}function Et(t,e,r){var o,n;if(P.unmount&&P.unmount(t),(o=t.ref)&&(o.current&&o.current!==t.__e||Tt(o,null,e)),(o=t.__c)!=null){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(i){P.__e(i,e)}o.base=o.__P=null}if(o=t.__k)for(n=0;n<o.length;n++)o[n]&&Et(o[n],e,typeof t.type!="function");r||t.__e==null||gt(t.__e),t.__e=t.__d=void 0}function $r(t,e,r){return this.constructor(t,r)}function At(t,e,r){var o,n,i;P.__&&P.__(t,e),n=(o=typeof r=="function")?null:r&&r.__k||e.__k,i=[],Ne(e,t=(!o&&r||e).__k=E(xe,null,[t]),n||me,me,e.ownerSVGElement!==void 0,!o&&r?[r]:n?null:e.firstChild?ge.call(e.childNodes):null,i,!o&&r?r:n?n.__e:e.firstChild,o),St(i,t)}function wt(t,e){var r={__c:e="__cC"+_t++,__:t,Consumer:function(o,n){return o.children(n)},Provider:function(o){var n,i;return this.getChildContext||(n=[],(i={})[e]=this,this.getChildContext=function(){return i},this.shouldComponentUpdate=function(a){this.props.value!==a.value&&n.some(Ie)},this.sub=function(a){n.push(a);var c=a.componentWillUnmount;a.componentWillUnmount=function(){n.splice(n.indexOf(a),1),c&&c.call(a)}}),o.children}};return r.Provider.__=r.Consumer.contextType=r}ge=yt.slice,P={__e:function(t,e){for(var r,o,n;e=e.__;)if((r=e.__c)&&!r.__)try{if((o=r.constructor)&&o.getDerivedStateFromError!=null&&(r.setState(o.getDerivedStateFromError(t)),n=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(t),n=r.__d),n)return r.__E=r}catch(i){t=i}throw t}},ft=0,Xr=function(t){return t!=null&&t.constructor===void 0},z.prototype.setState=function(t,e){var r;r=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=V({},this.state),typeof t=="function"&&(t=t(V({},r),this.props)),t&&V(r,t),t!=null&&this.__v&&(e&&this.__h.push(e),Ie(this))},z.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Ie(this))},z.prototype.render=xe,re=[],mt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,_e.__r=0,_t=0;var G=class extends Error{code;isTranslationError=!0;constructor(e,r){super(`${e} ${r}`),this.code=e}static is(e){return e?.isTranslationError===!0}};pe(G,"FORMAT_UNAVAILABLE","FormatUnavailable"),pe(G,"INVALID_PARAMETER","InvalidParameter"),pe(G,"KEY_NOT_FOUND","KeyNotFound");function Le(t){return t[1]??"variable"}function Ct(t,e){let r=t[0];return e!==void 0&&Object.prototype.hasOwnProperty.call(e,r)?""+e[r]:r}function Rt(t,e){let{length:r}=e,o=Le(t);if(t.length-2>r)throw new G(G.INVALID_PARAMETER,`too many parameters for format '${o}'`);for(let n=0;n<r;++n)e[n].call(null,t[2+n],o,n)}function jr(t,e,r){qr(t)&&Array.isArray(Jr(t))||Qr("a map of messages",e,r)}function qr(t){return t!==null&&typeof t=="object"}function Jr(t){for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function Qr(t,e,r){throw new G(G.INVALID_PARAMETER,`expected parameter ${r+1} of format '${e}' to be ${t}`)}var eo=[jr],to=[],ro=Object.freeze({__proto__:null,select:()=>(t,e)=>{Rt(t,eo);let r=t[2];if(!r.other)throw new G(G.INVALID_PARAMETER,`messages of format '${Le(t)}' must contain the key 'other'`);let o={};for(let n in r)o[n]=e.interpret(r[n]);return n=>(o[Ct(t,n)]??o.other)(n)},variable:()=>t=>(Rt(t,to),e=>Ct(t,e))}),B=class extends Error{input;at;isParseError=!0;constructor(e,r,o){super(e),this.input=r,this.at=o}toString(){let e=Math.max(this.input.lastIndexOf(`
`,this.at-1),0)+1,r=this.input.indexOf(`
`,this.at+1);r===-1?r=this.input.length:this.input[r-1]==="\r"&&--r;let o=`${this.input.slice(e,r)}
${" ".repeat(this.at-e)}^`;return`${this.message} at pos ${this.at}:

${o}

${this.stack}`}static is(e){return e?.isParseError===!0}};function Dt(t){return t===32||t>=9&&t<=13||t===133||t===160||t===6158||t>=8192&&t<=8205||t===8232||t===8233||t===8239||t===8287||t===8288||t===12288||t===65279}function U(t,e){let{length:r}=t,o=e;for(;o<r&&Dt(t.charCodeAt(o));)++o;return o}function oe(t,e){let{length:r}=t,o,n=e;for(;n<r&&(o=t[n],o!=="{"&&o!=="}"&&o!==","&&o!=="#"&&o!=="'"&&o!==":"&&!Dt(o.charCodeAt(0)));)++n;if(e===n)throw new B(`expected an identifier but ${o?`saw '${o}'`:"saw the end of pattern"} instead`,t,e);return t.slice(e,n)}function Mt(t,e,r){let{length:o}=t,n,i=e,a=e,c="";for(;a<o&&(n=t[a],!(n==="{"||n==="}"||r&&n==="#"));){if(n==="'"){if(n=t[++a],n==="'")c+=t.slice(i,a),i=a+1;else if(n==="{"||n==="}"||r&&n==="#"){for(c+=t.slice(i,a-1),i=a;++a<o;)if(n=t[a],n==="'"){if(n=t[a+1],n!=="'")break;c+=t.slice(i,++a),i=a+1}c+=t.slice(i,a),i=++a}}++a}return c+=t.slice(i,a),c}function It(t,e,r,o){let{length:n}=t,i={};r.push(i);let a,c=o,l=[],h=Be(t,e,l,!0);for(i[c]=l;h<n&&(h=U(t,h),a=t[h],a!==","&&a!=="}");){if(c=oe(t,h),h=U(t,h+c.length),a=t[h],a!=="{")throw new B("expected '{'",t,h);l=[],h=Be(t,h+1,l,!0),i[c]=l}return h}function oo(t,e,r,o){let{length:n}=t,i={};r.push(i);let a,c=o,l=U(t,e),h=oe(t,l);for(l+=h.length,i[c]=h;l<n&&(l=U(t,l),a=t[l],a!==","&&a!=="}");){if(c=oe(t,l),l=U(t,l+c.length),a=t[l],a==="{")return It(t,l+1,r,c);if(a!==":")throw new B("expected ':' or '{'",t,l);l=U(t,l+1),h=oe(t,l),l+=h.length,i[c]=h}return l}function no(t,e,r){let o=e,n=t[o];if(n==="#")return r.push("#"),o+1;if(n!=="{")throw new B("expected '#' or '{'",t,o);let{length:i}=t;do{o=U(t,o+1);let a=oe(t,o);switch(o=U(t,o+a.length),n=t[o],n){case",":case"}":r.push(a);break;case"{":if(r.length<2)throw new B("expected an identifier but saw a message instead",t,o);o=It(t,o+1,r,a),n=t[o];break;case":":if(r.length<2)throw new B("expected an identifier but saw an attribute instead",t,o);o=oo(t,o+1,r,a),n=t[o];break;default:throw new B(`unexpected character '${n}'`,t,o)}}while(o<i&&n!=="}");return o+1}function Be(t,e,r,o){let n,i=e,a=Mt(t,i,o);a&&(r.push(a),i+=a.length);let{length:c}=t;for(;i<c;){if(n=t[i],n==="}"){if(!o)throw new B("unexpected '}'",t,i);++i;break}let l=[];i=no(t,i,l),r.push(l),a=Mt(t,i,o),a&&(r.push(a),i+=a.length)}return i}function Gt(t){let e=[];return Be(t,0,e,!1),e}function Nt(t,e,r){for(let o in t){if(o.startsWith("$"))continue;let n=t[o];switch(typeof n){case"string":e[r+o]=n;break;case"object":n!==null&&Nt(n,e,`${r}${o}.`)}}return e}function io(t){return Nt(t,{},"")}function kt(t,e){let r={};for(let o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=e(t[o],o));return r}var Bt=class{formatProvider;constructor(e){this.formatProvider=e}interpret(e,r){let{length:o}=e;if(o===1)return this.interpretElement(e[0],r);let n=new Array(o);for(let i=0;i<o;++i)n[i]=this.interpretElement(e[i],r);return so.bind(null,n)}interpretElement(e,r){if(typeof e=="string")return()=>e;let o=e;if(o.length===1&&o[0]==="#"){if(r===void 0)return()=>"#";o=[r]}return this.formatProvider.getFormat(o)(o,this)}};function so(t,e){let r="";for(let o=0;o<t.length;++o)r+=t[o](e);return r}var Lt=class{formatMap;constructor(e){this.formatMap=e}getFormat(e){let r=Le(e),o=this.formatMap[r];if(!o)throw new G(G.FORMAT_UNAVAILABLE,r);return o}},Q;(function(t){t[t.Eager=0]="Eager",t[t.Lazy=1]="Lazy",t[t.Off=2]="Off"})(Q||(Q={}));var ne=class{cacheMode;expansions;interpreter;constructor({cacheMode:e,interpreter:r,translations:o}){this.cacheMode=e??Q.Lazy,this.interpreter=r,this.expansions=io(o),e===Q.Eager&&(this.expansions=kt(this.expansions,n=>r.interpret(Gt(n))))}expand(e,r){let o=this.expansions[e];if(o===void 0)throw new G(G.KEY_NOT_FOUND,e);return typeof o=="string"&&(o=this.interpreter.interpret(Gt(o)),this.cacheMode!==Q.Off&&(this.expansions[e]=o)),o(r)}static fromLocale(e,r=ro){let o=kt(r,(i,a)=>i(e.$format?.[a])),n=new Lt(o);return new ne({cacheMode:Q.Lazy,interpreter:new Bt(n),translations:e})}};var ie,D,Ft,be=0,Xt=[],Ot=P.__b,Vt=P.__r,zt=P.diffed,Ut=P.__c,Ht=P.unmount;function Pe(t,e){P.__h&&P.__h(D,t,be||e),be=0;var r=D.__H||(D.__H={__:[],__h:[]});return t>=r.__.length&&r.__.push({}),r.__[t]}function Wt(t){return be=1,Oe(jt,t)}function Oe(t,e,r){var o=Pe(ie++,2);return o.t=t,o.__c||(o.__=[r?r(e):jt(void 0,e),function(n){var i=o.t(o.__[0],n);o.__[0]!==i&&(o.__=[i,o.__[1]],o.__c.setState({}))}],o.__c=D),o.__}function Kt(t,e){var r=Pe(ie++,3);!P.__s&&ze(r.__H,e)&&(r.__=t,r.__H=e,D.__H.__h.push(r))}function Zt(t,e){var r=Pe(ie++,4);!P.__s&&ze(r.__H,e)&&(r.__=t,r.__H=e,D.__h.push(r))}function $t(t){return be=5,Ve(function(){return{current:t}},[])}function Ve(t,e){var r=Pe(ie++,7);return ze(r.__H,e)&&(r.__=t(),r.__H=e,r.__h=t),r.__}function ao(){for(var t;t=Xt.shift();)if(t.__P)try{t.__H.__h.forEach(ve),t.__H.__h.forEach(Fe),t.__H.__h=[]}catch(e){t.__H.__h=[],P.__e(e,t.__v)}}P.__b=function(t){D=null,Ot&&Ot(t)},P.__r=function(t){Vt&&Vt(t),ie=0;var e=(D=t.__c).__H;e&&(e.__h.forEach(ve),e.__h.forEach(Fe),e.__h=[])},P.diffed=function(t){zt&&zt(t);var e=t.__c;e&&e.__H&&e.__H.__h.length&&(Xt.push(e)!==1&&Ft===P.requestAnimationFrame||((Ft=P.requestAnimationFrame)||function(r){var o,n=function(){clearTimeout(i),Yt&&cancelAnimationFrame(o),setTimeout(r)},i=setTimeout(n,100);Yt&&(o=requestAnimationFrame(n))})(ao)),D=null},P.__c=function(t,e){e.some(function(r){try{r.__h.forEach(ve),r.__h=r.__h.filter(function(o){return!o.__||Fe(o)})}catch(o){e.some(function(n){n.__h&&(n.__h=[])}),e=[],P.__e(o,r.__v)}}),Ut&&Ut(t,e)},P.unmount=function(t){Ht&&Ht(t);var e,r=t.__c;r&&r.__H&&(r.__H.__.forEach(function(o){try{ve(o)}catch(n){e=n}}),e&&P.__e(e,r.__v))};var Yt=typeof requestAnimationFrame=="function";function ve(t){var e=D,r=t.__c;typeof r=="function"&&(t.__c=void 0,r()),D=e}function Fe(t){var e=D;t.__c=t.__(),D=e}function ze(t,e){return!t||t.length!==e.length||e.some(function(r,o){return r!==t[o]})}function jt(t,e){return typeof e=="function"?e(t):e}var Ue={isLoading:!0,t:()=>""},co=wt(Ue),Se=class extends z{state=Ue;pendingFetch;componentDidMount(){this.fetchLocale()}componentDidUpdate(e){let r=this.props;e.url!==r.url&&this.fetchLocale()}componentWillUnmount(){this.pendingFetch?.abort()}render(){return E(co.Provider,{children:this.props.children,value:this.state})}async fetchLocale(){try{this.setState(Ue),this.pendingFetch=new AbortController;let{credentials:e,headers:r,url:o}=this.props,n=await fetch(o,{credentials:e,headers:r,method:"GET",signal:this.pendingFetch.signal});if(!n.ok)throw new Error(`unexpected HTTP response ${n.status} - ${n.statusText}`);let i=await n.json(),a=ne.fromLocale(i,this.props.formats);this.setState({isLoading:!1,t:uo.bind(null,a)})}catch(e){this.props.onError?.(e),this.setState({isLoading:!1,t:()=>""})}finally{this.pendingFetch=void 0}}};function uo(t,e,r){try{return typeof e=="string"?t.expand(e,r):t.expand(e.key,e.vars)}catch(o){let n;return n=G.is(o)?o.message:B.is(o)?"ParseError":"UnknownError",`⚠️ ${n}`}}var Te=()=>E("div",{class:"box-decorator"});function Ee(t,e){let r=t;for(let o in e)e[o]&&(r+=` ${t}--${o}`);return r}function qt(){let{length:t}=arguments,e="";for(let r,o=0;o<t;++o)(r=arguments[o])&&(e+=(e&&" ")+r);return e}function lo(t,e){return[e]}function Ae(t){let e=[t],r=Oe(lo,e);return Kt(()=>{r[0][0]!==t&&r[1](t)},e),[r[0][0],r[1]]}function we(t,e){let r=t[0]==="-",o=r?1:0;for(;o<t.length&&t[o]==="0";)++o;let n=o;for(;o<t.length&&t[o]!==".";)++o;let i=o;for(o=t.length-1;o>i&&t[o]==="0";)--o;let a=o===i?o:o+1,c=t.slice(n,a);if(n===a)return e&&(e.isNegative=!1,e.isZero=!0,e.separatorAt=1),"0";let l=(r?"-":"")+(n===i&&i!==a?"0":"");return e&&(e.isNegative=r,e.isZero=!1,e.separatorAt=l.length+i-n),l+c}function He(t,e){let r={},o=we(t,r),n={},i=we(e,n);if(r.isNegative!==n.isNegative)return r.isZero&&n.isZero?0:r.isNegative?-1:1;if(r.separatorAt!==n.separatorAt)return r.separatorAt-n.separatorAt;let a=r.isNegative?1:0,c;do c=o.charCodeAt(a)-i.charCodeAt(a);while(c===0&&++a<r.separatorAt);let l=Math.max(o.length,i.length);for(;c===0&&++a<l;)c=(a<o.length?o.charCodeAt(a):48)-(a<i.length?i.charCodeAt(a):48);return r.isNegative?-c:c}var Qt=/^\s*-?[0-9\s]*(?:\s*[.,][0-9\s]*)?$/,ho={sign:"",significant:"0",separator:"",fractional:"",concat:"0"};function po(t,e,r,o){if(!t||!Qt.test(t))return o.index=1,ho;let n="",i="",a=-1,c="",l=0,h=0,u=0,b=0,y=()=>{c+=t.slice(l,h),l=h+1};for(;h<t.length;){let C=t.charCodeAt(h);C===46||C===44?(i=".",a=h-b):(C<48||C>57)&&(y(),++b,C===45?n="-":h<o.index&&++u),++h}y(),o.index-=u,a===-1&&(a=c.length);let f=c.slice(0,a)||"0";e>=1&&(o.index>e&&(o.index-=Math.max(f.length-e,0)),f=f.slice(0,e));let x=c.slice(a+1);return r>=0&&(x=x.slice(0,r),r===0&&(i="")),{sign:n,separator:i,significant:f,fractional:x,concat:c}}function Jt(t,e,r,o){let n=t,i=t.length+(r-1)%e+1;for(;i>e;)i-=e,n=n.slice(0,i)+" "+n.slice(i),o&&i<o.index&&++o.index;return n}var er=t=>{let e=$t(null),[r,o]=Ae(t.value??""),{groupBy:n=0,maxFractional:i=-1,maxSignificant:a=-1}=t,c={index:e.current?.selectionStart??0},l=!r||r==="0"||r==="-0",h=po(r,a,i,c),u=(n>0?Jt(h.significant,n,0,c):h.significant)+h.separator+h.fractional;Zt(()=>{e.current?.setSelectionRange(c.index,c.index)});let b=s=>{if(e.current&&s.target!==e.current){s.preventDefault(),e.current.focus();let d=e.current.getBoundingClientRect(),p=s.x<(d.left+d.right)/2?0:e.current.value.length;e.current.setSelectionRange(p,p)}},y=()=>{let{maxValue:s,minValue:d,onChange:p}=t,m=h.sign+h.concat;d&&He(m,d)<0?o(m=d):s&&He(m,s)>0&&o(m=s),p(we(m))},f=()=>{let s=e.current?.value??"0";o((h.sign?"":"-")+s)},x=s=>{if(s.target!==e.current)return;let d=e.current,p=d.value,m=d.selectionStart??p.length,_=d.selectionEnd??p.length;if(!s.data){s.inputType==="deleteContentBackward"&&h.sign&&(m===0||l&&m===p.length)&&(s.preventDefault(),f());return}if(s.data==="-"&&!h.sign&&(m===0||l)){s.preventDefault(),f();return}let g=p.slice(0,m)+s.data+p.slice(_);Qt.test(g)||s.preventDefault()},C=s=>{if(s.target!==e.current)return;let d=e.current.value;l&&e.current.selectionStart===d.length&&/^0[^0]/.test(d)&&(d=d.slice(1)),o(h.sign+d)};return E("div",{class:"field-number",onPointerDown:b},E("span",{onClick:f,children:h.sign?"- ":"+ ",class:qt("field-number__text",Ee("field-number__sign",{negative:Boolean(h.sign)}))}),(()=>{let s=h.significant.length;if(s>=a)return null;let d="0".repeat(a-s);return E("span",{class:"field-number__text"},n>0?Jt(d,n,s):d)})(),E("div",{class:"field-number__input-wrapper"},E("span",{class:"field-number__text field-number__phantom"},u),E("input",{class:"field-number__input",ref:e,type:"text",inputMode:"decimal",value:u,onBlur:y,onbeforeinput:x,onInput:C})),h.fractional.length<i?E("span",{class:"field-number__text"},(h.separator?"":".")+"0".repeat(i-h.fractional.length)):null,E(Te,null))};var fo=[.85,0,.821,-.22,.736,-.425,.601,-.601,.425,-.736,.22,-.821,0,-.85,-.22,-.821,-.425,-.736,-.601,-.601,-.736,-.425,-.821,-.22,-.85,-0,-.821,.22,-.736,.425,-.601,.601,-.425,.736,-.22,.821,-0,.85,.22,.821,.425,.736,.601,.601,.736,.425,.821,.22],mo=[.85,-.85,-.85,-.85,-.85,.85,.85,.85],_o=[1,0,0,-1,-1,-0,-0,1],yo=[1,-.85,-1,-.85,-0,.85],go=[.577,0,.866,-.5,.289,-.5,0,-1,-.289,-.5,-.866,-.5,-.577,-0,-.866,.5,-.289,.5,-0,1,.289,.5,.866,.5],Ce=[fo,mo,_o,yo,go];var tr=({shape:t,resolution:e=100})=>{let r=Ve(()=>{let o=e/2,n="";for(let i=0;i<t.length;i+=2)n+=`${Math.round(o+t[i]*o)},${Math.round(o+t[i+1]*o)} `;return n},[t,e]);return E("svg",{class:"field-shape__preview",viewBox:`0 0 ${e} ${e}`},E("polygon",{points:r}))};var rr=({onChange:t,value:e=0})=>E("div",{class:"field-shape"},Ce.map((r,o)=>E("button",{class:Ee("field-shape__button",{selected:o===e}),type:"button",key:o,onClick:()=>t(o)},E(tr,{shape:r}))));var or=({onChange:t,value:e})=>{let[r,o]=Ae(e??"");return E("div",{class:"field-text"},E("input",{class:"field-text__input",type:"text",value:r,onInput:n=>o(n.target.value),onChange:()=>t(r)}),E(Te,null))};var Ye=class{fields=[];add(e){return this.fields.push(e),this}};var nr=({fieldSet:t,onChange:e,value:r})=>E("div",{class:"field-set-editor"},t.fields.map(o=>E("div",{class:"field-set-editor__field"},E("span",{class:"field-set-editor__label"},o.title),E(o.kind,{...o.options,key:o.key,value:r?.[o.key],title:o.title,onChange(n){r?.[o.key]!==n&&e({...r,[o.key]:n})}}))));var xo=new Ye().add({key:"shape",kind:rr,title:"Shape"}).add({key:"title",kind:or,title:"Encounter Title"}).add({key:"minLevel",kind:er,title:"Minimum Required Level",options:{minValue:"0",maxValue:"100",maxSignificant:9,maxFractional:3,groupBy:3}}),ir=()=>{let[t,e]=Wt();return E(Se,{url:"./locale/en.json"},E(nr,{fieldSet:xo,value:t,onChange:e}))};function F(){this.t=[]}function L(){this.i=new Set,this.u=[]}function sr(t){return t&&typeof t.then=="function"}function vo(t,e,r){return new Promise((o,n)=>{let{length:i}=e,a=0,c=()=>{--a==0&&o()};for(let l=0;l<i;++l){let h=e[l].call(t,r);sr(h)&&(++a,h.then(c,n))}})}function bo(t,e,r){return new Promise((o,n)=>{let{length:i}=e,a=0,c=()=>{if(a>=i)return void o();let l=e[a++].call(t,r);sr(l)?l.then(c,n):c()};c()})}F.prototype.o=null,F.prototype.h=function(){return this.o||(this.o=this.t.slice()),this.o},F.prototype.l=function(t){this.t.push(t),this.o=null},F.prototype.g=function(){return this.t.length!==0&&(this.t=[],this.o=null,!0)},F.prototype.m=function(){return this.t.length},F.prototype.P=function(t){let{t:e}=this,r,o=e.length-1;for(;o>=0&&(r=e[o],r!==t&&r.p!==t);)--o;return o!==-1&&(this.t.splice(o,1),this.o=null,!0)},F.prototype.v=function(t){let e=this.t.lastIndexOf(t);e!==-1&&(this.t.splice(e,1),this.o=null)},L.prototype.o=null,L.prototype.h=function(){return this.o||(this.o=Array.from(this.i.values()).concat(this.u)),this.o},L.prototype.l=function(t){if(t.p){if(this.i.has(t.p))return;this.u.push(t)}else this.i.add(t),this.A(t);this.o=null},L.prototype.g=function(){return!!this.m()&&(this.i.clear(),this.u=[],this.o=null,!0)},L.prototype.m=function(){return this.i.size+this.u.length},L.prototype.P=function(t){return this.i.delete(t)?(this.o=null,!0):this.A(t)},L.prototype.v=function(t){let e=this.u.lastIndexOf(t);e!==-1&&(this.u.splice(e,1),this.o=null)},L.prototype.A=function(t){let e=this.u.length-1;for(;e>=0;){if(this.u[e].p===t)return this.u.splice(e,1),this.o=null,!0;--e}return!1};var Po={array:F,set:L};function K(t={}){let e=new(Po[t.backend]??F),r=t.async===!0,o=r?function(n,i){let a=i?.parallel?vo:bo;return function(c){return a(this,n.h(),c)}}(e,t):function(n,i){return function(a){let c=n.h(),{length:l}=c;for(let h=0;h<l;++h)c[h].call(this,a)}}(e);return o.S=e,o.isAsync=r,o}function So(t,e){let r=!1,o=function(n){if(!r)return t.S.v(o),r=!0,e.call(this,n)};o.p=e,t.S.l(o)}function se(t,e,r){r?.once?So(t,e):t.S.l(e)}var k={x:0,y:0};function ae(t,e){let r=t.x-e.x,o=t.y-e.y;return Math.sqrt(r*r+o*o)}function Z(t,e=0,r=1){return t<e?e:t>r?r:t}function I(t){return Math.abs(t)<Number.EPSILON}var de=class{press=K();longPress=K();multiPress=K();acceptsNewPointers=!0;editor;state=0;longPressDelay;maxPressDistance;multiPressDelay;longPressTimeout;multiPressCount=0;multiPressTime=0;constructor(e){this.editor=e.editor,this.longPressDelay=e.longPressDelay??800,this.maxPressDistance=e.maxPressDistance??10,this.multiPressDelay=e.multiPressDelay??400}handlePointerDown(e,r){if(r.length>1){this.onChangeState(4);return}this.state=1,this.onMultiPress(e.editor,!1),this.longPressTimeout=setTimeout(()=>this.onLongPress(e.editor),this.longPressDelay)}handlePointerMove(e,r){ae(e.start,e)>this.maxPressDistance&&this.onChangeState(2)}handlePointerUp(e,r){this.state===1&&(this.press(e.editor),this.onMultiPress(e.editor,!0)),this.onChangeState(0)}onChangeState(e){this.longPressTimeout!==void 0&&(clearTimeout(this.longPressTimeout),this.longPressTimeout=void 0),this.state=e}onLongPress(e){this.longPressTimeout=void 0,this.longPress(e),this.onChangeState(3)}onMultiPress(e,r){let o=performance.now();o-this.multiPressTime>this.multiPressDelay?this.multiPressCount=0:r&&++this.multiPressCount>=2&&this.multiPress(e),this.multiPressTime=o}};var We=class extends de{drag=K();drop=K();offset={...k};isDragging=!1;edgeProximity;pushSpeedBasis;pushSpeed={...k};start={...k};animationHandle;lastTimestamp;lastPoint;constructor(e){super(e);this.edgeProximity=e.edgeProximity??64,this.pushSpeedBasis=e.pushSpeed??.5}handlePointerDown(e,r){this.acceptsNewPointers=!1,this.isDragging=!0,this.lastPoint=e,this.start=e.editor,this.offset={...k},this.startPushAnimation(e),super.handlePointerDown(e,r)}handlePointerMove(e,r){this.lastPoint=e,this.offset.x=e.editor.x-this.start.x,this.offset.y=e.editor.y-this.start.y,this.drag(this.offset),this.startPushAnimation(e),super.handlePointerMove(e,r)}handlePointerUp(e,r){this.acceptsNewPointers=!0,this.isDragging=!1,this.stopPushAnimation(),this.drop(this.offset),super.handlePointerUp(e,r)}startPushAnimation(e){this.pushSpeed.x=this.pushSpeedBasis*(Z(1-(e.x-this.editor.edgeTopLeft.x)/this.edgeProximity)-Z(1-(this.editor.edgeBottomRight.x-e.x)/this.edgeProximity)),this.pushSpeed.y=this.pushSpeedBasis*(Z(1-(e.y-this.editor.edgeTopLeft.y)/this.edgeProximity)-Z(1-(this.editor.edgeBottomRight.y-e.y)/this.edgeProximity)),!I(this.pushSpeed.x)||!I(this.pushSpeed.y)?this.animationHandle===void 0&&(this.lastTimestamp=void 0,this.animationHandle=requestAnimationFrame(this.onTick)):this.stopPushAnimation()}stopPushAnimation(){this.animationHandle!==void 0&&(cancelAnimationFrame(this.animationHandle),this.animationHandle=void 0)}onTick=e=>{let r=0;this.lastTimestamp!==void 0&&(r=e-this.lastTimestamp),this.editor.setOffset({x:this.pushSpeed.x*r,y:this.pushSpeed.y*r}),this.offset=this.editor.clientToEditorSpace(this.lastPoint),this.offset.x-=this.start.x,this.offset.y-=this.start.y,this.drag(this.offset),this.lastTimestamp=e,this.animationHandle=requestAnimationFrame(this.onTick)}};var Ke=class extends de{usePointerLock;pinchInitDistance=0;pinchInitZoom=1;isPointerLocked=!1;isPointerLockEligible=!1;constructor(e){super(e);this.usePointerLock=e.usePointerLock??!1,this.usePointerLock&&document.addEventListener("pointerlockchange",this.onPointerLockChange)}dispose(){this.usePointerLock&&document.removeEventListener("pointerlockchange",this.onPointerLockChange)}handlePointerDown(e,r){super.handlePointerDown(e,r),this.isPointerLockEligible=this.usePointerLock&&r.length===1&&e.type==="mouse",r.length===2&&(this.pinchInitDistance=ae(r[0],r[1]),this.pinchInitZoom=this.editor.zoom,this.acceptsNewPointers=!1)}handlePointerMove(e,r){if(super.handlePointerMove(e,r),this.state!==3)if(r.length===2){let o=r[1]===e?r[0]:r[1],n=ae(e,o);this.editor.setZoom(this.pinchInitZoom*n/this.pinchInitDistance,{x:(e.x+o.x)/2,y:(e.y+o.y)/2},!1),this.editor.setOffset({x:(e.x+o.x)/2-(e.x-e.delta.x+o.x)/2,y:(e.y+o.y)/2-(e.y-e.delta.y+o.y)/2})}else this.editor.setOffset({x:e.delta.x,y:e.delta.y})}handlePointerUp(e,r){super.handlePointerUp(e,r),this.acceptsNewPointers=!0,this.isPointerLocked&&document.exitPointerLock()}onChangeState(e){super.onChangeState(e),this.isPointerLockEligible&&e===2&&this.editor.canvas?.requestPointerLock()}onPointerLockChange=()=>{this.isPointerLocked=document.pointerLockElement===this.editor.canvas}};var ar=window.devicePixelRatio||1,Ze=class extends z{zoom;offset={...k};canvas=null;edgeTopLeft={...k};edgeBottomRight={...k};canvasCssClass;pointers=[];rawOffset={...k};rawZoom;gesture=null;frameHandle;observer;constructor(e,r){super(e,r);let o=Math.max((e.minZoom+e.maxZoom)/2,Number.EPSILON);this.zoom=o,this.rawZoom=o}componentDidMount(){let e={passive:!0};window.addEventListener("pointermove",this.onPointerMove,e),window.addEventListener("pointerup",this.onPointerLost,e),window.addEventListener("pointercancel",this.onPointerLost,e)}componentWillUnmount(){window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerLost),window.removeEventListener("pointercancel",this.onPointerLost),this.observer?.disconnect(),this.observer=void 0,this.frameHandle!==void 0&&(cancelAnimationFrame(this.frameHandle),this.frameHandle=void 0)}shouldComponentUpdate(){return!1}render(){return E("canvas",{class:this.canvasCssClass,onContextMenu:dr,onLostPointerCapture:this.onPointerLost,onPointerDown:this.onPointerDown,onWheel:this.onWheel,ref:this.onCanvasRef})}updateView(){this.frameHandle??=requestAnimationFrame(this.onFrame)}clientToEditorSpace(e){return{x:(e.x-(this.edgeTopLeft.x+this.edgeBottomRight.x)/2-this.offset.x)/this.zoom,y:(e.y-(this.edgeTopLeft.y+this.edgeBottomRight.y)/2-this.offset.y)/this.zoom}}getVisibleRect(){return{topLeft:this.clientToEditorSpace(this.edgeTopLeft),bottomRight:this.clientToEditorSpace(this.edgeBottomRight)}}setOffset(e,r=!0){this.rawOffset.x=(r?this.rawOffset.x:0)+e.x,this.rawOffset.y=(r?this.rawOffset.y:0)+e.y;let o=this.getOffsetAdjustment(this.rawOffset);(!I(o.x-this.offset.x)||!I(o.y-this.offset.y))&&(this.offset.x=o.x,this.offset.y=o.y,this.updateView())}setZoom(e,r,o=!0){this.rawZoom=Z((o?this.rawZoom:0)+e,Math.max(this.props.minZoom,Number.EPSILON),this.props.maxZoom);let n=this.getZoomAdjustment(this.rawZoom),i=this.zoom-n;if(I(i))return;let a=this.clientToEditorSpace(r);this.setOffset({x:i*a.x,y:i*a.y}),this.zoom=n,this.updateView()}getOffsetAdjustment(e){return e}getZoomAdjustment(e){return e}getWheelDeltaAdjustment(e){return 1}updateLayout(e=this.canvas.getBoundingClientRect()){this.edgeTopLeft.y=e.top,this.edgeTopLeft.x=e.left,this.edgeBottomRight.y=e.bottom,this.edgeBottomRight.x=e.right}onPointerDown=e=>{let r=this.clientToEditorSpace(e);if(this.gesture===null&&(this.updateLayout(),this.gesture=this.hitTest(r,e)),this.gesture?.acceptsNewPointers===!0){let o={id:e.pointerId,type:e.pointerType,delta:{...k},editor:r,start:{x:e.x,y:e.y},x:e.x,y:e.y};this.pointers.push(o),this.gesture.handlePointerDown(o,this.pointers)}};onPointerMove=e=>{let r=this.pointers.find(({id:o})=>e.pointerId===o);!r||(r.delta.x=e.movementX/ar,r.delta.y=e.movementY/ar,r.type==="mouse"&&document.pointerLockElement?(r.x+=r.delta.x,r.y+=r.delta.y):(r.x=e.x,r.y=e.y),r.editor=this.clientToEditorSpace(r),this.gesture.handlePointerMove(r,this.pointers))};onPointerLost=e=>{let r=this.pointers.findIndex(({id:n})=>e.pointerId===n);if(r===-1)return;let o=this.pointers[r];this.gesture.handlePointerUp(o,this.pointers),this.pointers.splice(r,1),this.pointers.length===0&&(this.gesture=null)};onWheel=e=>{dr(e);let r=-this.getWheelDeltaAdjustment(e);e.ctrlKey?(r/=(this.edgeBottomRight.y-this.edgeTopLeft.y)/3,this.setZoom(e.deltaY*r,e)):this.setOffset({x:(e.shiftKey?e.deltaY:e.deltaX)*r,y:(e.shiftKey?e.deltaX:e.deltaY)*r})};onCanvasRef=e=>{let r=this.canvas;r&&this.observer.unobserve(r),e&&(this.canvasAcquired(e),this.observer??=new ResizeObserver(this.onResizeObserved),this.observer.observe(e,{box:"content-box"})),this.canvas=e};onResizeObserved=e=>{let r=e[0].contentRect;this.updateLayout(r),this.canvasResized(r.width,r.height),this.updateView()};onFrame=()=>{this.frameHandle=this.canvasRender()?requestAnimationFrame(this.onFrame):void 0}};function dr(t){t.preventDefault(),t.stopImmediatePropagation()}function cr(t,e){let{length:r}=t;return r>1&&$e(t,e,0,r-1),t}function Eo(t,e,r,o){let n=t[r+o>>>1],i;for(;r<=o;){for(;e(t[r],n)<0;)++r;for(;e(t[o],n)>0;)--o;r<=o&&(i=t[r],t[r++]=t[o],t[o--]=i)}return r}function $e(t,e,r,o){let n=Eo(t,e,r,o);r<n-1&&$e(t,e,r,n-1),o>n&&$e(t,e,n,o)}var O=class{duration;easing;keys;map=new Map;transitionCount=0;constructor(e){Object.assign(this,e)}get hasTransitions(){return this.transitionCount>0}add(e,r,o=O.now()){let n=this.map.get(e),i=n?.find(c=>I(c.$startTime-o));if(i){for(let c,l=0;l<this.keys.length;++l)c=this.keys[l],i[c]+=r[c]??0;return}i={$startTime:o};let a=!0;for(let c,l,h=0;h<this.keys.length;++h)c=this.keys[h],l=r[c]??0,i[c]=l,a&&=I(l);a||(n||this.map.set(e,n=[]),++this.transitionCount,n.push(i))}getFrame(e,r=O.now()){let o=this.map.get(e);if(!o)return null;let{keys:n}=this,i={};for(let c=0;c<n.length;++c)i[n[c]]=0;let a=0;for(;a<o.length;){let c=o[a],l=1-(r-c.$startTime)/this.duration;if(l<=0){o.splice(a,1),--this.transitionCount;continue}l=this.easing(l);for(let h=0;h<n.length;++h){let u=n[h];i[u]+=c[u]*l}++a}return o.length===0&&this.map.delete(e),i}static now(){return performance.now()}};var je=[1,0,0,-1,-1,0,0,1],qe=class{constructor(e,r=k,o=16){this.graph=e;this.chunkSize=o;this.safeOriginX=Math.floor(r.x-o/2),this.safeOriginY=Math.floor(r.y-o/2)}chunks=new Map;movedCells=[];moves=[];safeOriginX;safeOriginY;searchCounter=0;insertNode(e,r,o){this.findCheapestMoves(r,o).forEach(this.moveCell);let n=this.getChunk(r,o),i=this.getGridIndex(n,r,o);if(n.grid[i])throw new Error("insertNode: cannot insert to an occupied cell");let a={ref:e,x:r,y:o,hasMoved:!0,isFixed:!0};n.grid[i]=a,this.moves.push(a)}commit(){let e=[];for(let r of this.movedCells){let{ref:o,x:n,y:i}=r;I(n-o.x)&&I(i-o.y)||(this.moves.unshift(r),e.push({ref:o,x:o.x-n,y:o.y-i}))}return this.graph.beginMoveNodes(e.map(r=>r.ref)),this.graph.endMoveNodes(this.moves),e}getChunk(e,r){let{chunkSize:o}=this,n=Math.floor((e-this.safeOriginX)/o),i=Math.floor((r-this.safeOriginY)/o),a=ur(n)<<16|ur(i),c=this.chunks.get(a);if(!c){let l=this.safeOriginX+n*o,h=this.safeOriginY+i*o,u=this.graph.getNodesWithin(l,h,l+o-1,h+o-1),b=new Array(o*o);for(let y,f=0;f<u.length;++f)y=u[f],b[(y.x-l)*o+y.y-h]={ref:y,x:y.x,y:y.y,hasMoved:!1};this.chunks.set(a,c={grid:b,baseX:l,baseY:h})}return c}getGridIndex(e,r,o){return(r-e.baseX)*this.chunkSize+o-e.baseY}getCellAt(e,r){let o=this.getChunk(e,r),n=this.getGridIndex(o,e,r);return o.grid[n]}findCheapestMoves(e,r){let o=this.getCellAt(e,r);if(!o)return[];let n=this.searchCounter++,i=[],a=(l,h)=>{l.visit=n;let u=0;do{let b=h.slice();b.unshift({ref:l,x:l.x+je[u++],y:l.y+je[u++]}),i.push(b)}while(u<je.length)};a(o,[]);let c;do{let l=i.shift(),h=this.getCellAt(l[0].x,l[0].y);if(!h){c=l;break}h.visit===n||h.isFixed||a(h,l)}while(i.length>0);if(!c)throw new Error("findCheapestMoves: could not find a path");return c}moveCell=({ref:e,x:r,y:o})=>{let n=this.getChunk(r,o),i=this.getGridIndex(n,r,o);if(n.grid[i])throw new Error("moveCell: cannot move to an occupied cell");let a=this.getChunk(e.x,e.y),c=this.getGridIndex(a,e.x,e.y);a.grid[c]=void 0,e.x=r,e.y=o,n.grid[i]=e,e.hasMoved||(this.movedCells.push(e),e.hasMoved=!0)}};function ur(t){return t>>16&32768|t&32767}function lr(t,e,r,o){let n=0,i=0;for(let h=0;h<e.length;++h){let u=e[h];n+=u.x,i+=u.y}n/=e.length,i/=e.length;let a=h=>(h.x-n)**2+(h.y-i)**2;cr(e,(h,u)=>a(h)-a(u));let c=new qe(t,{x:o.x+n,y:o.y+i}),l=O.now();for(let h of e)c.insertNode(h,h.x+o.x,h.y+o.y),r.add(h.id,o.frac,l);c.commit().forEach(h=>{r.add(h.ref.id,h,l)})}var H={x:0,y:.8},Je=.2;function Re(t){return{ref:t.createBuffer(),size:0}}var ce=class{constructor(e,r){this.alloc=e;this.target=r?.target,this.growthFactor=r?.growthFactor??1.618034,this.data=e(r?.initialCapacity??0)}data;target;growthFactor;usedCapacity=0;get capacity(){return this.data.length}resize(e,r=!0){this.usedCapacity=e;let o=Math.max(this.data.length,1);if(e<o)return!1;let n=Math.ceil(Math.log(e/o)/Math.log(this.growthFactor)),i=Math.trunc(o*this.growthFactor**n),a=this.data;return this.data=this.alloc(i),r&&this.data.set(a),!0}commit(e,r){let o=this.target??e.ARRAY_BUFFER,n=r;n.ref?e.bindBuffer(o,n.ref):(e.bindBuffer(o,r),n={ref:r,size:e.getBufferParameter(o,e.BUFFER_SIZE)});let i=this.usedCapacity*this.data.BYTES_PER_ELEMENT;n.size<i?(e.bufferData(o,this.data,e.DYNAMIC_READ),n.size=this.data.byteLength):e.bufferSubData(o,0,this.data,0,this.usedCapacity)}};function Y(t){return[(t>>16&255)/255,(t>>8&255)/255,(t&255)/255]}function X(t,e){let r=t.createProgram();for(let o of e.shaders){let n=Ao(t,o);t.attachShader(r,n)}if(t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))throw new Error(`Error linking program:
`+t.getProgramInfoLog(r));return{ref:r,attributes:hr(e.attributes,o=>t.getAttribLocation(r,o)),uniforms:hr(e.uniforms,o=>t.getUniformLocation(r,o))}}function Ao(t,e){let r=t.createShader(e.type);if(t.shaderSource(r,e.source),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){let o={[t.VERTEX_SHADER]:"vertex",[t.FRAGMENT_SHADER]:"fragment"}[e.type]||"a";throw new Error(`Error compiling ${o} shader:
${t.getShaderInfoLog(r)}`)}return r}function hr(t,e){let r={};for(let o of t)r[o]=e(o);return r}var pr=`#version 300 es
precision mediump float;

layout(location = 0) out vec4 fragColor;

void main() {
	fragColor = vec4(1.0, 1.0, 1.0, 1.0);
}
`;var fr=`#version 300 es

in vec2 aGridPos;

uniform vec2 uOffset;
uniform mat3x2 uViewMatrix;

void main() {
	float side = float(((gl_VertexID & 1) << 1) - 1);
	gl_Position = vec4(
		uViewMatrix * vec3(
			 aGridPos[0] + uOffset[0] * side,
			-aGridPos[1] + uOffset[1] * side,
			1.0
		),
		0.0,
		1.0
	);
}
`;function mr(t,e){let r=X(t,{shaders:[{source:fr,type:t.VERTEX_SHADER},{source:pr,type:t.FRAGMENT_SHADER}],attributes:["aGridPos"],uniforms:["uOffset","uViewMatrix"]}),o=t.createVertexArray();t.bindVertexArray(o);let n=Re(t),i=new ce(a=>new Float32Array(a));return t.bindBuffer(t.ARRAY_BUFFER,n.ref),t.enableVertexAttribArray(r.attributes.aGridPos),t.vertexAttribPointer(r.attributes.aGridPos,2,t.FLOAT,!1,0,0),{render(a){let{edges:c}=a;if(c.length===0)return;t.useProgram(r.ref),t.bindVertexArray(o),i.resize(c.length*4,!1);let{data:l}=i,h=0,u=d=>{l[h++]=(d.virtualPos??d).x,l[h++]=(d.virtualPos??d).y};for(let d,p=0;p<c.length;++p)d=c[p],u(d.source),u(d.destination);i.commit(t,n);let b=t.drawingBufferWidth/2,y=t.drawingBufferHeight/2,f=a.gridSize/b,x=a.gridSize/y,C=a.gridOffset.x/b,s=-a.gridOffset.y/y;t.uniform2fv(r.uniforms.uOffset,[H.x/2,H.y/2]),t.uniformMatrix3x2fv(r.uniforms.uViewMatrix,!1,[f,0,0,x,C,s]),t.drawArrays(t.LINES,0,c.length*2)}}}var _r=`#version 300 es
precision mediump float;

in vec2 vGridPosition;

layout(location = 0) out vec4 fragColor;

uniform float uGridSize;
uniform vec3 uBackgroundColor;
uniform vec3 uGridlineColor;

void main() {
	// Flooring to strictly align to one side, avoiding double-width or disjoint gridlines.
	float halfSize = floor(uGridSize / 2.0);
	float gridlineDist = min(
		abs(floor(mod(vGridPosition[0], uGridSize) - halfSize)),
		abs(floor(mod(vGridPosition[1], uGridSize) - halfSize))
	);

	fragColor = vec4(mix(uBackgroundColor, uGridlineColor, float(gridlineDist == 0.0)), 1.0);
}
`;var yr=`#version 300 es

in vec2 aClipPosition;

out vec2 vGridPosition;

uniform vec2 uScreenSize;
uniform vec2 uGridOffset;

void main() {
	gl_Position = vec4(aClipPosition, 0.0, 1.0);

	// Assuming that aClipPosition is +1 xor -1 and uGridOffset is an integer,
	// the final vGridPosition vector will have integer coordinates.
	vec2 mapping = vec2(
		(aClipPosition[0] * -0.5) + 0.5,
		(aClipPosition[1] *  0.5) + 0.5
	);

	vec2 offset = vec2(
		floor(uScreenSize[0] * 0.5),
		floor(uScreenSize[1] * 0.5)
	);

	vGridPosition = uScreenSize * mapping - offset + uGridOffset;
}
`;function gr(t,e){let r=X(t,{shaders:[{source:yr,type:t.VERTEX_SHADER},{source:_r,type:t.FRAGMENT_SHADER}],attributes:["aClipPosition"],uniforms:["uScreenSize","uGridOffset","uGridSize","uBackgroundColor","uGridlineColor"]}),o=t.createVertexArray();t.bindVertexArray(o);let n=t.createBuffer(),i=new Int8Array([-1,-1,1,-1,-1,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_READ),t.enableVertexAttribArray(r.attributes.aClipPosition),t.vertexAttribPointer(r.attributes.aClipPosition,2,t.BYTE,!1,0,0);let a=Y(e.backgroundColor),c=Y(e.gridlineColor);return{render(l){t.useProgram(r.ref),t.bindVertexArray(o),t.uniform2fv(r.uniforms.uScreenSize,[t.drawingBufferWidth,t.drawingBufferHeight]),t.uniform2fv(r.uniforms.uGridOffset,[l.gridOffset.x,l.gridOffset.y]),t.uniform1f(r.uniforms.uGridSize,l.gridSize),t.uniform3fv(r.uniforms.uBackgroundColor,a),t.uniform3fv(r.uniforms.uGridlineColor,c),t.drawArrays(t.TRIANGLE_STRIP,0,4)}}}var xr=`#version 300 es
precision mediump float;

in vec2 vTexPos;
in vec4 vColor;

layout(location = 0) out vec4 fragColor;

uniform sampler2D uShapes;
uniform vec3 uDefaultStrokeColor;
uniform vec3 uSelectedStrokeColor;

void main() {
	vec4 shape = texture(uShapes, vTexPos);
	vec3 stroke = mix(uDefaultStrokeColor, uSelectedStrokeColor, vColor.w);

	fragColor = vec4(
		mix(stroke, vColor.xyz, shape.y),
		shape.x
	);
}
`;var vr=`#version 300 es

// shared:
in vec2 aCellPos;

// per-instance:
in vec2 aGridPos;
in uint aColor;
in float aTexIndex;

out vec2 vTexPos;
out vec4 vColor;

uniform mat3x2 uViewMatrix;
uniform float uTexDiv;

void main() {
	gl_Position = vec4(
		uViewMatrix * vec3(
			aCellPos[0] + aGridPos[0],
			aCellPos[1] - aGridPos[1],
			1.0
		),
		0.0,
		1.0
	);

	float size = 1.0 / uTexDiv;
	vTexPos = vec2(
		  mod(aTexIndex,  uTexDiv) / uTexDiv + (aCellPos[0] + 0.5) * size,
		floor(aTexIndex / uTexDiv) / uTexDiv - (aCellPos[1] - 0.5) * size
	);

	vColor = vec4(
		float((aColor >> 16u) & 255u) / 255.0,
		float((aColor >>  8u) & 255u) / 255.0,
		float( aColor         & 255u) / 255.0,

		// w is used to swap between stroke colors
		float((aColor >> 24u) & 255u)
	);
}
`;function Io(t,e){let r=Math.ceil(Math.sqrt(t.length)),o=r*e,n=new OffscreenCanvas(o,o),i=n.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!1});if(!i)throw new Error("Could not obtain offscreen 2D rendering context.");i.clearRect(0,0,o,o);let a=e/2;for(let c=0;c<t.length;++c)t[c](i,a+c%r*e,a+Math.trunc(c/r)*e,a);return{source:n,divisions:r}}var No=1/12,Bo="#ffff00",br="#ff0000",Pr=Math.PI*2;function Lo(t,e,r,o,n){let i=n*.8;e.fillStyle=br,e.beginPath(),e.arc(r+n*H.x,o+n*H.y,n*Je,0,Pr),e.fill(),e.beginPath(),e.arc(r-n*H.x,o-n*H.y,n*Je,0,Pr),e.fill(),e.fillStyle=Bo,e.strokeStyle=br,e.lineJoin="round",e.lineWidth=Math.max(1,n*No),e.beginPath(),e.moveTo(Math.round(r+t[0]*i),Math.round(o+t[1]*i));let a=2;for(;a<t.length;)e.lineTo(Math.round(r+t[a++]*i),Math.round(o+t[a++]*i));e.closePath(),e.fill(),e.stroke()}function Sr(t,e){let r=[];for(let o=0;o<t.length;++o)r.push(Lo.bind(null,t[o]));return Io(r,e)}function Tr(t,e){let r=X(t,{shaders:[{source:vr,type:t.VERTEX_SHADER},{source:xr,type:t.FRAGMENT_SHADER}],attributes:["aCellPos","aGridPos","aColor","aTexIndex"],uniforms:["uViewMatrix","uTexDiv","uShapes","uDefaultStrokeColor","uSelectedStrokeColor"]}),o=t.createVertexArray();t.bindVertexArray(o);let n=t.createBuffer(),i=new Float32Array([-.5,-.5,.5,-.5,-.5,.5,.5,.5]);t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_READ),t.enableVertexAttribArray(r.attributes.aCellPos),t.vertexAttribPointer(r.attributes.aCellPos,2,t.FLOAT,!1,0,0),t.vertexAttribDivisor(r.attributes.aCellPos,0);let a=Re(t),c=new ce(y=>new Float32Array(y));t.bindBuffer(t.ARRAY_BUFFER,a.ref),t.enableVertexAttribArray(r.attributes.aGridPos),t.vertexAttribPointer(r.attributes.aGridPos,2,t.FLOAT,!1,16,0),t.vertexAttribDivisor(r.attributes.aGridPos,1),t.enableVertexAttribArray(r.attributes.aColor),t.vertexAttribIPointer(r.attributes.aColor,1,t.UNSIGNED_INT,16,8),t.vertexAttribDivisor(r.attributes.aColor,1),t.enableVertexAttribArray(r.attributes.aTexIndex),t.vertexAttribPointer(r.attributes.aTexIndex,1,t.FLOAT,!1,16,12),t.vertexAttribDivisor(r.attributes.aTexIndex,1);let l=Sr(e.shapes,e.shapeResolution),h=t.createTexture();t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,h),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGB,t.RGB,t.UNSIGNED_BYTE,l.source);let u=Y(e.defaultStrokeColor),b=Y(e.selectedStrokeColor);return{render(y){let{nodes:f,selectedNodes:x}=y;if(f.length===0)return;t.useProgram(r.ref),t.bindVertexArray(o),c.resize(f.length*4,!1);let{data:C}=c,s=new Uint32Array(C.buffer),d=0;for(let S,A=0;A<f.length;++A)S=f[A],C[d++]=(S.virtualPos??S).x,C[d++]=(S.virtualPos??S).y,s[d++]=(S.color??16777215)|(x.has(S)?16777216:0),C[d++]=S.shapeIndex??0;c.commit(t,a);let p=t.drawingBufferWidth/2,m=t.drawingBufferHeight/2,_=y.gridSize/p,g=y.gridSize/m,v=y.gridOffset.x/p,T=-y.gridOffset.y/m;t.uniform1i(r.uniforms.uShapes,0),t.uniform1f(r.uniforms.uTexDiv,l.divisions),t.uniform3fv(r.uniforms.uDefaultStrokeColor,u),t.uniform3fv(r.uniforms.uSelectedStrokeColor,b),t.uniformMatrix3x2fv(r.uniforms.uViewMatrix,!1,[_,0,0,g,v,T]),t.drawArraysInstanced(t.TRIANGLE_STRIP,0,4,f.length)}}}var Er=`#version 300 es
precision mediump float;

layout(location = 0) out vec4 fragColor;

uniform vec3 uSelectedStrokeColor;
uniform float uDashSize;

void main() {
	float xMod = mod(gl_FragCoord[0], 2.0 * uDashSize);
	float yMod = mod(gl_FragCoord[1], 2.0 * uDashSize);
	float alpha = float(
		(xMod < uDashSize && yMod < uDashSize) ||
		(xMod > uDashSize && yMod > uDashSize)
	);

	fragColor = vec4(uSelectedStrokeColor, alpha);
}
`;var Ar=`#version 300 es

in vec2 aClipPos;

void main() {
	gl_Position = vec4(aClipPos, 0.0, 1.0);
}
`;function wr(t,e){let r=X(t,{shaders:[{source:Ar,type:t.VERTEX_SHADER},{source:Er,type:t.FRAGMENT_SHADER}],attributes:["aClipPos"],uniforms:["uSelectedStrokeColor","uDashSize"]}),o=t.createVertexArray();t.bindVertexArray(o);let n=t.createBuffer(),i=new Float32Array(8);t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_READ),t.enableVertexAttribArray(r.attributes.aClipPos),t.vertexAttribPointer(r.attributes.aClipPos,2,t.FLOAT,!1,0,0);let a=Y(e.selectedStrokeColor);return{render({gridOffset:c,gridSize:l,dragging:h}){if(h?.mode!==0)return;t.useProgram(r.ref),t.bindVertexArray(o);let u=t.drawingBufferWidth/2,b=t.drawingBufferHeight/2,y=(C,s,d)=>{i[d]=(C*l+c.x)/u,i[d+1]=-(s*l+c.y)/b},f=h.start,x=h.offset;y(f.x,f.y,0),y(f.x+x.x,f.y,2),y(f.x+x.x,f.y+x.y,4),y(f.x,f.y+x.y,6),t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferSubData(t.ARRAY_BUFFER,0,i),t.uniform1f(r.uniforms.uDashSize,l/4),t.uniform3fv(r.uniforms.uSelectedStrokeColor,a),t.drawArrays(t.LINE_LOOP,0,4)}}}function Cr(t,e){let r=t.getContext("webgl2",{alpha:!1,antialias:!1,depth:!1,desynchronized:!0,failIfMajorPerformanceCaveat:!0,powerPreference:"high-performance",premultipliedAlpha:!1,preserveDrawingBuffer:!1,stencil:!1});if(!r)throw new Error("Could not obtain WebGL rendering context.");r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);let o=gr(r,e),n=mr(r,e),i=Tr(r,e),a=wr(r,e);return{render(c){o.render(c),n.render(c),i.render(c),a.render(c)},resize(c,l){t.width===c&&t.height===l||(t.width=c,t.height=l,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight))}}}var $=window.devicePixelRatio||1,Rr=class extends Ze{canvasCssClass="graph-editor";dragGesture;panAndZoomGesture;selectedNodes=new Set;transitions=new O({duration:300,easing:e=>e**5,keys:["x","y"]});dragging;renderer;constructor(e){super(e);this.dragGesture=new We({editor:this}),this.panAndZoomGesture=new Ke({editor:this,usePointerLock:!0}),se(this.dragGesture.drag,this.onDragMove),se(this.dragGesture.drop,this.onDragDrop),se(this.dragGesture.press,this.onNodePress),se(this.panAndZoomGesture.press,this.onVoidPress)}componentWillUnmount(){super.componentWillUnmount(),this.renderer=void 0}canvasAcquired(e){this.renderer=Cr(e,{backgroundColor:this.props.backgroundColor,gridlineColor:this.props.gridlineColor,defaultStrokeColor:this.props.defaultStrokeColor,selectedStrokeColor:this.props.selectedStrokeColor,shapes:this.props.shapes,shapeResolution:Math.round(this.props.maxZoom*this.props.gridSize*$)})}canvasResized(e,r){this.renderer.resize(Math.round(e*$),Math.round(r*$))}canvasRender(){let e=this.getVisibleRect(),r=this.editorToGridSpace(e.topLeft),o=this.editorToGridSpace(e.bottomRight),n=this.props.graph.getNodesWithin(r.x,r.y,o.x,o.y),i=this.props.graph.getEdgesWithin(r.x,r.y,o.x,o.y),a=O.now();for(let c of n){let l=this.transitions.getFrame(c.id,a);c.virtualPos=l?{x:c.x+l.x,y:c.y+l.y}:void 0}switch(this.dragging?.mode){case 1:{let{offset:c}=this.dragging,l=new Set;for(let h of this.dragging.nodes)n.push(h),h.edges?.forEach(u=>l.add(u)),h.virtualPos={x:h.x+c.x,y:h.y+c.y};l.forEach(h=>i.push(h));break}}return this.renderer.render({gridSize:Math.round(this.zoom*this.props.gridSize*$),gridOffset:{x:Math.round(this.offset.x*$),y:Math.round(this.offset.y*$)},nodes:n,edges:i,selectedNodes:this.selectedNodes,dragging:this.dragging}),this.transitions.hasTransitions}hitTest(e,r){let o=this.editorToGridSpace(e),{graph:n}=this.props;if(r.ctrlKey||r.metaKey)return this.dragging={mode:0,start:o.raw,offset:{...k}},this.updateView(),this.dragGesture;let i=n.getNodeAt(o.x,o.y);if(i){r.shiftKey?this.selectedNodes.has(i)?this.selectedNodes.delete(i):this.selectedNodes.add(i):this.selectedNodes.has(i)||(this.selectedNodes.clear(),this.selectedNodes.add(i));let a=Array.from(this.selectedNodes);return this.dragging={mode:1,offset:{...k},nodes:a},n.beginMoveNodes(a),this.updateView(),this.dragGesture}return this.panAndZoomGesture}getZoomAdjustment(e){let r=this.props.gridSize*$/2;return Math.round(e*r)/r}getWheelDeltaAdjustment(e){switch(e.deltaMode){case WheelEvent.DOM_DELTA_PAGE:return this.edgeBottomRight.y-this.edgeTopLeft.y;case WheelEvent.DOM_DELTA_LINE:return this.props.gridSize;default:return 1}}editorToGridSpace(e){let r={x:e.x/this.props.gridSize,y:e.y/this.props.gridSize},o=Math.round(r.x),n=Math.round(r.y);return{x:o,y:n,raw:r,frac:{x:r.x-o,y:r.y-n}}}onVoidPress=()=>{this.selectedNodes.size>0&&(this.selectedNodes.clear(),this.updateView())};onNodePress=e=>{};onDragMove=e=>{this.dragging.offset=this.editorToGridSpace(e).raw,this.updateView()};onDragDrop=e=>{let r=this.editorToGridSpace(e),o=this.dragging;switch(o.mode){case 1:lr(this.props.graph,o.nodes,this.transitions,r);break;case 0:{let{start:n}=o,i={x:n.x+r.x,y:n.y+r.y},a=this.props.graph.getNodesWithin(Math.round(Math.min(n.x,i.x)),Math.round(Math.min(n.y,i.y)),Math.round(Math.max(n.x,i.x)),Math.round(Math.max(n.y,i.y)));this.selectedNodes.clear(),a.forEach(c=>this.selectedNodes.add(c));break}}this.dragging=void 0,this.updateView()}};var ue=class{constructor(e){this.alphabet=e;let r=e.length;if(r===0)throw new Error("Alphabet cannot be empty.");if((r&r-1)!==0)throw new Error("Alphabet length must be a power of two.");this.shift=Math.trunc(Math.log(r)/Math.LN2),this.mask=Math.trunc(r-1)}shift;mask;index=0;next(){let e="",r=this.index++;do e=this.alphabet[r&this.mask]+e,r>>=this.shift;while(r>0);return e}static createBase32(){return new ue("0123456789abcdefghijklmnopqrstuv")}};function Qe(t,e){if(!t)return!1;let r=t.indexOf(e);return r===-1?!1:(t.splice(r,1),!0)}var Mr=ct(rt()),ot=class extends Mr.default{toBBox({source:e,destination:r}){return{maxX:Math.max(e.x,r.x),minX:Math.min(e.x,r.x),maxY:Math.max(e.y,r.y),minY:Math.min(e.y,r.y)}}compareMinX(e,r){return Math.min(e.source.x,e.destination.x)-Math.min(r.source.x,r.destination.x)}compareMinY(e,r){return Math.min(e.source.y,e.destination.y)-Math.min(r.source.y,r.destination.y)}};var Gr=ct(rt()),nt=class extends Gr.default{toBBox({x:e,y:r}){return{maxX:e,minX:e,maxY:r,minY:r}}compareMinX(e,r){return e.x-r.x}compareMinY(e,r){return e.y-r.y}};function Me(t,e,r=t,o=e,n=Number.EPSILON){return{maxX:r+n,minX:t-n,maxY:o+n,minY:e-n}}var it=class{identity;edges=new Set;edgeTree=new ot;nodes=new Set;nodeTree=new nt;constructor(e){this.identity=e.identity}createNode(e,r){let o=this.getNodeAt(e,r);return o||(o={id:this.identity.next(),x:e,y:r}),this.nodes.add(o),this.nodeTree.insert(o),o}removeNode(e){return this.nodes.delete(e)?(e.edges?.forEach(r=>this.removeEdge(r)),this.nodeTree.remove(e),!0):!1}createEdge(e,r){if(!this.nodes.has(e)||!this.nodes.has(r))throw new Error("Src and dst nodes must be part of the same graph to form a connection.");let o=this.findEdge(e,r);return o||(o={source:e,destination:r},(e.edges??=[]).push(o),(r.edges??=[]).push(o),this.edges.add(o),this.edgeTree.insert(o)),o}removeEdge(e){return this.edges.delete(e)?(Qe(e.source.edges,e),Qe(e.destination.edges,e),!0):!1}beginMoveNodes(e){let r=new Set;for(let o of e)this.nodeTree.remove(o),o.edges?.forEach(n=>r.add(n));r.forEach(o=>this.edgeTree.remove(o))}endMoveNodes(e){let r=new Set;for(let{ref:o,x:n,y:i}of e){if(o.x=n,o.y=i,this.getNodeAt(o.x,o.y))throw new Error("Attempted to move a node to an occupied cell!");this.nodeTree.insert(o),o.edges?.forEach(a=>r.add(a))}this.edgeTree.load(Array.from(r))}getNodeAt(e,r){let o=this.nodeTree.search(Me(e,r));if(o.length>1)throw new Error(`More than one node found at [ ${e}, ${r} ]`);return o.length>0?o[0]:null}getNodesWithin(e,r,o,n){return this.nodeTree.search(Me(e,r,o,n))}getEdgesWithin(e,r,o,n){return this.edgeTree.search(Me(e,r,o,n))}};var st=class extends it{constructor(e){super(e)}findEdge(e,r){let o=e.edges,n=r.edges;return o&&n&&(o.length<n.length?o.find(i=>i.destination===r):n.find(i=>i.source===e))}};var at=new st({identity:ue.createBase32()});function kr(t,e){return Math.round(t+Math.random()*(e-t))}function ke(t,e){return Math.trunc(t+Math.random()*(e-t))}var Ir=1e5,zo=5e4,Ge=Math.sqrt(Ir)*2,dt=[],De=0;for(;De<Ir;){let t=kr(-Ge,Ge),e=kr(-Ge,Ge);if(at.getNodeAt(t,e))continue;let r=at.createNode(t,e);r.color=ke(0,16777215+1),r.shapeIndex=ke(0,Ce.length),dt.push(r),++De}var Dr=0;for(;Dr<zo;){let t=ke(0,De),e=ke(0,De);at.createEdge(dt[t],dt[e]),++Dr}At(E(ir,null),document.getElementById("root"));})();
//# sourceMappingURL=index.js.map
