"use strict";function t({binsPerSecond:t,onBinAvailable:e}){const n=sampleRate/t;let r=0,s=0;return t=>{++s>=n&&(e(r),r=0,s=0),r=Math.max(r,Math.abs(t))}}class e extends AudioWorkletProcessor{isEnabled=!1;#t;constructor(t){super(),this.#t=t(this.port),this.port.start(),this.port.addEventListener("message",(t=>{if("enable"===t.data.kind)this.isEnabled=t.data.value}))}process(t,e,n){if(!(this.isEnabled&&t.length>=1&&t[0].length>=1))return!0;const r=t[0][0],{length:s}=r;let a,i;for(a of this.#t)for(i=0;i<s;++i)a(r[i]);return!0}static create(t){return class extends e{constructor(){super(t)}}}}function n({fMin:t,fMax:e,windowLength:n,windowOffset:r,threshold:s,onPitchAvailable:a}){const i=2*e,o=Math.trunc(sampleRate/i)-1,c=Math.trunc(sampleRate/o),l=Math.trunc(n*c),h=Math.trunc(r*c),u=Math.trunc(c/e),f=Math.trunc(c/t),d=new Array(l+h),b=new Array(f),M=new Array(f);let p=0,w=0;return t=>{if(!(++w<o)&&(d[p]=t,w=0,++p>=l+h)){d.copyWithin(0,h),p=l;const t=(()=>{let t,e,n,r,a=0;for(t=1;t<f;++t)for(b[t]=0,e=l-t,n=0;n<e;++n)r=d[n]-d[n+t],b[t]+=r*r;for(n=1;n<f;++n)a+=b[n],M[n]=b[n]*n/a;for(M[0]=1,t=u;t<f;++t)if(M[t]<s){for(;t+1<f&&M[t+1]<M[t];)++t;return c/t}return 0})();t>0&&a(t)}}}registerProcessor("listener",e.create((e=>[n({fMin:50,fMax:2500,windowLength:.1,windowOffset:.025,threshold:.3,onPitchAvailable(t){e.postMessage({kind:"pitch",value:t})}}),t({binsPerSecond:16,onBinAvailable(t){e.postMessage({kind:"bin",value:t})}})])));
